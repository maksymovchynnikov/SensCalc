(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    345108,       7262]
NotebookOptionsPosition[    337523,       7122]
NotebookOutlinePosition[    337926,       7138]
CellTagsIndexPosition[    337883,       7135]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Calculating the acceptance for decay products", "Chapter",
 CellChangeTimes->{{3.9493978349470043`*^9, 
  3.949397840992096*^9}},ExpressionUUID->"1e3846eb-525c-5743-97ad-\
28a228d9e0b2"],

Cell[CellGroupData[{

Cell["A kink in the trajectory due to magnetic field", "Section",
 CellChangeTimes->{{3.889241769668279*^9, 3.889241776377763*^9}, {
  3.8892450953409357`*^9, 
  3.8892450955208035`*^9}},ExpressionUUID->"49530853-d827-264c-b220-\
479a332a561b"],

Cell[CellGroupData[{

Cell["Parameters", "Subsection",
 CellChangeTimes->{{3.916156229020624*^9, 
  3.9161562314142723`*^9}},ExpressionUUID->"2b1c5d47-f8cb-1144-b41d-\
77d072963f98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"electric", " ", "charge", " ", "in", " ", "SI", " ", "units"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"qValSI", "=", 
     RowBox[{"1.6", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "19"}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Magnetic", " ", "field", " ", "in", " ", "SI", " ", "units"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BvalFCCee", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Electron", " ", "mass", " ", "in", " ", "SI", " ", "units"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mekG", "=", 
     RowBox[{"9.1", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "31"}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"m\[Mu]kG", "=", 
     RowBox[{
      FractionBox["105", 
       RowBox[{"0.5", "*", 
        SuperscriptBox["10", 
         RowBox[{"-", "3"}]]}]], "9.1", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "31"}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hbar", "=", 
     RowBox[{"6.58", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "25"}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cval", "=", 
     RowBox[{"3", "*", 
      SuperscriptBox["10", "8"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"1", " ", "kg", " ", "in", " ", "terms", " ", "of", " ", 
     RowBox[{"GeV", ".", " ", "Converted"}], " ", "using", " ", "the", " ", 
     "electron", " ", "mass", " ", "in", " ", "GeV", " ", "and", " ", "in", 
     " ", "kg"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kgToGeVval", "=", 
     FractionBox[
      RowBox[{"0.5", "*", 
       SuperscriptBox["10", 
        RowBox[{"-", "3"}]]}], 
      RowBox[{"9.1", "*", 
       SuperscriptBox["10", 
        RowBox[{"-", "31"}]]}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GeVTokgVal", "=", 
     SuperscriptBox["kgToGeVval", 
      RowBox[{"-", "1"}]]}], ";"}]}]}]], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"d56bab22-f8f3-dd4d-96c3-58996b8065f0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Constant magnetic field", "Subsection",
 CellChangeTimes->{{3.8891723271521983`*^9, 
  3.88917232970436*^9}},ExpressionUUID->"49dddbe9-6fcd-0047-8a0b-\
92605d1c1e17"],

Cell[CellGroupData[{

Cell["Exact expressions", "Subsubsection",
 CellChangeTimes->{{3.898699158303877*^9, 
  3.8986991608177204`*^9}},ExpressionUUID->"4461a3cd-0637-2740-9dd2-\
43ac9a153c25"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Velocities", " ", "in", " ", "SI", " ", "in", " ", "terms", " ", "of", 
     " ", "p"}], ",", " ", 
    RowBox[{"E", " ", "in", " ", "GeV"}], ",", " ", 
    RowBox[{"and", " ", "speed", " ", "of", " ", "light"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"vxEnergy", "=", 
     RowBox[{"c", "*", 
      FractionBox["pxGeV", "EGeV"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vyEnergy", "=", 
     RowBox[{"c", "*", 
      FractionBox["pyGeV", "EGeV"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vzEnergy", "=", 
     RowBox[{"c", "*", 
      FractionBox["pzGeV", "EGeV"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Gamma]Energy", "=", 
     FractionBox["EGeV", "mGeV"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"EOMs", " ", "\[Gamma]", " ", 
       FractionBox[
        RowBox[{"d", 
         OverscriptBox["v", "_"]}], "dt"]}], " ", "=", " ", 
      RowBox[{"q", "[", 
       RowBox[{
        OverscriptBox["v", "_"], "\[Times]", 
        OverscriptBox["B", "_"]}], "]"}]}], ",", " ", 
     RowBox[{"where", " ", 
      OverscriptBox["B", "_"], " ", "is", " ", "assumed", " ", "to", " ", 
      "be", " ", "located", " ", "along", " ", "the", " ", "y", " ", "axis", 
      " ", "in", " ", "the", " ", "positive", " ", 
      RowBox[{"direction", ".", " ", "All"}], " ", "the", " ", "quantities", 
      " ", "entering", " ", "the", " ", "EOM", " ", "are", " ", "in", " ", 
      "SI", " ", "units"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EQsHelicalTrajectory", "=", 
     RowBox[{
      RowBox[{"DSolve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"x", "''"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"m", "*", "\[Gamma]"}]], "q", "*", 
            RowBox[{
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"x", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"y", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"z", "'"}], "[", "t", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "B", ",", "0"}], "}"}]}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"y", "''"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"m", "*", "\[Gamma]"}]], "q", "*", 
            RowBox[{
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"x", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"y", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"z", "'"}], "[", "t", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "B", ",", "0"}], "}"}]}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"z", "''"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{
            FractionBox["q", 
             RowBox[{"m", "*", "\[Gamma]"}]], "*", 
            RowBox[{
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"x", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"y", "'"}], "[", "t", "]"}], ",", 
                 RowBox[{
                  RowBox[{"z", "'"}], "[", "t", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "B", ",", "0"}], "}"}]}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{"x", "[", "0", "]"}], "\[Equal]", "x0"}], ",", 
          RowBox[{
           RowBox[{"y", "[", "0", "]"}], "\[Equal]", "y0"}], ",", 
          RowBox[{
           RowBox[{"z", "[", "0", "]"}], "\[Equal]", "z0"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"x", "'"}], "[", "0", "]"}], "\[Equal]", "vx"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"y", "'"}], "[", "0", "]"}], "\[Equal]", "vy"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"z", "'"}], "[", "0", "]"}], "\[Equal]", "vz"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "t"}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
   "Print", "[", 
    "\"\<Helical trajectories - x, y, z. Here, \!\(\*SubscriptBox[\(p\), \
\(i\)]\) in the units of GeV:\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"xHelicalTemp1", "[", 
       RowBox[{
       "x0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "EGeV_", ",", "BTl_", ",", 
        "qCoulomb_", ",", "tsecond_", ",", "GeVTokg_"}], "]"}], ",", 
      RowBox[{"yHelicalTemp1", "[", 
       RowBox[{"y0m_", ",", "pyGeV_", ",", "EGeV_", ",", "tsecond_"}], "]"}], 
      ",", 
      RowBox[{"zHelicalTemp1", "[", 
       RowBox[{
       "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "EGeV_", ",", "BTl_", ",", 
        "qCoulomb_", ",", "tsecond_", ",", "GeVTokg_"}], "]"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"x", "[", "t", "]"}], "/.", "EQsHelicalTrajectory"}], ")"}], 
       ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"y", "[", "t", "]"}], "/.", "EQsHelicalTrajectory"}], ")"}], 
       ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"z", "[", "t", "]"}], "/.", "EQsHelicalTrajectory"}], 
        ")"}]}], "}"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vx", "\[Rule]", "vxEnergy"}], ",", 
       RowBox[{"vy", "\[Rule]", "vyEnergy"}], ",", 
       RowBox[{"vz", "\[Rule]", "vzEnergy"}], ",", 
       RowBox[{"\[Gamma]", "\[Rule]", "\[Gamma]Energy"}], ",", 
       RowBox[{"m", "\[Rule]", " ", 
        RowBox[{"mGeV", "*", "GeVTokg"}]}], ",", 
       RowBox[{"B", "\[Rule]", "BTl"}], ",", 
       RowBox[{"q", "\[Rule]", "qCoulomb"}], ",", 
       RowBox[{"x0", "\[Rule]", "x0m"}], ",", 
       RowBox[{"t", "\[Rule]", "tsecond"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", "\"\<Velocities dx/dt, dy/dt, dz/dt:\>\"", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vxHelicalTemp1", "[", 
       RowBox[{
       "pxGeV_", ",", "pzGeV_", ",", "EGeV_", ",", "BTl_", ",", "qCoulomb_", 
        ",", "tsecond_", ",", "GeVTokg_"}], "]"}], ",", 
      RowBox[{"vyHelicalTemp1", "[", 
       RowBox[{"pyGeV_", ",", "EGeV_"}], "]"}], ",", 
      RowBox[{"vzHelicalTemp1", "[", 
       RowBox[{
       "pxGeV_", ",", "pzGeV_", ",", "EGeV_", ",", "BTl_", ",", "qCoulomb_", 
        ",", "tsecond_", ",", "GeVTokg_"}], "]"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"xHelicalTemp1", "[", 
          RowBox[{
          "x0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
           "qCoulomb", ",", "tsecond", ",", "GeVTokg"}], "]"}], ",", 
         "tsecond"}], "]"}], ",", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"yHelicalTemp1", "[", 
          RowBox[{"y0m", ",", "pyGeV", ",", "EGeV", ",", "tsecond"}], "]"}], 
         ",", "tsecond"}], "]"}], ",", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"zHelicalTemp1", "[", 
          RowBox[{
          "z0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
           "qCoulomb", ",", "tsecond", ",", "GeVTokg"}], "]"}], ",", 
         "tsecond"}], "]"}]}], "}"}], "//", "Simplify"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
   "Print", "[", 
    "\"\<Momenta \!\(\*SubscriptBox[\(p\), \(i\)]\)(t) = E \
\!\(\*SubscriptBox[\(v\), \(i\)]\)(t)/\!\(\*SuperscriptBox[\(c\), \(2\)]\):\>\
\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pxHelicalTemp1", "[", 
       RowBox[{
       "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qCoulomb_", ",", 
        "tsecond_", ",", "GeVTokg_"}], "]"}], ",", 
      RowBox[{"pyHelicalTemp1", "[", "pyGeV_", "]"}], ",", 
      RowBox[{"pzHelicalTemp1", "[", 
       RowBox[{
       "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qCoulomb_", ",", 
        "tsecond_", ",", "GeVTokg_"}], "]"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{
      FractionBox["EGeV", "c"], 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"vxHelicalTemp1", "[", 
         RowBox[{
         "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", "qCoulomb", ",",
           "tsecond", ",", "GeVTokg"}], "]"}], ",", 
        RowBox[{"vyHelicalTemp1", "[", 
         RowBox[{"pyGeV", ",", "EGeV"}], "]"}], ",", 
        RowBox[{"vzHelicalTemp1", "[", 
         RowBox[{
         "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", "qCoulomb", ",",
           "tsecond", ",", "GeVTokg"}], "]"}]}], "}"}]}], "//", 
     "Simplify"}]}], "\[IndentingNewLine]", 
   RowBox[{
   "Print", "[", 
    "\"\<Cross-check: \!\(\*SuperscriptBox[OverscriptBox[\(v\), \(_\)], \
\(2\)]\)(t) = \!\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \(x\)]\)(t)+\!\
\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \
\(y\)]\)(t)+\!\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \(z\)]\)(t) is \
equal to \!\(\*SuperscriptBox[\(v\), \(2\)]\)(t = 0) = \
\!\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \(x, \
0\)]\)+\!\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \(y, \
0\)]\)+\!\(\*SubscriptBox[SuperscriptBox[\(v\), \(2\)], \(z, 0\)]\) = \
\!\(\*SuperscriptBox[\(c\), \(2\)]\)\!\(\*SuperscriptBox[OverscriptBox[\(p\), \
\(_\)], \(2\)]\)/\!\(\*SuperscriptBox[\(E\), \(2\)]\)\>\"", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"vxHelicalTemp1", "[", 
        RowBox[{
        "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", "qCoulomb", ",", 
         "tsecond", ",", "GeVTokg"}], "]"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"vyHelicalTemp1", "[", 
        RowBox[{"pyGeV", ",", "EGeV"}], "]"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"vzHelicalTemp1", "[", 
        RowBox[{
        "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", "qCoulomb", ",", 
         "tsecond", ",", "GeVTokg"}], "]"}], "2"]}], "//", "Expand"}], "//", 
    "Simplify"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Therefore", ",", " ", 
     RowBox[{
     "after", " ", "passing", " ", "the", " ", "domain", " ", "with", " ", 
      "the", " ", "magnetic", " ", "field"}], ",", " ", 
     RowBox[{"the", " ", "new", " ", 
      SubscriptBox[
       RowBox[{"p", "'"}], "x"]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"p", "'"}], "z"], " ", "are", " ", 
       SubscriptBox[
        RowBox[{"p", "'"}], "x"]}], " ", "=", " ", 
      RowBox[{
       SubscriptBox["p", 
        RowBox[{"x", ",", "0"}]], "\[Times]", 
       FractionBox[
        RowBox[{
         SubscriptBox["v", "x"], 
         RowBox[{"(", 
          SubscriptBox["t", "passing"], ")"}]}], 
        SubscriptBox["v", 
         RowBox[{"x", ",", "0"}]]]}]}], ",", " ", 
     RowBox[{
      SubscriptBox[
       RowBox[{"p", "'"}], "z"], " ", "=", " ", 
      RowBox[{
       SubscriptBox["p", 
        RowBox[{"z", ",", "0"}]], "\[Times]", 
       FractionBox[
        RowBox[{
         SubscriptBox["v", "z"], 
         RowBox[{"(", 
          SubscriptBox["t", "passing"], ")"}]}], 
        SubscriptBox["v", 
         RowBox[{"z", ",", "0"}]]]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Approximate", " ", "value", " ", "of", " ", "the", " ", "period", " ", 
     "of", " ", "time", " ", "for", " ", "which", " ", "the", " ", "charged", 
     " ", "particle", " ", "passes", " ", "through", " ", "the", " ", 
     "domain", " ", "with", " ", "magnetic", " ", 
     RowBox[{"field", ".", " ", "It"}], " ", "is", " ", "estimated", " ", 
     "roughly", " ", "assuming", " ", "that", " ", "the", " ", "momentum", 
     " ", 
     SubscriptBox["p", "z"], " ", "is", " ", "left", " ", "unchanged"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tz0", "[", 
      RowBox[{
      "zprojm_", ",", "z0m_", ",", "c_", ",", "pzGeV_", ",", "EGeV_"}], "]"}],
      "=", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"zHelicalTemp1", "[", 
             RowBox[{
             "z0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
              "qCoulomb", ",", "t", ",", "GeVTokg"}], "]"}], "\[Equal]", 
            "zproj"}], ",", "t"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{
         TemplateBox[{"1"},
          "C"], "\[Rule]", "0"}], "}"}]}], "*)"}], 
     RowBox[{"t", "/.", 
      RowBox[{
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"z0m", "+", 
           RowBox[{"vzEnergy", "*", "t"}]}], "==", "zprojm"}], ",", "t"}], 
        "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Helical", " ", "trajectories", " ", 
      RowBox[{"x", "[", 
       SubscriptBox["t", 
        RowBox[{"z", " ", "=", " ", "0"}]], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"y", "[", 
       SubscriptBox["t", 
        RowBox[{"z", " ", "=", " ", "0"}]], "]"}], "."}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xHelicalTemp2", "[", 
      RowBox[{
      "x0m_", ",", "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", 
       "qsign_", ",", "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"xHelicalTemp1", "[", 
       RowBox[{
       "x0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
        "qCoulomb", ",", 
        RowBox[{"tz0", "[", 
         RowBox[{"zprojm", ",", "z0m", ",", "c", ",", "pzGeV", ",", "EGeV"}], 
         "]"}], ",", "GeVTokg"}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c", "\[Rule]", "cval"}], ",", 
        RowBox[{"qCoulomb", "\[Rule]", " ", 
         RowBox[{"qValSI", "*", "qsign"}]}], ",", 
        RowBox[{"GeVTokg", "\[Rule]", "GeVTokgVal"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yHelicalTemp2", "[", 
      RowBox[{
      "y0m_", ",", "z0m_", ",", "pyGeV_", ",", "pzGeV_", ",", "zprojm_"}], 
      "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"yHelicalTemp1", "[", 
        RowBox[{"y0m", ",", "pyGeV", ",", "EGeV", ",", 
         RowBox[{"tz0", "[", 
          RowBox[{"zprojm", ",", "z0m", ",", "c", ",", "pzGeV", ",", "EGeV"}],
           "]"}]}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"m", "\[Rule]", "mlkg"}], ",", 
         RowBox[{"\[Gamma]", "\[Rule]", "\[Gamma]Energy"}], ",", 
         RowBox[{"vz", "\[Rule]", "vzEnergy"}], ",", 
         RowBox[{"vx", "\[Rule]", "vxEnergy"}], ",", 
         RowBox[{"vy", "\[Rule]", "vyEnergy"}]}], "}"}]}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c", "\[Rule]", "cval"}], ",", 
        RowBox[{"qCoulomb", "\[Rule]", " ", 
         RowBox[{"qValSI", "*", "qsign"}]}], ",", 
        RowBox[{"GeVTokg", "\[Rule]", "GeVTokgVal"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"zHelicalTemp2", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"zHelicalTemp1", "[", 
       RowBox[{
       "z0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
        "qCoulomb", ",", 
        RowBox[{"tz0", "[", 
         RowBox[{"zprojm", ",", "z0m", ",", "c", ",", "pzGeV", ",", "EGeV"}], 
         "]"}], ",", "GeVTokg"}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c", "\[Rule]", 
         RowBox[{"3", "*", 
          SuperscriptBox["10", "8"]}]}], ",", 
        RowBox[{"qCoulomb", "\[Rule]", " ", 
         RowBox[{"qValSI", "*", "qsign"}]}], ",", 
        RowBox[{"GeVTokg", "\[Rule]", "GeVTokgVal"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pxHelicalTemp2", "[", 
        RowBox[{
        "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",",
          "zprojm_"}], "]"}], ",", 
       RowBox[{"pyHelicalTemp2", "[", "pyGeV_", "]"}], ",", 
       RowBox[{"pzHelicalTemp2", "[", 
        RowBox[{
        "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",",
          "zprojm_"}], "]"}]}], "}"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pxHelicalTemp1", "[", 
          RowBox[{"pxGeV", ",", "pzGeV", ",", "BTl", ",", "qCoulomb", ",", 
           RowBox[{"tz0", "[", 
            RowBox[{
            "zprojm", ",", "z0m", ",", "c", ",", "pzGeV", ",", "EGeV"}], 
            "]"}], ",", "GeVTokg"}], "]"}], ",", 
         RowBox[{"pyHelicalTemp1", "[", "pyGeV", "]"}], ",", 
         RowBox[{"pzHelicalTemp1", "[", 
          RowBox[{"pxGeV", ",", "pzGeV", ",", "BTl", ",", "qCoulomb", ",", 
           RowBox[{"tz0", "[", 
            RowBox[{
            "zprojm", ",", "z0m", ",", "c", ",", "pzGeV", ",", "EGeV"}], 
            "]"}], ",", "GeVTokg"}], "]"}]}], "}"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"c", "\[Rule]", "cval"}], ",", 
         RowBox[{"qCoulomb", "\[Rule]", " ", 
          RowBox[{"qValSI", "*", "qsign"}]}], ",", 
         RowBox[{"GeVTokg", "\[Rule]", "GeVTokgVal"}]}], "}"}]}], "//", 
      "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Print", "[", "\"\<Larmor radius (in m):\>\"", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"LarmorRadius", "[", 
     RowBox[{"EGeV_", ",", "BTl_"}], "]"}], "=", 
    RowBox[{"cval", "*", 
     FractionBox[
      RowBox[{"EGeV", "*", "GeVTokgVal"}], 
      RowBox[{"qValSI", "*", "BTl"}]]}]}]}]}]], "Input",
 CellChangeTimes->{{3.8891715835639944`*^9, 3.889171607572118*^9}, {
   3.8891716708460007`*^9, 3.8891716996685534`*^9}, {3.889171730927663*^9, 
   3.8891718025651083`*^9}, {3.8891718552539015`*^9, 3.889171936952908*^9}, {
   3.8891720111828213`*^9, 3.8891720113107405`*^9}, {3.8891721699050617`*^9, 
   3.8891721757644434`*^9}, {3.889174147055462*^9, 3.889174160006665*^9}, {
   3.8891958521046643`*^9, 3.8891958522468634`*^9}, {3.8891962026454644`*^9, 
   3.889196237599688*^9}, {3.8891963121202774`*^9, 3.8891963141583824`*^9}, {
   3.88919688391845*^9, 3.889196923198343*^9}, {3.889196971720621*^9, 
   3.8891969735276012`*^9}, {3.8891970264289846`*^9, 3.889197089936922*^9}, {
   3.889197123724253*^9, 3.88919712488072*^9}, {3.889197347990362*^9, 
   3.8891973643290424`*^9}, {3.88919926025797*^9, 3.8891992911784053`*^9}, {
   3.8891993830334735`*^9, 3.889199383419773*^9}, {3.8891995274596653`*^9, 
   3.8891995275987587`*^9}, {3.889199965458976*^9, 3.8892000128043385`*^9}, {
   3.889200051029212*^9, 3.8892001179983997`*^9}, {3.889200558271455*^9, 
   3.8892005655297513`*^9}, {3.889200723395628*^9, 3.8892007266926556`*^9}, {
   3.889201692567236*^9, 3.889201704299495*^9}, {3.889201997677557*^9, 
   3.8892020059634314`*^9}, {3.889203858706788*^9, 3.889204001096776*^9}, {
   3.889204035386567*^9, 3.889204263742028*^9}, {3.8892043081832323`*^9, 
   3.889204391264265*^9}, {3.889204531648478*^9, 3.889204689106662*^9}, {
   3.8892050634914045`*^9, 3.8892051702023964`*^9}, {3.8892057677033467`*^9, 
   3.8892061222105474`*^9}, {3.8892061644903955`*^9, 3.889206164856732*^9}, {
   3.889206222470356*^9, 3.8892062225708046`*^9}, {3.889206285420225*^9, 
   3.889206490520496*^9}, {3.889206595121992*^9, 3.8892067009458857`*^9}, {
   3.8892067476541643`*^9, 3.8892067773218117`*^9}, 3.889206968504375*^9, {
   3.8892418443893285`*^9, 3.889241942034682*^9}, {3.889242604413707*^9, 
   3.8892426111403365`*^9}, {3.8892427246470413`*^9, 
   3.8892428336617985`*^9}, {3.889242935829185*^9, 3.8892429516691093`*^9}, {
   3.8892429861876316`*^9, 3.889243028970298*^9}, {3.889244735048849*^9, 
   3.8892448846934404`*^9}, 3.889244933960964*^9, {3.889244966522671*^9, 
   3.8892450312974296`*^9}, {3.8892451080983906`*^9, 3.889245155339543*^9}, {
   3.889245198863324*^9, 3.889245277568147*^9}, {3.889245346682953*^9, 
   3.889245375548482*^9}, {3.889245434706152*^9, 3.8892454400324965`*^9}, {
   3.889245562969037*^9, 3.8892455831975603`*^9}, {3.8892457231983676`*^9, 
   3.8892457268208*^9}, {3.8892462439945955`*^9, 3.889246326384137*^9}, {
   3.889246363667035*^9, 3.8892464030715723`*^9}, {3.889255024952756*^9, 
   3.8892551225447063`*^9}, {3.889263922692747*^9, 3.8892639450822616`*^9}, {
   3.8892639756443453`*^9, 3.8892640303101296`*^9}, 3.8969283922022552`*^9, {
   3.898699281483991*^9, 3.8986992942793465`*^9}, {3.898699337954791*^9, 
   3.898699338542406*^9}, {3.9049623366587543`*^9, 3.9049623369687014`*^9}, {
   3.9112843536969843`*^9, 3.9112843577140183`*^9}, {3.911284636577899*^9, 
   3.9112848131555805`*^9}, {3.9112864519207497`*^9, 3.911286452740077*^9}, {
   3.911287015036559*^9, 3.911287021036378*^9}, {3.911287097132141*^9, 
   3.9112870973086987`*^9}, {3.9112872001496377`*^9, 3.911287202871893*^9}, {
   3.9112872852329645`*^9, 3.911287321735216*^9}, {3.9112895845189333`*^9, 
   3.9112895942065487`*^9}, {3.91128965891726*^9, 3.911289659966033*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"1765c81f-fcce-ac45-9483-f017a0d43211"],

Cell[BoxData[
 FormBox["\<\"Helical trajectories - x, y, z. Here, \
\\!\\(\\*SubscriptBox[\\(p\\), \\(i\\)]\\) in the units of GeV:\"\>", 
  TraditionalForm]], "Print",
 CellChangeTimes->{3.9156385923144894`*^9, 3.915639459955377*^9, 
  3.915640301443778*^9, 3.915641482126387*^9, 3.91564169456841*^9, 
  3.915681161169697*^9, 3.915681505948893*^9, 3.9156856579832497`*^9, 
  3.9157698829697094`*^9, 3.9157709917280345`*^9, 3.9157813490046716`*^9, 
  3.915781594422082*^9, 3.915787353587736*^9, 3.915814752427195*^9, 
  3.9158551909562826`*^9, 3.9158573863147974`*^9, 3.9158576524095235`*^9, 
  3.9158591308477077`*^9, 3.9158631081490498`*^9, 3.915865421117629*^9, 
  3.9158674312847605`*^9, 3.91587876872263*^9, 3.9161263899562645`*^9, 
  3.9161282291485643`*^9, 3.919966116194794*^9, 3.9493978471988792`*^9},
 CellLabel->
  "During evaluation of \
In[408]:=",ExpressionUUID->"de4a32a7-1d3a-834e-b983-b87fedd575e5"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
    FractionBox[
     RowBox[{
      RowBox[{"c", " ", "GeVTokg", " ", "pxGeV", " ", 
       RowBox[{"sin", "(", 
        FractionBox[
         RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
         RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "+", 
      RowBox[{"c", " ", "GeVTokg", " ", "pzGeV", " ", 
       RowBox[{"cos", "(", 
        FractionBox[
         RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
         RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "+", 
      RowBox[{"BTl", " ", "qCoulomb", " ", "x0m"}], "-", 
      RowBox[{"c", " ", "GeVTokg", " ", "pzGeV"}]}], 
     RowBox[{"BTl", " ", "qCoulomb"}]], ",", 
    RowBox[{
     FractionBox[
      RowBox[{"c", " ", "pyGeV", " ", "tsecond"}], "EGeV"], "+", "y0"}], ",", 
    FractionBox[
     RowBox[{
      RowBox[{"-", 
       RowBox[{"c", " ", "GeVTokg", " ", "pxGeV", " ", 
        RowBox[{"cos", "(", 
         FractionBox[
          RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
          RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}]}], "+", 
      RowBox[{"c", " ", "GeVTokg", " ", "pzGeV", " ", 
       RowBox[{"sin", "(", 
        FractionBox[
         RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
         RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "+", 
      RowBox[{"BTl", " ", "qCoulomb", " ", "z0"}], "+", 
      RowBox[{"c", " ", "GeVTokg", " ", "pxGeV"}]}], 
     RowBox[{"BTl", " ", "qCoulomb"}]]}], "}"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.9156385923546815`*^9, 3.9156394599962053`*^9, 
  3.91564030148531*^9, 3.915641482164633*^9, 3.9156416946093917`*^9, 
  3.9156811612116528`*^9, 3.915681505964819*^9, 3.915685657999922*^9, 
  3.9157698829817095`*^9, 3.915770991744034*^9, 3.9157813490166173`*^9, 
  3.9157815944579873`*^9, 3.915787353594746*^9, 3.9158147524590297`*^9, 
  3.9158551909875236`*^9, 3.915857386346075*^9, 3.9158576524423504`*^9, 
  3.915859130878953*^9, 3.915863108164671*^9, 3.9158654211249847`*^9, 
  3.915867431316414*^9, 3.9158787687698884`*^9, 3.916126389974609*^9, 
  3.91612822915064*^9, 3.9199661162063217`*^9, 3.949397847246439*^9},
 CellLabel->
  "Out[414]=",ExpressionUUID->"4c69ff8d-a47f-0b43-b397-495a499dd149"],

Cell[BoxData[
 FormBox["\<\"Velocities dx/dt, dy/dt, dz/dt:\"\>", TraditionalForm]], "Print",
 CellChangeTimes->{3.9156385923144894`*^9, 3.915639459955377*^9, 
  3.915640301443778*^9, 3.915641482126387*^9, 3.91564169456841*^9, 
  3.915681161169697*^9, 3.915681505948893*^9, 3.9156856579832497`*^9, 
  3.9157698829697094`*^9, 3.9157709917280345`*^9, 3.9157813490046716`*^9, 
  3.915781594422082*^9, 3.915787353587736*^9, 3.915814752427195*^9, 
  3.9158551909562826`*^9, 3.9158573863147974`*^9, 3.9158576524095235`*^9, 
  3.9158591308477077`*^9, 3.9158631081490498`*^9, 3.915865421117629*^9, 
  3.9158674312847605`*^9, 3.91587876872263*^9, 3.9161263899562645`*^9, 
  3.9161282291485643`*^9, 3.919966116194794*^9, 3.949397847260744*^9},
 CellLabel->
  "During evaluation of \
In[408]:=",ExpressionUUID->"da648f45-793a-4345-8cd3-f4b7a66ed06f"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
    FractionBox[
     RowBox[{"c", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pxGeV", " ", 
         RowBox[{"cos", "(", 
          FractionBox[
           RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
           RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "-", 
        RowBox[{"pzGeV", " ", 
         RowBox[{"sin", "(", 
          FractionBox[
           RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
           RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}]}], ")"}]}], "EGeV"], 
    ",", 
    FractionBox[
     RowBox[{"c", " ", "pyGeV"}], "EGeV"], ",", 
    FractionBox[
     RowBox[{"c", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pxGeV", " ", 
         RowBox[{"sin", "(", 
          FractionBox[
           RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
           RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "+", 
        RowBox[{"pzGeV", " ", 
         RowBox[{"cos", "(", 
          FractionBox[
           RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
           RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}]}], ")"}]}], "EGeV"]}], 
   "}"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.9156385923546815`*^9, 3.9156394599962053`*^9, 
  3.91564030148531*^9, 3.915641482164633*^9, 3.9156416946093917`*^9, 
  3.9156811612116528`*^9, 3.915681505964819*^9, 3.915685657999922*^9, 
  3.9157698829817095`*^9, 3.915770991744034*^9, 3.9157813490166173`*^9, 
  3.9157815944579873`*^9, 3.915787353594746*^9, 3.9158147524590297`*^9, 
  3.9158551909875236`*^9, 3.915857386346075*^9, 3.9158576524423504`*^9, 
  3.915859130878953*^9, 3.915863108164671*^9, 3.9158654211249847`*^9, 
  3.915867431316414*^9, 3.9158787687698884`*^9, 3.916126389974609*^9, 
  3.91612822915064*^9, 3.9199661162063217`*^9, 3.949397847262516*^9},
 CellLabel->
  "Out[416]=",ExpressionUUID->"addf2573-cc51-b14f-ac20-3c7727ce84e1"],

Cell[BoxData[
 FormBox["\<\"Momenta \\!\\(\\*SubscriptBox[\\(p\\), \\(i\\)]\\)(t) = E \
\\!\\(\\*SubscriptBox[\\(v\\), \
\\(i\\)]\\)(t)/\\!\\(\\*SuperscriptBox[\\(c\\), \\(2\\)]\\):\"\>", 
  TraditionalForm]], "Print",
 CellChangeTimes->{3.9156385923144894`*^9, 3.915639459955377*^9, 
  3.915640301443778*^9, 3.915641482126387*^9, 3.91564169456841*^9, 
  3.915681161169697*^9, 3.915681505948893*^9, 3.9156856579832497`*^9, 
  3.9157698829697094`*^9, 3.9157709917280345`*^9, 3.9157813490046716`*^9, 
  3.915781594422082*^9, 3.915787353587736*^9, 3.915814752427195*^9, 
  3.9158551909562826`*^9, 3.9158573863147974`*^9, 3.9158576524095235`*^9, 
  3.9158591308477077`*^9, 3.9158631081490498`*^9, 3.915865421117629*^9, 
  3.9158674312847605`*^9, 3.91587876872263*^9, 3.9161263899562645`*^9, 
  3.9161282291485643`*^9, 3.919966116194794*^9, 3.949397847262516*^9},
 CellLabel->
  "During evaluation of \
In[408]:=",ExpressionUUID->"ba5fc002-82fb-044a-947c-5377e0a64617"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"pxGeV", " ", 
      RowBox[{"cos", "(", 
       FractionBox[
        RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
        RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "-", 
     RowBox[{"pzGeV", " ", 
      RowBox[{"sin", "(", 
       FractionBox[
        RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
        RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}]}], ",", "pyGeV", ",", 
    RowBox[{
     RowBox[{"pxGeV", " ", 
      RowBox[{"sin", "(", 
       FractionBox[
        RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
        RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}], "+", 
     RowBox[{"pzGeV", " ", 
      RowBox[{"cos", "(", 
       FractionBox[
        RowBox[{"BTl", " ", "qCoulomb", " ", "tsecond"}], 
        RowBox[{"EGeV", " ", "GeVTokg"}]], ")"}]}]}]}], "}"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{3.9156385923546815`*^9, 3.9156394599962053`*^9, 
  3.91564030148531*^9, 3.915641482164633*^9, 3.9156416946093917`*^9, 
  3.9156811612116528`*^9, 3.915681505964819*^9, 3.915685657999922*^9, 
  3.9157698829817095`*^9, 3.915770991744034*^9, 3.9157813490166173`*^9, 
  3.9157815944579873`*^9, 3.915787353594746*^9, 3.9158147524590297`*^9, 
  3.9158551909875236`*^9, 3.915857386346075*^9, 3.9158576524423504`*^9, 
  3.915859130878953*^9, 3.915863108164671*^9, 3.9158654211249847`*^9, 
  3.915867431316414*^9, 3.9158787687698884`*^9, 3.916126389974609*^9, 
  3.91612822915064*^9, 3.9199661162063217`*^9, 3.9493978473102646`*^9},
 CellLabel->
  "Out[418]=",ExpressionUUID->"7cf9449f-4735-5046-8b50-2ea3190b1832"],

Cell[BoxData[
 FormBox["\<\"Cross-check: \\!\\(\\*SuperscriptBox[OverscriptBox[\\(v\\), \
\\(_\\)], \\(2\\)]\\)(t) = \\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\
\\)], \\(x\\)]\\)(t)+\\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\\)], \
\\(y\\)]\\)(t)+\\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\\)], \
\\(z\\)]\\)(t) is equal to \\!\\(\\*SuperscriptBox[\\(v\\), \\(2\\)]\\)(t = \
0) = \\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\\)], \\(x, \
0\\)]\\)+\\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\\)], \\(y, \
0\\)]\\)+\\!\\(\\*SubscriptBox[SuperscriptBox[\\(v\\), \\(2\\)], \\(z, \
0\\)]\\) = \\!\\(\\*SuperscriptBox[\\(c\\), \
\\(2\\)]\\)\\!\\(\\*SuperscriptBox[OverscriptBox[\\(p\\), \\(_\\)], \
\\(2\\)]\\)/\\!\\(\\*SuperscriptBox[\\(E\\), \\(2\\)]\\)\"\>", 
  TraditionalForm]], "Print",
 CellChangeTimes->{3.9156385923144894`*^9, 3.915639459955377*^9, 
  3.915640301443778*^9, 3.915641482126387*^9, 3.91564169456841*^9, 
  3.915681161169697*^9, 3.915681505948893*^9, 3.9156856579832497`*^9, 
  3.9157698829697094`*^9, 3.9157709917280345`*^9, 3.9157813490046716`*^9, 
  3.915781594422082*^9, 3.915787353587736*^9, 3.915814752427195*^9, 
  3.9158551909562826`*^9, 3.9158573863147974`*^9, 3.9158576524095235`*^9, 
  3.9158591308477077`*^9, 3.9158631081490498`*^9, 3.915865421117629*^9, 
  3.9158674312847605`*^9, 3.91587876872263*^9, 3.9161263899562645`*^9, 
  3.9161282291485643`*^9, 3.919966116194794*^9, 3.9493978473263817`*^9},
 CellLabel->
  "During evaluation of \
In[408]:=",ExpressionUUID->"20d22e4e-63b2-c547-947b-b2c926380e8b"],

Cell[BoxData[
 FormBox[
  FractionBox[
   RowBox[{
    SuperscriptBox["c", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["pxGeV", "2"], "+", 
      SuperscriptBox["pyGeV", "2"], "+", 
      SuperscriptBox["pzGeV", "2"]}], ")"}]}], 
   SuperscriptBox["EGeV", "2"]], TraditionalForm]], "Output",
 CellChangeTimes->{3.9156385923546815`*^9, 3.9156394599962053`*^9, 
  3.91564030148531*^9, 3.915641482164633*^9, 3.9156416946093917`*^9, 
  3.9156811612116528`*^9, 3.915681505964819*^9, 3.915685657999922*^9, 
  3.9157698829817095`*^9, 3.915770991744034*^9, 3.9157813490166173`*^9, 
  3.9157815944579873`*^9, 3.915787353594746*^9, 3.9158147524590297`*^9, 
  3.9158551909875236`*^9, 3.915857386346075*^9, 3.9158576524423504`*^9, 
  3.915859130878953*^9, 3.915863108164671*^9, 3.9158654211249847`*^9, 
  3.915867431316414*^9, 3.9158787687698884`*^9, 3.916126389974609*^9, 
  3.91612822915064*^9, 3.9199661162063217`*^9, 3.9493978473263817`*^9},
 CellLabel->
  "Out[420]=",ExpressionUUID->"d6fd0b21-d388-454f-9a9c-7bd365ecec84"],

Cell[BoxData[
 FormBox["\<\"Larmor radius (in m):\"\>", TraditionalForm]], "Print",
 CellChangeTimes->{3.9156385923144894`*^9, 3.915639459955377*^9, 
  3.915640301443778*^9, 3.915641482126387*^9, 3.91564169456841*^9, 
  3.915681161169697*^9, 3.915681505948893*^9, 3.9156856579832497`*^9, 
  3.9157698829697094`*^9, 3.9157709917280345`*^9, 3.9157813490046716`*^9, 
  3.915781594422082*^9, 3.915787353587736*^9, 3.915814752427195*^9, 
  3.9158551909562826`*^9, 3.9158573863147974`*^9, 3.9158576524095235`*^9, 
  3.9158591308477077`*^9, 3.9158631081490498`*^9, 3.915865421117629*^9, 
  3.9158674312847605`*^9, 3.91587876872263*^9, 3.9161263899562645`*^9, 
  3.9161282291485643`*^9, 3.919966116194794*^9, 3.9493978473263817`*^9},
 CellLabel->
  "During evaluation of \
In[408]:=",ExpressionUUID->"43aa5c04-47da-684d-8c05-c8548a10e028"],

Cell[BoxData[
 FormBox[
  FractionBox[
   RowBox[{"3.4124999999999996`", " ", "EGeV"}], "BTl"], 
  TraditionalForm]], "Output",
 CellChangeTimes->{3.9156385923546815`*^9, 3.9156394599962053`*^9, 
  3.91564030148531*^9, 3.915641482164633*^9, 3.9156416946093917`*^9, 
  3.9156811612116528`*^9, 3.915681505964819*^9, 3.915685657999922*^9, 
  3.9157698829817095`*^9, 3.915770991744034*^9, 3.9157813490166173`*^9, 
  3.9157815944579873`*^9, 3.915787353594746*^9, 3.9158147524590297`*^9, 
  3.9158551909875236`*^9, 3.915857386346075*^9, 3.9158576524423504`*^9, 
  3.915859130878953*^9, 3.915863108164671*^9, 3.9158654211249847`*^9, 
  3.915867431316414*^9, 3.9158787687698884`*^9, 3.916126389974609*^9, 
  3.91612822915064*^9, 3.9199661162063217`*^9, 3.9493978473263817`*^9},
 CellLabel->
  "Out[427]=",ExpressionUUID->"543d5cd4-8fc8-1748-b133-ab8ea2f67ce8"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Approx expressions", "Subsubsection",
 CellChangeTimes->{{3.898699204110855*^9, 
  3.898699206168812*^9}},ExpressionUUID->"fe954feb-c1f5-634d-8585-\
24959c2c55b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "The", " ", "minimal", " ", "value", " ", "of", " ", "momentum", " ", "at",
     " ", "which", " ", "the", " ", "trigonometric", " ", "functions", " ", 
    "may", " ", "be", " ", "replaced", " ", "with", " ", "their", " ", 
    "expansion"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"pzKickApprox", "[", 
      RowBox[{"BTl_", ",", "zprojm_", ",", "z0m_"}], "]"}], "=", 
     RowBox[{"Quiet", "[", 
      RowBox[{
       RowBox[{"pzGeV", "/.", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"BTl", "*", "qValSI"}], "EGeV"], "*", 
             RowBox[{"tz0", "[", 
              RowBox[{
              "zprojm", ",", "z0m", ",", "cval", ",", "pzGeV", ",", "EGeV"}], 
              "]"}], 
             FractionBox["1", "GeVTokgVal"]}], "==", "0.2"}], ",", "pzGeV"}], 
          "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "//", "Simplify"}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Expansions", " ", "of", " ", "the", " ", "coordinate", " ", "and", " ", 
     "momenta"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xHelicalApproxTemp2", "[", 
      RowBox[{
      "x0m_", ",", "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", 
       "qsign_", ",", "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Normal", "@", 
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{"xHelicalTemp1", "[", 
            RowBox[{
            "x0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
             "qValSI", ",", "tsecond", ",", "GeVTokgVal"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tsecond", ",", "0", ",", "2"}], "}"}]}], "]"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"c", "->", "cval"}], "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"tsecond", "->", " ", 
         RowBox[{"tz0", "[", 
          RowBox[{
          "zprojm", ",", "z0m", ",", "cval", ",", "pzGeV", ",", "EGeV"}], 
          "]"}]}], "}"}]}], "//", "Simplify"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"zHelicalApproxTemp2", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Normal", "@", 
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{"zHelicalTemp1", "[", 
            RowBox[{
            "z0m", ",", "pxGeV", ",", "pzGeV", ",", "EGeV", ",", "BTl", ",", 
             RowBox[{"qValSI", "*", "qsign"}], ",", "tsecond", ",", 
             "GeVTokgVal"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tsecond", ",", "0", ",", "2"}], "}"}]}], "]"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"c", "->", "cval"}], "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"tsecond", "->", " ", 
         RowBox[{"tz0", "[", 
          RowBox[{
          "zprojm", ",", "z0m", ",", "cval", ",", "pzGeV", ",", "EGeV"}], 
          "]"}]}], "}"}]}], "//", "Simplify"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pxHelicalApproxTemp2", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Normal", "@", 
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{"pxHelicalTemp1", "[", 
            RowBox[{"pxGeV", ",", "pzGeV", ",", "BTl", ",", 
             RowBox[{"qValSI", "*", "qsign"}], ",", "tsecond", ",", 
             "GeVTokgVal"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tsecond", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ")"}], 
       "/.", 
       RowBox[{"{", 
        RowBox[{"tsecond", "->", " ", 
         RowBox[{"tz0", "[", 
          RowBox[{
          "zprojm", ",", "z0m", ",", "cval", ",", "pzGeV", ",", "EGeV"}], 
          "]"}]}], "}"}]}], "//", "Simplify"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pzHelicalApproxTemp2", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Normal", "@", 
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{"pzHelicalTemp1", "[", 
            RowBox[{"pxGeV", ",", "pzGeV", ",", "BTl", ",", 
             RowBox[{"qValSI", "*", "qsign"}], ",", "tsecond", ",", 
             "GeVTokgVal"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tsecond", ",", "0", ",", "1"}], "}"}]}], "]"}]}], ")"}], 
       "/.", 
       RowBox[{"{", 
        RowBox[{"tsecond", "->", " ", 
         RowBox[{"tz0", "[", 
          RowBox[{
          "zprojm", ",", "z0m", ",", "cval", ",", "pzGeV", ",", "EGeV"}], 
          "]"}]}], "}"}]}], "//", "Simplify"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pzHelicalApprox", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pzGeV", ">", 
        RowBox[{"pzKickApprox", "[", 
         RowBox[{"BTl", ",", "zprojm", ",", "z0m"}], "]"}]}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"pzHelicalApproxTemp2", "[", 
         RowBox[{
         "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", "qsign", ",", 
          "zprojm"}], "]"}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"pzHelicalTemp2", "[", 
         RowBox[{
         "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", "qsign", ",", 
          "zprojm"}], "]"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pxHelicalApprox", "[", 
      RowBox[{
      "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", "qsign_", ",", 
       "zprojm_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pzGeV", ">", 
        RowBox[{"pzKickApprox", "[", 
         RowBox[{"BTl", ",", "zprojm", ",", "z0m"}], "]"}]}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"pxHelicalApproxTemp2", "[", 
         RowBox[{
         "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", "qsign", ",", 
          "zprojm"}], "]"}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"pxHelicalTemp2", "[", 
         RowBox[{
         "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", "qsign", ",", 
          "zprojm"}], "]"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xHelicalApprox", "[", 
      RowBox[{
      "x0m_", ",", "z0m_", ",", "pxGeV_", ",", "pzGeV_", ",", "BTl_", ",", 
       "qsign_", ",", "zprojm_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pzGeV", ">", 
        RowBox[{"pzKickApprox", "[", 
         RowBox[{"BTl", ",", "zprojm", ",", "z0m"}], "]"}]}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"xHelicalApproxTemp2", "[", 
         RowBox[{
         "x0m", ",", "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", 
          "qsign", ",", "zprojm"}], "]"}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"xHelicalTemp2", "[", 
         RowBox[{
         "x0m", ",", "z0m", ",", "pxGeV", ",", "pzGeV", ",", "BTl", ",", 
          "qsign", ",", "zprojm"}], "]"}], "]"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8986992098236685`*^9, 3.898699270769168*^9}, {
  3.8986993624704514`*^9, 3.898699753914085*^9}, {3.8986998019339123`*^9, 
  3.898699905581258*^9}, {3.8987000863441525`*^9, 3.8987002575821333`*^9}, {
  3.949397852176815*^9, 3.9493978559115124`*^9}, {3.9515554044056454`*^9, 
  3.951555404976515*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"9e5c288b-f48e-0a42-b29c-9dd18af65207"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pre-definitions", "Section",
 CellChangeTimes->{{3.8913232134212017`*^9, 
  3.8913232154204464`*^9}},ExpressionUUID->"b4548117-d6ba-2e4c-a726-\
c8c1e3d4d8eb"],

Cell[CellGroupData[{

Cell["Kinematic variables used for imposing cuts", "Subsection",
 CellChangeTimes->{{3.8931702432138014`*^9, 3.8931702435906425`*^9}, {
  3.8934366714771786`*^9, 3.8934366726381407`*^9}, {3.9161264470186653`*^9, 
  3.9161264567450504`*^9}},ExpressionUUID->"64b33208-3204-cc4b-942c-\
e2a65329bf7b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"IP", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Consider", " ", "two", " ", "particles", " ", "originating", " ", "from", 
    " ", "the", " ", "same", " ", "point", " ", 
    RowBox[{
     SubscriptBox["r", "prod"], ".", " ", "Their"}], " ", "trajectory", " ", 
    "is", " ", "given", " ", "by", " ", "the", " ", "formula", " ", "below"}],
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"TrajectoryProducts", "[", 
      RowBox[{
      "xprod_", ",", "yprod_", ",", "zprod_", ",", "px1_", ",", "px2_", ",", 
       "py1_", ",", "py2_", ",", "pz1_", ",", "pz2_", ",", "zproj_"}], "]"}], 
     "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"xprod", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"zproj", "-", "zprod"}], ")"}], "*", 
         FractionBox[
          RowBox[{"(", 
           RowBox[{"px1", "+", "px2"}], ")"}], 
          RowBox[{"pz1", "+", "pz2"}]]}]}], ",", 
       RowBox[{"yprod", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"zproj", "-", "zprod"}], ")"}], "*", 
         FractionBox[
          RowBox[{"(", 
           RowBox[{"py1", "+", "py2"}], ")"}], 
          RowBox[{"pz1", "+", "pz2"}]]}]}], ",", "zproj"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Transverse", " ", "impact", " ", "parameter"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IPproductsSquared", "[", 
      RowBox[{
      "xprod_", ",", "yprod_", ",", "zprod_", ",", "px1_", ",", "px2_", ",", 
       "py1_", ",", "py2_", ",", "pz1_", ",", "pz2_", ",", "zproj_"}], "]"}], 
     "=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{
           RowBox[{"TrajectoryProducts", "[", 
            RowBox[{
            "xprod", ",", "yprod", ",", "zprod", ",", "px1", ",", "px2", ",", 
             "py1", ",", "py2", ",", "pz1", ",", "pz2", ",", "zproj"}], "]"}],
            "[", 
           RowBox[{"[", "1", "]"}], "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{
           RowBox[{"TrajectoryProducts", "[", 
            RowBox[{
            "xprod", ",", "yprod", ",", "zprod", ",", "px1", ",", "px2", ",", 
             "py1", ",", "py2", ",", "pz1", ",", "pz2", ",", "zproj"}], "]"}],
            "[", 
           RowBox[{"[", "2", "]"}], "]"}], "2"]}], "//", "Expand"}], "//", 
       "Simplify"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IPproductzTargetSquared", "[", 
      RowBox[{
      "xprod_", ",", "yprod_", ",", "zprod_", ",", "px1_", ",", "px2_", ",", 
       "py1_", ",", "py2_", ",", "pz1_", ",", "pz2_"}], "]"}], "=", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"IPproductsSquared", "[", 
        RowBox[{
        "xprod", ",", "yprod", ",", "zprod", ",", "px1", ",", "px2", ",", 
         "py1", ",", "py2", ",", "pz1", ",", "pz2", ",", "0"}], "]"}], "2"], "//",
       "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Spatial", " ", "separation", " ", 
     RowBox[{"cut", ":", " ", 
      RowBox[{"for", " ", "photons"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TrajectoryDifferenceProducts", "[", 
      RowBox[{
      "xprod_", ",", "yprod_", ",", "zprod_", ",", "px1_", ",", "px2_", ",", 
       "py1_", ",", "py2_", ",", "pz1_", ",", "pz2_", ",", "CoordProj_"}], 
      "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"CoordProj", "-", "zprod"}], ")"}], "*", 
         FractionBox["px1", "pz1"]}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"CoordProj", "-", "zprod"}], ")"}], "*", 
         FractionBox["px2", "pz2"]}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"CoordProj", "-", "zprod"}], ")"}], "*", 
         FractionBox["py1", "pz1"]}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"CoordProj", "-", "zprod"}], ")"}], "*", 
         FractionBox["py2", "pz2"]}]}], ",", "0."}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "For", " ", "the", " ", "experiments", " ", "for", " ", "which", " ", 
      "the", " ", "decay", " ", "volume", " ", "is", " ", "detector"}], ",", 
     " ", 
     RowBox[{
     "the", " ", "ECAL", " ", "position", " ", "is", " ", "formally", " ", 
      "assumed", " ", "to", " ", "be", " ", "at", " ", "the", " ", "end", " ",
       "of", " ", "the", " ", "decay", " ", "volume"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ecalpos", "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
       "DecayVolumeAsDetectorGivenExperiment", "\[Equal]", "\"\<False\>\""}], 
       ",", "ECALpositionGivenExperiment", ",", 
       "xLongMaxDetectorGivenExperiment"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SSproductsSquaredOld", "[", 
      RowBox[{
      "zprod_", ",", "px1_", ",", "px2_", ",", "py1_", ",", "py2_", ",", 
       "pz1_", ",", "pz2_", ",", "CoordProj_"}], "]"}], "=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{
           RowBox[{"TrajectoryDifferenceProducts", "[", 
            RowBox[{
            "xprod", ",", "yprod", ",", "zprod", ",", "px1", ",", "px2", ",", 
             "py1", ",", "py2", ",", "pz1", ",", "pz2", ",", "CoordProj"}], 
            "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{
           RowBox[{"TrajectoryDifferenceProducts", "[", 
            RowBox[{
            "xprod", ",", "yprod", ",", "zprod", ",", "px1", ",", "px2", ",", 
             "py1", ",", "py2", ",", "pz1", ",", "pz2", ",", "CoordProj"}], 
            "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "2"]}], "//", "Expand"}], "//", 
       "Simplify"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SSproductsSquared", "[", 
      RowBox[{"xfin1_", ",", "xfin2_", ",", "yfin1_", ",", "yfin2_"}], "]"}], 
     "=", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"xfin1", "-", "xfin2"}], ")"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"yfin1", "-", "yfin2"}], ")"}], "2"]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"minvProductsSquared", "[", 
      RowBox[{
      "px1_", ",", "py1_", ",", "pz1_", ",", "E1_", ",", "px2_", ",", "py2_", 
       ",", "pz2_", ",", "E2_"}], "]"}], "=", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"E1", "+", "E2"}], ")"}], "2"], "-", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"px1", "+", "px2"}], ")"}], "2"], "-", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"py1", "+", "py2"}], ")"}], "2"], "-", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"pz1", "+", "pz2"}], ")"}], "2"]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CosAngleProducts", "[", 
      RowBox[{
      "px1_", ",", "px2_", ",", "py1_", ",", "py2_", ",", "pz1_", ",", 
       "pz2_"}], "]"}], "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"p1", "=", 
          RowBox[{"{", 
           RowBox[{"px1", ",", "py1", ",", "pz1"}], "}"}]}], ",", 
         RowBox[{"p2", "=", 
          RowBox[{"{", 
           RowBox[{"px2", ",", "py2", ",", "pz2"}], "}"}]}]}], "}"}], ",", 
       FractionBox[
        RowBox[{"p1", ".", "p2"}], 
        RowBox[{
         RowBox[{"Norm", "[", "p1", "]"}], 
         RowBox[{"Norm", "[", "p2", "]"}]}]]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8933071952438316`*^9, 3.8933072032734623`*^9}, {
   3.8933074175295415`*^9, 3.893307434409528*^9}, {3.893307473098591*^9, 
   3.8933076920095034`*^9}, {3.8933077664095755`*^9, 3.893307813369112*^9}, {
   3.8933078933257732`*^9, 3.893307989519503*^9}, {3.893308142483653*^9, 
   3.893308315464196*^9}, {3.8933493197384043`*^9, 3.8933493199088306`*^9}, {
   3.893351168661603*^9, 3.8933511697337036`*^9}, {3.893385684282936*^9, 
   3.893385697900014*^9}, {3.893385832620135*^9, 3.893385839988839*^9}, {
   3.8933858732988167`*^9, 3.89338587598905*^9}, 3.893386094920165*^9, {
   3.8933867351629553`*^9, 3.8933867748254848`*^9}, {3.893386806678708*^9, 
   3.893386808478114*^9}, {3.8933868593890333`*^9, 3.8933868596480465`*^9}, 
   3.89339137759552*^9, {3.8934020326953444`*^9, 3.893402033553975*^9}, {
   3.8934021208059835`*^9, 3.8934021209381385`*^9}, {3.8934021777401266`*^9, 
   3.8934023413799915`*^9}, {3.893403069106703*^9, 3.8934031051278195`*^9}, {
   3.89342542261907*^9, 3.893425436031149*^9}, {3.8934270687581086`*^9, 
   3.8934271848120565`*^9}, {3.893427836860332*^9, 3.893427884192929*^9}, {
   3.893519495798237*^9, 3.8935195906546307`*^9}, {3.9055135347919893`*^9, 
   3.905513581143739*^9}, 3.910246320784568*^9, {3.9149936594716187`*^9, 
   3.914993734330103*^9}, {3.9186632629798784`*^9, 3.9186632833290434`*^9}, 
   3.9186639744413376`*^9, {3.9191364142624626`*^9, 3.9191364349619255`*^9}, {
   3.9347890537863503`*^9, 3.9347890546106*^9}, {3.934789128225256*^9, 
   3.934789129101299*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"2df153bd-ee90-fe40-8aca-2dbf7edd67fe"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Routine of calculating the decay acceptance", "Section",
 CellChangeTimes->{{3.891323732291453*^9, 3.89132374118683*^9}, {
   3.891323823354575*^9, 3.8913238234662757`*^9}, {3.893436795887788*^9, 
   3.8934368016086535`*^9}, 
   3.893436831726281*^9},ExpressionUUID->"6f9a29be-a698-0a43-9c20-\
918c01c3399f"],

Cell[CellGroupData[{

Cell["Trajectory of the decay products", "Subsection",
 CellChangeTimes->{{3.898614789891785*^9, 3.898614820307907*^9}, 
   3.90553199482168*^9},ExpressionUUID->"d9b253ca-177d-6b47-94d1-\
003e450d6c79"],

Cell[CellGroupData[{

Cell["No magnetic field", "Subsubsection",
 CellChangeTimes->{{3.8986148284352465`*^9, 
  3.898614831554184*^9}},ExpressionUUID->"1f8a2ef1-7ff1-d442-b4c2-\
842e73cd5575"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"FinalPlaneSign", "=", 
   RowBox[{"Sign", "[", "xLongMaxDetectorGivenExperiment", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MomDirection", "[", 
     RowBox[{"py_", ",", "pz_"}], "]"}], "=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
      "DetectorPlaneOrientationGivenExperiment", "\[Equal]", 
       "\"\<Transverse\>\""}], ",", "pz", ",", "py"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"LLP", "'"}], "s", " ", "decay", " ", "poing", " ", "as", " ", 
     "a", " ", "function", " ", "of", " ", "z"}], ",", "\[Theta]", ",", 
    "\[Phi]"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"LLPdecayVertex", "[", 
      RowBox[{"zLLP_", ",", "\[Theta]LLP_", ",", "\[Phi]LLP_"}], "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"LLPdecVTXatGivenZx", "[", 
        RowBox[{"zLLP", ",", "\[Theta]LLP", ",", "\[Phi]LLP"}], "]"}], ",", 
       RowBox[{"LLPdecVTXatGivenZy", "[", 
        RowBox[{"zLLP", ",", "\[Theta]LLP", ",", "\[Phi]LLP"}], "]"}], ",", 
       "zLLP"}], "}"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LLPdecayVertexX", "[", 
    RowBox[{"zLLP_", ",", "\[Theta]LLP_", ",", "\[Phi]LLP_"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"LLPdecVTXatGivenZx", "[", 
       RowBox[{"zLLP", ",", "\[Theta]LLP", ",", "\[Phi]LLP"}], "]"}], "/.", 
      " ", 
      RowBox[{
       RowBox[{"Cot", "[", "x_", "]"}], ":>", 
       RowBox[{"1", "/", 
        RowBox[{"Tan", "[", "x", "]"}]}]}]}], "/.", " ", 
     RowBox[{
      RowBox[{"Csc", "[", "x_", "]"}], ":>", 
      RowBox[{"1", "/", 
       RowBox[{"Sin", "[", "x", "]"}]}]}]}], "/.", 
    RowBox[{
     RowBox[{"Sec", "[", "x_", "]"}], "\[RuleDelayed]", 
     RowBox[{"1", "/", 
      RowBox[{"Cos", "[", "x", "]"}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LLPdecayVertexY", "[", 
    RowBox[{"zLLP_", ",", "\[Theta]LLP_", ",", "\[Phi]LLP_"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"LLPdecVTXatGivenZy", "[", 
       RowBox[{"zLLP", ",", "\[Theta]LLP", ",", "\[Phi]LLP"}], "]"}], "/.", 
      " ", 
      RowBox[{
       RowBox[{"Cot", "[", "x_", "]"}], ":>", 
       RowBox[{"1", "/", 
        RowBox[{"Tan", "[", "x", "]"}]}]}]}], "/.", " ", 
     RowBox[{
      RowBox[{"Csc", "[", "x_", "]"}], ":>", 
      RowBox[{"1", "/", 
       RowBox[{"Sin", "[", "x", "]"}]}]}]}], "/.", 
    RowBox[{
     RowBox[{"Sec", "[", "x_", "]"}], "\[RuleDelayed]", 
     RowBox[{"1", "/", 
      RowBox[{"Cos", "[", "x", "]"}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LLPdecayVertexZ", "[", 
    RowBox[{"zLLP_", ",", "\[Theta]LLP_", ",", "\[Phi]LLP_"}], "]"}], "=", 
   "zLLP"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"GivenExperiment", "!=", "\"\<ANUBIS-ceiling\>\""}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Trajectory", " ", "of", " ", "the", " ", 
      RowBox[{"daughter", "'"}], "s", " ", "particles", " ", "given", " ", 
      "the", " ", "LLP", " ", "decay", " ", "position", " ", "and", " ", 
      "the", " ", 
      RowBox[{"daughter", "'"}], "s", " ", "3"}], "-", 
     RowBox[{
     "momenta", " ", "in", " ", "the", " ", "lab", " ", "frame", " ", "of", 
      " ", "the", " ", "decaying", " ", "LLP"}], " ", "-", " ", 
     RowBox[{
     "at", " ", "the", " ", "position", " ", "of", " ", "the", " ", "final", 
      " ", "plane", " ", "of", " ", "the", " ", "detector"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DaughterTrajectory", "[", 
     RowBox[{
     "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "XlongProj_", 
      ",", "px_", ",", "py_", ",", "pz_"}], "]"}], "=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
      "DetectorPlaneOrientationGivenExperiment", "\[Equal]", 
       "\"\<Transverse\>\""}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"xLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"XlongProj", "-", "zLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"px", "/", "pz"}], ")"}]}]}], ",", 
        RowBox[{"yLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"XlongProj", "-", "zLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"py", "/", "pz"}], ")"}]}]}], ",", "XlongProj"}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"xLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"XlongProj", "-", "yLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"px", "/", "py"}], ")"}]}]}], ",", "XlongProj", ",", 
        RowBox[{"zLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"XlongProj", "-", "yLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"pz", "/", "py"}], ")"}]}]}]}], "}"}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "___", "___", "___", "___", "___", "___", "___", "___", "___", "___", 
     "___", "___", "___", "___", "_"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Projection", " ", "of", " ", "the", " ", "decay", " ", "products", " ", 
      "trajectory", " ", "onto", " ", "the", " ", "detector", " ", "final", 
      " ", "surface"}], " ", "-", " ", 
     RowBox[{"for", " ", "ANUBIS"}], "-", "ceiling"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "___", "___", "___", "___", "___", "___", "___", "___", "___", "___", 
     "___", "___", "___", "___", "_"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xx", "[", 
      RowBox[{"x0_", ",", "vx_", ",", "t_"}], "]"}], "=", 
     RowBox[{"x0", "+", 
      RowBox[{"vx", "*", "t"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"yy", "[", 
      RowBox[{"y0_", ",", "vy_", ",", "t_"}], "]"}], "=", 
     RowBox[{"y0", "+", 
      RowBox[{"vy", "*", "t"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"zz", "[", 
      RowBox[{"z0_", ",", "vz_", ",", "t_"}], "]"}], "=", 
     RowBox[{"z0", "+", 
      RowBox[{"vz", "*", "t"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "The", " ", "condition", " ", "that", " ", "the", " ", "trajectory", 
       " ", "intersects", " ", "the", " ", "surface", " ", "of", " ", "the", 
       " ", 
       RowBox[{"cavern", ".", " ", "Here"}]}], ",", " ", "xshift", ",", " ", 
      RowBox[{
      "yshift", " ", "are", " ", "just", " ", "the", " ", "shiftings", " ", 
       "of", " ", "the", " ", "beamline", " ", "from", " ", "the", " ", 
       "center", " ", "of", " ", "the", " ", "cavern", " ", "where", " ", 
       "ATLAS", " ", "is", " ", "located"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rho2", "[", 
      RowBox[{
      "x0_", ",", "y0_", ",", "vx_", ",", "vy_", ",", "t_", ",", "xshift_", 
       ",", "yshift_"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"xx", "[", 
            RowBox[{"x0", ",", "vx", ",", "t"}], "]"}], "+", "xshift"}], 
          ")"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yy", "[", 
            RowBox[{"y0", ",", "vy", ",", "t"}], "]"}], "+", "yshift"}], 
          ")"}], "2"]}], "//", "Expand"}], "//", "Simplify"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "The", " ", "moment", " ", "of", " ", "time", " ", "at", " ", "which", 
      " ", "the", " ", "trajectory", " ", "intersects", " ", "the", " ", 
      "surface", " ", "of", " ", "the", " ", "cavern"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tsol", "[", 
      RowBox[{
      "x0_", ",", "y0_", ",", "vx_", ",", "vy_", ",", "\[Rho]det_", ",", 
       "xshift_", ",", "yshift_"}], "]"}], "=", 
     RowBox[{"t", "/.", 
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"rho2", "[", 
          RowBox[{
          "x0", ",", "y0", ",", "vx", ",", "vy", ",", "t", ",", "xshift", ",",
            "yshift"}], "]"}], "==", 
         SuperscriptBox["\[Rho]det", "2"]}], ",", "t"}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "The", " ", "values", " ", "of", " ", "the", " ", "coordinates", " ", 
      "of", " ", "the", " ", "decay", " ", "product", " ", "at", " ", "this", 
      " ", "moment", " ", "of", " ", "time"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DaughterTrajectory", "[", 
      RowBox[{
      "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "XlongProj_", 
       ",", "px_", ",", "py_", ",", "pz_"}], "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"xx", "[", 
          RowBox[{"xLLPdecay", ",", "px", ",", 
           RowBox[{
            RowBox[{"tsol", "[", 
             RowBox[{"xLLPdecay", ",", "yLLPdecay", ",", "px", ",", "py", ",", 
              RowBox[{"RouterDecayVolumeGivenExperiment", "[", "z", "]"}], 
              ",", "xshiftval", ",", "yshiftval"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "//", "Expand"}], "//", 
        "Simplify"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"yy", "[", 
          RowBox[{"yLLPdecay", ",", "py", ",", 
           RowBox[{
            RowBox[{"tsol", "[", 
             RowBox[{"xLLPdecay", ",", "yLLPdecay", ",", "px", ",", "py", ",", 
              RowBox[{"RouterDecayVolumeGivenExperiment", "[", "z", "]"}], 
              ",", "xshiftval", ",", "yshiftval"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "//", "Expand"}], "//", 
        "Simplify"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"zz", "[", 
          RowBox[{"zLLPdecay", ",", "pz", ",", 
           RowBox[{
            RowBox[{"tsol", "[", 
             RowBox[{"xLLPdecay", ",", "yLLPdecay", ",", "px", ",", "py", ",", 
              RowBox[{"RouterDecayVolumeGivenExperiment", "[", "z", "]"}], 
              ",", "xshiftval", ",", "yshiftval"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "//", "Expand"}], "//", 
        "Simplify"}]}], "}"}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DaughterTrajectoryCoord1", "[", 
    RowBox[{
    "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "XlongProj_", 
     ",", "px_", ",", "py_", ",", "pz_"}], "]"}], "=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"FinalPlaneSign", "*", 
       RowBox[{"MomDirection", "[", 
        RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{"DaughterTrajectory", "[", 
        RowBox[{
        "xLLPdecay", ",", "yLLPdecay", ",", "zLLPdecay", ",", "XlongProj", 
         ",", "px", ",", "py", ",", "pz"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "99999."}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DaughterTrajectoryCoord2", "[", 
    RowBox[{
    "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "XlongProj_", 
     ",", "px_", ",", "py_", ",", "pz_"}], "]"}], "=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"FinalPlaneSign", "*", 
       RowBox[{"MomDirection", "[", 
        RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{"DaughterTrajectory", "[", 
        RowBox[{
        "xLLPdecay", ",", "yLLPdecay", ",", "zLLPdecay", ",", "XlongProj", 
         ",", "px", ",", "py", ",", "pz"}], "]"}], "[", 
       RowBox[{"[", "pointSecondCoordinate", "]"}], "]"}], "]"}], ",", 
     "99999."}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.898614978089488*^9, 3.898615077315208*^9}, {
   3.8986175229025187`*^9, 3.898617584515291*^9}, {3.9050596496106524`*^9, 
   3.9050596506849985`*^9}, {3.9050597026377735`*^9, 3.9050597359539022`*^9}, 
   3.905060520070547*^9, {3.905102078975509*^9, 3.9051020789868574`*^9}, {
   3.9102413157099667`*^9, 3.910241378089466*^9}, 3.910246320789631*^9, {
   3.915263683504957*^9, 3.915263703568968*^9}, {3.915263733878626*^9, 
   3.9152637449774914`*^9}, {3.9152638206065493`*^9, 
   3.9152638252248697`*^9}, {3.915263868838834*^9, 3.9152639075937576`*^9}, {
   3.9152939917117295`*^9, 3.9152939920077915`*^9}, {3.9154371516178536`*^9, 
   3.9154371519664435`*^9}, {3.9161281145029883`*^9, 3.916128117569877*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"3c57df6e-f583-ab43-8484-375cdc9169d8"],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     FractionBox[
      RowBox[{"px", " ", 
       RowBox[{"(", 
        RowBox[{"XlongProj", "-", "zLLPdecay"}], ")"}]}], "pz"], "+", 
     "xLLPdecay"}], ",", 
    RowBox[{
     FractionBox[
      RowBox[{"py", " ", 
       RowBox[{"(", 
        RowBox[{"XlongProj", "-", "zLLPdecay"}], ")"}]}], "pz"], "+", 
     "yLLPdecay"}], ",", "XlongProj"}], "}"}], TraditionalForm]], "Output",
 CellChangeTimes->{3.9161281203520956`*^9, 3.916128235011429*^9, 
  3.9199661244322977`*^9, 3.9493978774696236`*^9},
 CellLabel->
  "Out[458]=",ExpressionUUID->"9dad719a-28b6-a247-8078-06c9620466e8"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["With magnetic field", "Subsubsection",
 CellChangeTimes->{{3.8986148284352465`*^9, 
  3.898614837282953*^9}},ExpressionUUID->"0a9d31ae-4d51-204f-8451-\
59431965f657"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "The", " ", "magnetic", " ", "field", " ", "is", " ", "assumed", " ", "to",
     " ", "be", " ", "parallel", " ", "to", " ", "the", " ", "y", " ", 
    "axis"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "___", "___", "___", "___", "___", "___", "___", "___", "___", "___", 
    "___", "___", "___"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Trajectory", " ", "of", " ", "the", " ", 
      RowBox[{"daughter", "'"}], "s", " ", "particle", " ", "before", " ", 
      "being", " ", "affected", " ", "by", " ", "the", " ", "magnet", " ", 
      "at", " ", "z"}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"zProj", ".", " ", "It"}], " ", "is", " ", "a", " ", 
       "function", " ", "of", " ", "the", " ", "LLP", " ", "decay", " ", 
       "vertex", " ", "and", " ", "the", " ", 
       RowBox[{"daughter", "'"}], "s", " ", "kinematics", " ", "before", " ", 
       "the", " ", "magnet"}], " ", "-", " ", 
      SubscriptBox["p", "x"]}]}], ",", 
    SubscriptBox["p", "y"], ",", 
    SubscriptBox["p", "z"]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"For", " ", "the", " ", "x", " ", "coordinate"}], ",", " ", 
    RowBox[{
    "the", " ", "value", " ", "of", " ", "zProj", " ", "is", " ", "taken", 
     " ", "to", " ", "be", " ", "the", " ", "beginning", " ", "of", " ", 
     "the", " ", 
     RowBox[{"magnet", "/", "the"}], " ", 
     RowBox[{"LLP", "'"}], "s", " ", 
     SubscriptBox["z", "decay"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"here", " ", "and", " ", "below"}], ",", " ", 
       RowBox[{
        RowBox[{
        "it", " ", "is", " ", "always", " ", "assumed", " ", "that", " ", 
         SubscriptBox["z", "decay"]}], " ", ">", " ", 
        SubscriptBox["z", 
         RowBox[{"magnet", ",", "max"}]]}]}], ")"}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"For", " ", "the", " ", "y", " ", "coordinate"}], ",", " ", 
    RowBox[{
    "the", " ", "value", " ", "is", " ", "taken", " ", "to", " ", "be", " ", 
     "the", " ", "end", " ", "of", " ", "the", " ", 
     RowBox[{"magnet", ".", " ", "This"}], " ", "is", " ", "because", " ", 
     "it", " ", "is", " ", "assumed", " ", "for", " ", "simplicity", " ", 
     "that", " ", "the", " ", "evolution", " ", "of", " ", "the", " ", "y", 
     " ", "coordinate", " ", "up", " ", "to", " ", "the", " ", "end", " ", 
     "of", " ", "the", " ", "magnet", " ", "is", " ", "the", " ", "same", " ",
      "as", " ", "it", " ", "would", " ", "be", " ", "without", " ", "the", 
     " ", "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"LarmorRadiusGivenExperiment", "[", "EGeV_", "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<False\>\""}], 
       ",", "0", ",", 
       RowBox[{"LarmorRadius", "[", 
        RowBox[{"EGeV", ",", "Bval"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xAtMagnetStart", "[", 
      RowBox[{
      "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "px_", ",", 
       "py_", ",", "pz_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FinalPlaneSign", "*", 
         RowBox[{"MomDirection", "[", 
          RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"xLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"zMagnetMinGivenExperiment", ",", "zLLPdecay"}], "]"}], 
            "-", "zLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"px", "/", "pz"}], ")"}]}]}], "]"}], ",", "99999."}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "The", " ", "coordinate", " ", "2", " ", "is", " ", "assumed", " ", "to", 
     " ", "be", " ", "the", " ", "same", " ", "just", " ", "after", " ", 
     "the", " ", "magnet", " ", "as", " ", "if", " ", "there", " ", "would", 
     " ", "not", " ", "be", " ", "any", " ", "magnetic", " ", "field"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yAtMagnetEnd", "[", 
      RowBox[{
      "xLLPdecay_", ",", "yLLPdecay_", ",", "zLLPdecay_", ",", "px_", ",", 
       "py_", ",", "pz_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FinalPlaneSign", "*", 
         RowBox[{"MomDirection", "[", 
          RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"yLLPdecay", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"zMagnetMaxGivenExperiment", "-", "zLLPdecay"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"py", "/", "pz"}], ")"}]}]}], "]"}], ",", "99999."}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "___", "___", "___", "___", "___", "___", "___", "___", "___", "___", 
     "___", "___", "___", "___", "__"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Trajectory", " ", "of", " ", "the", " ", 
     RowBox[{"daughter", "'"}], "s", " ", "particle", " ", "after", " ", 
     "passing", " ", "the", " ", "domain", " ", "with", " ", "magnetic", " ", 
     "field"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "___", "___", "___", "___", "___", "___", "___", "___", "___", "___", 
     "___", "___", "___", "___", "__"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"The", " ", "x"}], "-", "coordinate"}], ",", " ", 
     RowBox[{"as", " ", "well", " ", "as", " ", "the", " ", "momenta", " ", 
      SubscriptBox["p", "x"]}], ",", 
     RowBox[{
      SubscriptBox["p", "z"], " ", "get", " ", "changed", " ", "depending", 
      " ", "on", " ", "the", " ", "charge", " ", "sign", " ", "of", " ", 
      "the", " ", 
      RowBox[{"particle", ".", " ", "This"}], " ", "is", " ", "taken", " ", 
      "into", " ", "account", " ", "by", " ", "kinking", " ", "of", " ", 
      "their", " ", "values"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xAtDetectorEndMagnetEffectTemp", "[", 
      RowBox[{
      "zLLPdecay_", ",", "xprojBeforeMagnet_", ",", "pxaftermagnet_", ",", 
       "py_", ",", "pzaftermagnet_", ",", "qval_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{
        RowBox[{
         RowBox[{"xHelicalApprox", "[", 
          RowBox[{"xprojBeforeMagnet", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"zMagnetMinGivenExperiment", ",", "zLLPdecay"}], "]"}], 
           ",", "pxaftermagnet", ",", "pzaftermagnet", ",", "Bval", ",", 
           "qval", ",", "zMagnetMaxGivenExperiment"}], "]"}], "//", 
         "Expand"}], "//", "Simplify"}], ",", "999999."}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yAtDetectorEndMagnetEffectTemp", "[", 
      RowBox[{
      "zLLPdecay_", ",", "yprojAfterMagnet_", ",", "py_", ",", 
       "pzaftermagnet_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{"yprojAfterMagnet", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
          "xLongMaxDetectorGivenExperiment", "-", 
           "zMagnetMaxGivenExperiment"}], ")"}], 
         RowBox[{"(", 
          RowBox[{"py", "/", "pzaftermagnet"}], ")"}]}]}], ",", "99999."}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pxAfterMagnet", "[", 
      RowBox[{"zLLPdecay_", ",", "px_", ",", "pz_", ",", "qval_"}], "]"}], 
     "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{"pxHelicalApprox", "[", 
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{"zLLPdecay", ",", "zMagnetMinGivenExperiment"}], "]"}], ",",
          "px", ",", "pz", ",", "Bval", ",", "qval", ",", 
         "zMagnetMaxGivenExperiment"}], "]"}], ",", "100000."}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pzAfterMagnet", "[", 
      RowBox[{"zLLPdecay_", ",", "px_", ",", "pz_", ",", "qval_"}], "]"}], 
     "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{"pzHelicalApprox", "[", 
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{"zLLPdecay", ",", "zMagnetMinGivenExperiment"}], "]"}], ",",
          "px", ",", "pz", ",", "Bval", ",", "qval", ",", 
         "zMagnetMaxGivenExperiment"}], "]"}], ",", "0.00001"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xAtDetectorEndMagnetEffect", "[", 
      RowBox[{
      "zLLPdecay_", ",", "xprojBeforeMagnet_", ",", "px_", ",", "py_", ",", 
       "pz_", ",", "qval_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FinalPlaneSign", "*", 
           RowBox[{"MomDirection", "[", 
            RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"xAtDetectorEndMagnetEffectTemp", "[", 
               RowBox[{"zLLPdecay", ",", "xprojBeforeMagnet", ",", 
                RowBox[{"pxAfterMagnet", "[", 
                 RowBox[{"zLLPdecay", ",", "px", ",", "pz", ",", "qval"}], 
                 "]"}], ",", "py", ",", 
                RowBox[{"pzAfterMagnet", "[", 
                 RowBox[{"zLLPdecay", ",", "px", ",", "pz", ",", "qval"}], 
                 "]"}], ",", "qval"}], "]"}], "//", "Simplify"}], ")"}], "/.",
             " ", 
            RowBox[{
             RowBox[{"Cot", "[", "x_", "]"}], ":>", 
             RowBox[{"1", "/", 
              RowBox[{"Tan", "[", "x", "]"}]}]}]}], "/.", " ", 
           RowBox[{
            RowBox[{"Csc", "[", "x_", "]"}], ":>", 
            RowBox[{"1", "/", 
             RowBox[{"Sin", "[", "x", "]"}]}]}]}], "]"}], ",", "99999."}], 
        "]"}], ",", "999999."}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yAtDetectorEndMagnetEffect", "[", 
      RowBox[{
      "zLLPdecay_", ",", "yprojAfterMagnet_", ",", "px_", ",", "py_", ",", 
       "pz_", ",", "qval_"}], "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"DipoleMagnetOptionGivenExperiment", "==", "\"\<True\>\""}], 
       ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FinalPlaneSign", "*", 
           RowBox[{"MomDirection", "[", 
            RowBox[{"py", ",", "pz"}], "]"}]}], ">", "0"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"yAtDetectorEndMagnetEffectTemp", "[", 
              RowBox[{"zLLPdecay", ",", "yprojAfterMagnet", ",", "py", ",", 
               RowBox[{"pzAfterMagnet", "[", 
                RowBox[{"zLLPdecay", ",", "px", ",", "pz", ",", "qval"}], 
                "]"}]}], "]"}], "/.", " ", 
             RowBox[{
              RowBox[{"Cot", "[", "x_", "]"}], ":>", 
              RowBox[{"1", "/", 
               RowBox[{"Tan", "[", "x", "]"}]}]}]}], "/.", " ", 
            RowBox[{
             RowBox[{"Csc", "[", "x_", "]"}], ":>", 
             RowBox[{"1", "/", 
              RowBox[{"Sin", "[", "x", "]"}]}]}]}], "//", "Simplify"}], "]"}],
          ",", "99999."}], "]"}], ",", "999999."}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8986148998175273`*^9, 3.8986149126960583`*^9}, {
   3.898614950786856*^9, 3.8986149781555157`*^9}, {3.898615090713854*^9, 
   3.8986150939927764`*^9}, {3.898615129813939*^9, 3.898615137591441*^9}, {
   3.898615177272547*^9, 3.898615187621873*^9}, {3.898615229545967*^9, 
   3.8986152788371277`*^9}, {3.8986153920715065`*^9, 
   3.8986153953710594`*^9}, {3.8986154328300467`*^9, 
   3.8986156569172697`*^9}, {3.898615753327162*^9, 3.898616101987913*^9}, {
   3.8986161442885065`*^9, 3.898616181571365*^9}, {3.8986167661397047`*^9, 
   3.898616831027446*^9}, {3.898616908613021*^9, 3.898617030688631*^9}, {
   3.8986170651961308`*^9, 3.8986173762547626`*^9}, {3.8986174289362993`*^9, 
   3.89861748850333*^9}, {3.8986175626819754`*^9, 3.898617583440949*^9}, {
   3.8987002702900033`*^9, 3.8987002771101446`*^9}, {3.898700850668104*^9, 
   3.8987008635169897`*^9}, {3.8987012898616943`*^9, 
   3.8987012973552027`*^9}, {3.902912877611253*^9, 3.9029128848144073`*^9}, {
   3.9029151757034235`*^9, 3.902915245191349*^9}, {3.905505402555734*^9, 
   3.9055054076948338`*^9}, 3.910246320789631*^9, {3.91543715197209*^9, 
   3.9154371520997596`*^9}, {3.91612812599009*^9, 3.9161281439072056`*^9}, {
   3.916130225014806*^9, 3.9161302252290354`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"63b97567-09ce-3b48-9367-f5d06342a263"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Blocks computing various cuts", "Subsection",
 CellChangeTimes->{{3.905532004482563*^9, 3.9055320148212833`*^9}, {
  3.9055320746103935`*^9, 3.9055320812728267`*^9}, {3.9055341476241693`*^9, 
  3.905534153508107*^9}, {3.9154362650657945`*^9, 
  3.9154362702977705`*^9}},ExpressionUUID->"fdb43a30-b319-f74d-8f9b-\
b06d46e0a0b9"],

Cell[CellGroupData[{

Cell["Particular decay product - geometric part", "Subsubsection",
 CellChangeTimes->{{3.905532022451865*^9, 3.905532027175404*^9}, {
  3.9055320835244646`*^9, 3.9055320853151717`*^9}, {3.905534086867423*^9, 
  3.905534090497462*^9}},ExpressionUUID->"18245b5b-febe-3142-abb1-\
109cbfa1cc35"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"conditionDecayAcceptanceGeometric", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Hold", "@", 
       RowBox[{"Compile", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"charge1", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"xdecayfip", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"ydecayfip", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"E1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"zmagnMzfip", ",", "_Real"}], "}"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cond", "=", "0."}], ",", "FirstCoordinateProduct1", ",",
              "SecondCoordinateProduct1", ",", 
             RowBox[{"xAtMagnetStartProduct1", "=", "0."}], ",", 
             RowBox[{"yAfterMagnetProduct1", "=", "0."}], ",", 
             RowBox[{"xFinalPlaneProduct1", "=", "0."}], ",", 
             RowBox[{"yFinalPlaneProduct1", "=", "0."}], ",", 
             RowBox[{"xLongProjVal", "=", "0."}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Depending", " ", "on", " ", "pdg", " ", "id"}], ",", 
             " ", 
             RowBox[{
             "the", " ", "final", " ", "plane", " ", "required", " ", "to", 
              " ", "be", " ", "reached", " ", "in", " ", "order", " ", "to", 
              " ", "be", " ", "reconstructed"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"xLongProjVal", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "pdg1", "]"}], "==", "13."}], ",", 
               "xLongMuonPlaneGivenExperiment", ",", 
               "xLongNonMuonPlaneGivenExperiment"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "If", " ", "product", " ", "is", " ", "uncharged", " ", "OR", 
               " ", "there", " ", "is", " ", "no", " ", "magnet", " ", "OR", 
               " ", "the", " ", "LLP", " ", "decays", " ", "after", " ", 
               "the", " ", "region", " ", "with", " ", "the", " ", "magnetic",
                " ", "field"}], ",", " ", 
              RowBox[{
              "then", " ", "the", " ", "trajectory", " ", "of", " ", "the", 
               " ", "decay", " ", "product", " ", "is", " ", "a", " ", 
               "straight", " ", "line", " ", "and", " ", "the", " ", "decay", 
               " ", "acceptance", " ", "may", " ", "be", " ", "easily", " ", 
               "computed"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Bval", "==", "0"}], "||", 
               RowBox[{"charge1", "==", "0."}], "||", 
               RowBox[{"zmagnMzfip", "<", "0"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Coordinates", " ", "of", " ", "the", " ", "decay", " ", 
                "products", " ", "at", " ", "the", " ", "detector", " ", 
                "plane"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"xFinalPlaneProduct1", "=", 
                RowBox[{"DaughterTrajectoryCoord1", "[", 
                 RowBox[{
                 "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", 
                  "xLongProjVal", ",", "px1lab", ",", "py1lab", ",", 
                  "pz1lab"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"yFinalPlaneProduct1", "=", 
                RowBox[{"DaughterTrajectoryCoord2", "[", 
                 RowBox[{
                 "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", 
                  "xLongProjVal", ",", "px1lab", ",", "py1lab", ",", 
                  "pz1lab"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Condition", " ", "whether", " ", "product1", " ", 
                 "intersects", " ", "the", " ", "detector"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"cond", "=", 
                RowBox[{"DecayAcceptanceGeometry", "[", 
                 RowBox[{
                 "xFinalPlaneProduct1", ",", "yFinalPlaneProduct1", ",", 
                  "xLongProjVal"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
              ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "If", " ", "the", " ", "magnetic", " ", "field", " ", "and", 
                  " ", "electric", " ", "charge", " ", "of", " ", "the", " ", 
                  "product", " ", "are", " ", "non"}], "-", 
                 RowBox[{
                 "zero", " ", "AND", " ", "the", " ", "LLP", " ", "decays", 
                  " ", "before", " ", "the", " ", "end", " ", "of", " ", 
                  "the", " ", "magnet"}]}], ",", " ", 
                RowBox[{
                "then", " ", "the", " ", "trajectory", " ", "is", " ", 
                 "affected", " ", "by", " ", "the", " ", "magnetic", " ", 
                 RowBox[{"field", ".", " ", "However"}]}], ",", " ", 
                RowBox[{"to", " ", "be", " ", "affected"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "If", " ", "the", " ", "product", " ", "has", " ", "large", 
                 " ", "enough", " ", "energy", " ", 
                 RowBox[{"(", 
                  RowBox[{"==", " ", 
                   RowBox[{
                   "Larmor", " ", "radius", " ", "is", " ", "smaller", " ", 
                    "than", " ", "the", " ", "domain", " ", "with", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], ")"}]}], ",", 
                " ", 
                RowBox[{
                "proceed", " ", "to", " ", "the", " ", "acceptance", " ", 
                 "routine", " ", "calculation"}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"LarmorRadiusGivenExperiment", "[", "E1lab", "]"}], 
                  ">", "zmagnMzfip"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "x", " ", "coordinate", " ", "of", " ", "the", " ", 
                    "decay", " ", "products", " ", "just", " ", "before", " ",
                     "the", " ", "magnet", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    "or", " ", "at", " ", "the", " ", "LLP", " ", "decay", 
                    " ", "point", " ", "if", " ", "it", " ", "is", " ", 
                    "inside", " ", "the", " ", "magnet"}], ")"}]}], ",", " ", 
                   RowBox[{
                   "and", " ", "y", " ", "coordinate", " ", "at", " ", "the", 
                    " ", "end", " ", "of", " ", "the", " ", 
                    RowBox[{"magnet", ".", " ", "Due"}], " ", "to", " ", 
                    "the", " ", "approximation"}], ",", " ", 
                   RowBox[{
                   "the", " ", "mentioned", " ", "y", " ", "coordinate", " ", 
                    "is", " ", "unaffected", " ", "by", " ", "the", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"xAtMagnetStartProduct1", "=", 
                   RowBox[{"xAtMagnetStart", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", "px1lab",
                     ",", "py1lab", ",", "pz1lab"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"yAfterMagnetProduct1", "=", 
                   RowBox[{"yAtMagnetEnd", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", "px1lab",
                     ",", "py1lab", ",", "pz1lab"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "These", " ", "coordinates", " ", "must", " ", "be", " ", 
                    "within", " ", "the", " ", "detector", " ", 
                    RowBox[{"coverage", ".", " ", "Here"}], " ", "it", " ", 
                    "is", " ", "assumed", " ", "that", " ", "the", " ", 
                    "transverse", " ", "size", " ", "of", " ", "the", " ", 
                    "magnet", " ", "does", " ", "not", " ", "change", " ", 
                    "from", " ", 
                    SubscriptBox["z", 
                    RowBox[{"magnet", ",", "min"}]], " ", "to", " ", 
                    SubscriptBox["z", 
                    RowBox[{"magnet", ",", "max"}]]}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"cond", "=", 
                   RowBox[{"DecayAcceptanceGeometry", "[", 
                    RowBox[{
                    "xAtMagnetStartProduct1", ",", "yAfterMagnetProduct1", 
                    ",", "zMagnetMaxGivenExperiment"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{
                    "If", " ", "this", " ", "is", " ", "the", " ", "case"}], 
                    ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "routine", " ", "below", " ", 
                    "evaluates", " ", "the", " ", "change", " ", "of", " ", 
                    "the", " ", "trajectory", " ", "due", " ", "to", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Coordinates", " ", "x"}], ",", 
                    RowBox[{"y", " ", "at", " ", "the", " ", "final", " ", 
                    RowBox[{"plane", ".", " ", "Both"}], " ", "of", " ", 
                    "them", " ", "are", " ", "affected", " ", "by", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "The", " ", "x", " ", "coordinate", " ", "gets", " ", 
                    "affected", " ", "by", " ", "a", " ", "kick", " ", "in", 
                    " ", "x"}], ",", 
                    SubscriptBox["p", "x"], ",", 
                    RowBox[{
                    SubscriptBox["p", "z"], " ", "after", " ", "the", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "y", " ", "coordinate", " ", "gets", " ", 
                    "affected", " ", "by", " ", "a", " ", "kick", " ", "in", 
                    " ", 
                    SubscriptBox["p", "z"], " ", "after", " ", "the", " ", 
                    "magnet"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"xFinalPlaneProduct1", "=", 
                    RowBox[{"xAtDetectorEndMagnetEffect", "[", 
                    RowBox[{
                    "zfip", ",", "xAtMagnetStartProduct1", ",", "px1lab", ",",
                     "py1lab", ",", "pz1lab", ",", "charge1"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"yFinalPlaneProduct1", "=", 
                    RowBox[{"yAtDetectorEndMagnetEffect", "[", 
                    RowBox[{
                    "zfip", ",", "yAfterMagnetProduct1", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "charge1"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Condition", " ", "whether", " ", "decay", " ", 
                    "products", " ", "intersect", " ", "the", " ", "detector",
                     " ", "and", " ", "have", " ", "large", " ", "enough", 
                    " ", "energy"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "first", " ", "condition", " ", "corresponds",
                     " ", "to", " ", "the", " ", "requirement", " ", "that", 
                    " ", "x", " ", "before", " ", "the", " ", "magnet", " ", 
                    "and", " ", "y", " ", "after", " ", "the", " ", "magnet", 
                    " ", "are", " ", "within", " ", "the", " ", "detector"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "The", " ", "second", " ", "one", " ", "requires", " ", 
                    "that", " ", "kicked", " ", "x"}], ",", " ", 
                    RowBox[{"y", " ", "at", " ", 
                    SubscriptBox["z", 
                    RowBox[{"final", " "}]], "are", " ", "within", " ", "the",
                     " ", "detector"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"DecayAcceptanceGeometry", "[", 
                    RowBox[{
                    "xFinalPlaneProduct1", ",", "yFinalPlaneProduct1", ",", 
                    "xLongProjVal"}], "]"}]}]}]}], "]"}]}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "If", " ", "the", " ", "product", " ", "has", " ", "too", 
                    " ", "low", " ", "energy", " ", 
                    RowBox[{"(", 
                    RowBox[{"==", " ", 
                    RowBox[{
                    "Larmor", " ", "radius", " ", "is", " ", "smaller", " ", 
                    "than", " ", "the", " ", "domain", " ", "with", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], ")"}]}], ",", 
                   " ", 
                   RowBox[{
                   "it", " ", "would", " ", "be", " ", "trapped", " ", 
                    "inside", " ", "the", " ", "magnetic", " ", 
                    RowBox[{"field", ".", " ", "In"}], " ", "this", " ", 
                    "case"}], ",", " ", 
                   RowBox[{"acceptance", " ", "=", " ", "0"}]}], "*)"}], 
                 "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"cond", "=", "0."}]}], "\[IndentingNewLine]", "]"}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
             "cond", ",", "xFinalPlaneProduct1", ",", "yFinalPlaneProduct1"}],
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
         RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
         RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
         RowBox[{"RuntimeAttributes", "->", 
          RowBox[{"{", "Listable", "}"}]}], ",", 
         RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
      RowBox[{"ruleDown", "[", 
       RowBox[{"{", 
        RowBox[{
        "DaughterTrajectoryCoord1", ",", "DaughterTrajectoryCoord2", ",", 
         "DecayAcceptanceGeometry", ",", "xAtDetectorEndMagnetEffect", ",", 
         "yAtDetectorEndMagnetEffect", ",", "xAtMagnetStart", ",", 
         "yAtMagnetEnd", ",", "LarmorRadiusGivenExperiment"}], "}"}], "]"}]}],
      "/.", 
     RowBox[{"ruleOwn", "[", 
      RowBox[{"{", 
       RowBox[{
       "Bval", ",", "xLongMuonPlaneGivenExperiment", ",", 
        "xLongNonMuonPlaneGivenExperiment", ",", 
        "zMagnetMaxGivenExperiment"}], "}"}], "]"}]}], "//", 
    "ReleaseHold"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionDecayAcceptanceGeometric"}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.905533887197404*^9, {3.910241569630865*^9, 3.910241603711719*^9}, {
   3.9102416680806513`*^9, 3.9102417664708004`*^9}, {3.91024180291088*^9, 
   3.9102418259897795`*^9}, {3.910241870019837*^9, 3.910241934411228*^9}, {
   3.910242055549712*^9, 3.9102421769202213`*^9}, {3.9102422302898254`*^9, 
   3.910242320008681*^9}, 3.9102490751197577`*^9, {3.9102497020484796`*^9, 
   3.910249708448292*^9}, {3.910249764538303*^9, 3.910249779978406*^9}, {
   3.915437152108829*^9, 3.9154371521185308`*^9}, 3.9190101678204937`*^9, {
   3.9190684875446663`*^9, 3.919068516898288*^9}, {3.941003167442953*^9, 
   3.9410031819126625`*^9}, 3.941015029574093*^9, {3.941015500786337*^9, 
   3.9410155101966553`*^9}, {3.9410155801957073`*^9, 
   3.9410155864606533`*^9}, {3.94101563732802*^9, 3.9410156538306656`*^9}, {
   3.941015882519882*^9, 3.941015943587414*^9}, {3.9410160541741753`*^9, 
   3.9410160668233433`*^9}, 3.9515551657884884`*^9, 3.951555782849121*^9},
 CellLabel->"In[63]:=",ExpressionUUID->"4362caac-e623-0e49-9cb6-510992d1fc49"],

Cell[CellGroupData[{

Cell["For EventCalc", "Item",
 CellChangeTimes->{{3.9496526344725647`*^9, 
  3.949652636807022*^9}},ExpressionUUID->"46406f3f-49dc-b240-822f-\
7d87360296b6"],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{"EventCalc", ",", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"ifBelledi", "||", "ifCMSdi"}], ")"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"conditionDecayAcceptanceGeometric", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "@", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"charge1", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"xdecayfip", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"ydecayfip", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"E1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"zmagnMzfip", ",", "_Real"}], "}"}]}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"cond", "=", "0."}], ",", "FirstCoordinateProduct1", 
                 ",", "SecondCoordinateProduct1", ",", 
                 RowBox[{"xAtMagnetStartProduct1", "=", "0."}], ",", 
                 RowBox[{"yAfterMagnetProduct1", "=", "0."}], ",", 
                 RowBox[{"xFinalPlaneProduct1", "=", "0."}], ",", 
                 RowBox[{"yFinalPlaneProduct1", "=", "0."}], ",", 
                 RowBox[{"xLongProjVal", "=", "0."}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Depending", " ", "on", " ", "pdg", " ", "id"}], ",",
                  " ", 
                 RowBox[{
                 "the", " ", "final", " ", "plane", " ", "required", " ", 
                  "to", " ", "be", " ", "reached", " ", "in", " ", "order", 
                  " ", "to", " ", "be", " ", "reconstructed"}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"xLongProjVal", "=", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"pz1lab", "<", "0"}], ",", "zDetMinNegative", ",", 
                   "zDetMinPositive"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{
                  "If", " ", "product", " ", "is", " ", "uncharged", " ", 
                   "OR", " ", "there", " ", "is", " ", "no", " ", "magnet", 
                   " ", "OR", " ", "the", " ", "LLP", " ", "decays", " ", 
                   "after", " ", "the", " ", "region", " ", "with", " ", 
                   "the", " ", "magnetic", " ", "field"}], ",", " ", 
                  RowBox[{
                  "then", " ", "the", " ", "trajectory", " ", "of", " ", 
                   "the", " ", "decay", " ", "product", " ", "is", " ", "a", 
                   " ", "straight", " ", "line", " ", "and", " ", "the", " ", 
                   "decay", " ", "acceptance", " ", "may", " ", "be", " ", 
                   "easily", " ", "computed"}]}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Bval", "==", "0"}], "||", 
                   RowBox[{"charge1", "==", "0."}], "||", 
                   RowBox[{"zmagnMzfip", "<", "0"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Coordinates", " ", "of", " ", "the", " ", "decay", " ", 
                    "products", " ", "at", " ", "the", " ", "detector", " ", 
                    "plane"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"xFinalPlaneProduct1", "=", 
                    RowBox[{"DaughterTrajectoryCoord1", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", 
                    "xLongProjVal", ",", "px1lab", ",", "py1lab", ",", 
                    "pz1lab"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"yFinalPlaneProduct1", "=", 
                    RowBox[{"DaughterTrajectoryCoord2", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", 
                    "xLongProjVal", ",", "px1lab", ",", "py1lab", ",", 
                    "pz1lab"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Condition", " ", "whether", " ", "product1", " ", 
                    "intersects", " ", "the", " ", "detector"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"cond", "=", 
                    RowBox[{"DecayAcceptanceGeometry", "[", 
                    RowBox[{
                    "xFinalPlaneProduct1", ",", "yFinalPlaneProduct1", ",", 
                    "xLongProjVal"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "magnetic", " ", "field", " ", 
                    "and", " ", "electric", " ", "charge", " ", "of", " ", 
                    "the", " ", "product", " ", "are", " ", "non"}], "-", 
                    RowBox[{
                    "zero", " ", "AND", " ", "the", " ", "LLP", " ", "decays",
                     " ", "before", " ", "the", " ", "end", " ", "of", " ", 
                    "the", " ", "magnet"}]}], ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "trajectory", " ", "is", " ", 
                    "affected", " ", "by", " ", "the", " ", "magnetic", " ", 
                    RowBox[{"field", ".", " ", "However"}]}], ",", " ", 
                    RowBox[{"to", " ", "be", " ", "affected"}]}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "product", " ", "has", " ", 
                    "large", " ", "enough", " ", "energy", " ", 
                    RowBox[{"(", 
                    RowBox[{"==", " ", 
                    RowBox[{
                    "Larmor", " ", "radius", " ", "is", " ", "smaller", " ", 
                    "than", " ", "the", " ", "domain", " ", "with", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], ")"}]}], ",", 
                    " ", 
                    RowBox[{
                    "proceed", " ", "to", " ", "the", " ", "acceptance", " ", 
                    "routine", " ", "calculation"}]}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "LarmorRadiusGivenExperiment", "[", "E1lab", "]"}], ">", 
                    "zmagnMzfip"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "x", " ", "coordinate", " ", "of", " ", "the", " ", 
                    "decay", " ", "products", " ", "just", " ", "before", " ",
                     "the", " ", "magnet", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    "or", " ", "at", " ", "the", " ", "LLP", " ", "decay", 
                    " ", "point", " ", "if", " ", "it", " ", "is", " ", 
                    "inside", " ", "the", " ", "magnet"}], ")"}]}], ",", " ", 
                    RowBox[{
                    "and", " ", "y", " ", "coordinate", " ", "at", " ", "the",
                     " ", "end", " ", "of", " ", "the", " ", 
                    RowBox[{"magnet", ".", " ", "Due"}], " ", "to", " ", 
                    "the", " ", "approximation"}], ",", " ", 
                    RowBox[{
                    "the", " ", "mentioned", " ", "y", " ", "coordinate", " ",
                     "is", " ", "unaffected", " ", "by", " ", "the", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"xAtMagnetStartProduct1", "=", 
                    RowBox[{"xAtMagnetStart", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", "px1lab",
                     ",", "py1lab", ",", "pz1lab"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"yAfterMagnetProduct1", "=", 
                    RowBox[{"yAtMagnetEnd", "[", 
                    RowBox[{
                    "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", "px1lab",
                     ",", "py1lab", ",", "pz1lab"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "These", " ", "coordinates", " ", "must", " ", "be", " ", 
                    "within", " ", "the", " ", "detector", " ", 
                    RowBox[{"coverage", ".", " ", "Here"}], " ", "it", " ", 
                    "is", " ", "assumed", " ", "that", " ", "the", " ", 
                    "transverse", " ", "size", " ", "of", " ", "the", " ", 
                    "magnet", " ", "does", " ", "not", " ", "change", " ", 
                    "from", " ", 
                    SubscriptBox["z", 
                    RowBox[{"magnet", ",", "min"}]], " ", "to", " ", 
                    SubscriptBox["z", 
                    RowBox[{"magnet", ",", "max"}]]}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"DecayAcceptanceGeometry", "[", 
                    RowBox[{
                    "xAtMagnetStartProduct1", ",", "yAfterMagnetProduct1", 
                    ",", "zMagnetMaxGivenExperiment"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "this", " ", "is", " ", "the", " ", "case"}], 
                    ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "routine", " ", "below", " ", 
                    "evaluates", " ", "the", " ", "change", " ", "of", " ", 
                    "the", " ", "trajectory", " ", "due", " ", "to", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Coordinates", " ", "x"}], ",", 
                    RowBox[{"y", " ", "at", " ", "the", " ", "final", " ", 
                    RowBox[{"plane", ".", " ", "Both"}], " ", "of", " ", 
                    "them", " ", "are", " ", "affected", " ", "by", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "The", " ", "x", " ", "coordinate", " ", "gets", " ", 
                    "affected", " ", "by", " ", "a", " ", "kick", " ", "in", 
                    " ", "x"}], ",", 
                    SubscriptBox["p", "x"], ",", 
                    RowBox[{
                    SubscriptBox["p", "z"], " ", "after", " ", "the", " ", 
                    "magnet"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "y", " ", "coordinate", " ", "gets", " ", 
                    "affected", " ", "by", " ", "a", " ", "kick", " ", "in", 
                    " ", 
                    SubscriptBox["p", "z"], " ", "after", " ", "the", " ", 
                    "magnet"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"xFinalPlaneProduct1", "=", 
                    RowBox[{"xAtDetectorEndMagnetEffect", "[", 
                    RowBox[{
                    "zfip", ",", "xAtMagnetStartProduct1", ",", "px1lab", ",",
                     "py1lab", ",", "pz1lab", ",", "charge1"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"yFinalPlaneProduct1", "=", 
                    RowBox[{"yAtDetectorEndMagnetEffect", "[", 
                    RowBox[{
                    "zfip", ",", "yAfterMagnetProduct1", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "charge1"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Condition", " ", "whether", " ", "decay", " ", 
                    "products", " ", "intersect", " ", "the", " ", "detector",
                     " ", "and", " ", "have", " ", "large", " ", "enough", 
                    " ", "energy"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "first", " ", "condition", " ", "corresponds",
                     " ", "to", " ", "the", " ", "requirement", " ", "that", 
                    " ", "x", " ", "before", " ", "the", " ", "magnet", " ", 
                    "and", " ", "y", " ", "after", " ", "the", " ", "magnet", 
                    " ", "are", " ", "within", " ", "the", " ", "detector"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "The", " ", "second", " ", "one", " ", "requires", " ", 
                    "that", " ", "kicked", " ", "x"}], ",", " ", 
                    RowBox[{"y", " ", "at", " ", 
                    SubscriptBox["z", 
                    RowBox[{"final", " "}]], "are", " ", "within", " ", "the",
                     " ", "detector"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"DecayAcceptanceGeometry", "[", 
                    RowBox[{
                    "xFinalPlaneProduct1", ",", "yFinalPlaneProduct1", ",", 
                    "xLongProjVal"}], "]"}]}]}]}], "]"}]}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "product", " ", "has", " ", "too", 
                    " ", "low", " ", "energy", " ", 
                    RowBox[{"(", 
                    RowBox[{"==", " ", 
                    RowBox[{
                    "Larmor", " ", "radius", " ", "is", " ", "smaller", " ", 
                    "than", " ", "the", " ", "domain", " ", "with", " ", 
                    "the", " ", "magnetic", " ", "field"}]}], ")"}]}], ",", 
                    " ", 
                    RowBox[{
                    "it", " ", "would", " ", "be", " ", "trapped", " ", 
                    "inside", " ", "the", " ", "magnetic", " ", 
                    RowBox[{"field", ".", " ", "In"}], " ", "this", " ", 
                    "case"}], ",", " ", 
                    RowBox[{"acceptance", " ", "=", " ", "0"}]}], "*)"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", "0."}]}], "\[IndentingNewLine]", 
                    "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{
                 "cond", ",", "xFinalPlaneProduct1", ",", 
                  "yFinalPlaneProduct1"}], "}"}]}]}], "\[IndentingNewLine]", 
              "]"}], ",", 
             RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
             RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
             RowBox[{"RuntimeAttributes", "->", 
              RowBox[{"{", "Listable", "}"}]}], ",", 
             RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
          RowBox[{"ruleDown", "[", 
           RowBox[{"{", 
            RowBox[{
            "DaughterTrajectoryCoord1", ",", "DaughterTrajectoryCoord2", ",", 
             "DecayAcceptanceGeometry", ",", "xAtDetectorEndMagnetEffect", 
             ",", "yAtDetectorEndMagnetEffect", ",", "xAtMagnetStart", ",", 
             "yAtMagnetEnd", ",", "LarmorRadiusGivenExperiment"}], "}"}], 
           "]"}]}], "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", 
           RowBox[{
           "Bval", ",", "xLongMuonPlaneGivenExperiment", ",", 
            "xLongNonMuonPlaneGivenExperiment", ",", 
            "zMagnetMaxGivenExperiment", ",", "zDetMinNegative", ",", 
            "zDetMinPositive"}], "}"}], "]"}]}], "//", "ReleaseHold"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"<<", "CompiledFunctionTools`"}], ";", "\n", 
      RowBox[{"CompilePrint", "@", "conditionDecayAcceptanceGeometric"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.949652639177452*^9, 3.949652668836941*^9}, {
  3.949652983310446*^9, 3.9496530140817337`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"af8499ee-5824-3047-85a7-ff3284a1791e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Decay products pair - Energy cut", "Subsubsection",
 CellChangeTimes->{{3.9055320949676332`*^9, 3.905532096895308*^9}, {
  3.905532540249052*^9, 3.9055325418192863`*^9}, {3.9055340991757836`*^9, 
  3.9055341053457465`*^9}},ExpressionUUID->"b06d2851-a7ba-e34d-82b5-\
c49a68d8007a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"distff", "[", "\[Sigma]_", "]"}], "=", 
   RowBox[{"ProbabilityDistribution", "[", 
    RowBox[{
     RowBox[{
      FractionBox["1", 
       RowBox[{
        SqrtBox[
         RowBox[{"2", "*", "Pi"}]], "\[Sigma]"}]], 
      RowBox[{"Exp", "[", 
       RowBox[{"-", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", "x", ")"}], "2"], 
         RowBox[{"2", 
          SuperscriptBox["\[Sigma]", "2"]}]]}], "]"}]}], " ", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "Infinity"}], ",", "Infinity"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InverseCDFffplus", "[", 
    RowBox[{"\[Sigma]_", ",", "u_"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"InverseCDF", "[", 
      RowBox[{
       RowBox[{"distff", "[", "\[Sigma]", "]"}], ",", "u"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enres", "[", "Eval_", "]"}], "=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"GivenExperiment", "==", "\"\<SHiNESS\>\""}], ",", 
     FractionBox["0.15", 
      SqrtBox[
       RowBox[{
        SuperscriptBox["10", "3"], "Eval"}]]]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conditionEnergyCuts", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ecutLowerid", "=", "ecutLowerID"}], ",", 
       RowBox[{"ecutUpperid", "=", "ecutUpperID"}], ",", 
       RowBox[{"EtotCutLowerid", "=", "EtotCutLowerID"}], ",", 
       RowBox[{"EtotCutUpperid", "=", "EtotCutUpperID"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Hold", "@", 
        RowBox[{"Compile", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"charge1", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"E1lab", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"E2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "ecutlow1", ",", "ecutlow2", ",", "ecutup1", ",", "ecutup2", ",", 
              RowBox[{"ecuttotlow", "=", "eTotCutLowerZero"}], ",", 
              RowBox[{"ecuttotupp", "=", "eTotCutUpperZero"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ecutlow1", "=", 
              RowBox[{"ecutLowerid", "[", 
               RowBox[{"pdg1", ",", "charge1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ecutlow2", "=", 
              RowBox[{"ecutLowerid", "[", 
               RowBox[{"pdg2", ",", "charge1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ecutup1", "=", 
              RowBox[{"ecutUpperid", "[", 
               RowBox[{"pdg1", ",", "charge1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ecutup2", "=", 
              RowBox[{"ecutUpperid", "[", 
               RowBox[{"pdg2", ",", "charge1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"IfEtotLowercuts", "==", "1"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"ecuttotlow", "=", 
                RowBox[{"EtotCutLowerid", "[", 
                 RowBox[{"pdg1", ",", "charge1", ",", "pdg2"}], "]"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"IfEtotUppercuts", "==", "1"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"ecuttotupp", "=", 
                RowBox[{"EtotCutUpperid", "[", 
                 RowBox[{"pdg1", ",", "charge1", ",", "pdg2"}], "]"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Boole", "[", 
              RowBox[{
               RowBox[{"ecutlow1", "<=", "E1lab", "<=", "ecutup1"}], "&&", 
               RowBox[{"ecutlow2", "<=", "E2lab", "<=", "ecutup2"}], "&&", 
               RowBox[{"ecuttotlow", "<=", 
                RowBox[{"E1lab", "+", "E2lab"}], "<=", "ecuttotupp"}]}], 
              "]"}]}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
          RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
          RowBox[{"RuntimeAttributes", "->", 
           RowBox[{"{", "Listable", "}"}]}], ",", 
          RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
       RowBox[{"ruleOwn", "[", 
        RowBox[{"{", 
         RowBox[{
         "eTotCutLowerZero", ",", "eTotCutUpperZero", ",", "IfEtotLowercuts", 
          ",", "IfEtotUppercuts"}], "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionEnergyCuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9055321545666084`*^9, 3.905532308371714*^9}, {
   3.9055323848426237`*^9, 3.9055324645536222`*^9}, {3.9055325115442104`*^9, 
   3.9055325339285145`*^9}, 3.905533847673461*^9, 3.9055338845804467`*^9, {
   3.9056674361712217`*^9, 3.9056674462085285`*^9}, {3.9056739258987217`*^9, 
   3.905673937160644*^9}, {3.9058412485693026`*^9, 3.905841253902861*^9}, {
   3.905841284005067*^9, 3.9058413187161975`*^9}, {3.9058413781832232`*^9, 
   3.9058414100958643`*^9}, {3.905846696782211*^9, 3.9058467605940037`*^9}, {
   3.906801176497629*^9, 3.906801179548951*^9}, {3.910176120818011*^9, 
   3.9101761480327454`*^9}, {3.9121512857627974`*^9, 3.9121512904114666`*^9}, 
   3.9125011083554907`*^9, {3.9125011862782507`*^9, 3.9125011997184687`*^9}, {
   3.9125343497610435`*^9, 3.9125345592950416`*^9}, {3.915639238357266*^9, 
   3.915639278156277*^9}, 3.9156393126768823`*^9, 3.915860670024149*^9, {
   3.9168903964478765`*^9, 3.916890409111637*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"8b984700-8ef1-2540-b4cd-c78e2e18eb37"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Decay products pair - ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["p", "T"], TraditionalForm]],ExpressionUUID->
  "e7ddffda-c21c-f84d-9639-56ca7152c101"],
 " cut"
}], "Subsubsection",
 CellChangeTimes->{{3.905532547151104*^9, 3.9055325606376743`*^9}, 
   3.9055341111798687`*^9},ExpressionUUID->"828622e9-b4ff-164a-b516-\
545ce95a996c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"conditionpTcuts", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pTcutLowerid", "=", "pTcutLowerID"}], ",", 
       RowBox[{"pTcutUpperid", "=", "pTcutUpperID"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Hold", "@", 
       RowBox[{"Compile", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"charge1", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"py2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "pTsquaredCutLow1", ",", "pTsquaredCutLow2", ",", 
             "pTsquaredCutUpp1", ",", "pTsquaredCutUpp2", ",", 
             "pT1squaredlab", ",", "pT2squaredlab"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pTsquaredCutLow1", "=", 
             SuperscriptBox[
              RowBox[{"pTcutLowerid", "[", 
               RowBox[{"pdg1", ",", "charge1"}], "]"}], "2"]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"pTsquaredCutLow2", "=", 
             SuperscriptBox[
              RowBox[{"pTcutLowerid", "[", 
               RowBox[{"pdg2", ",", "charge1"}], "]"}], "2"]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"pTsquaredCutUpp1", "=", 
             SuperscriptBox[
              RowBox[{"pTcutUpperid", "[", 
               RowBox[{"pdg1", ",", "charge1"}], "]"}], "2"]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"pTsquaredCutUpp2", "=", 
             SuperscriptBox[
              RowBox[{"pTcutUpperid", "[", 
               RowBox[{"pdg2", ",", "charge1"}], "]"}], "2"]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"pT1squaredlab", "=", 
             RowBox[{
              SuperscriptBox["px1lab", "2"], "+", 
              SuperscriptBox["py1lab", "2"]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"pT2squaredlab", "=", 
             RowBox[{
              SuperscriptBox["px2lab", "2"], "+", 
              SuperscriptBox["py2lab", "2"]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Boole", "[", 
             RowBox[{
              RowBox[{
              "pTsquaredCutLow1", "<=", "pT1squaredlab", "<=", 
               "pTsquaredCutUpp1"}], "&&", 
              RowBox[{
              "pTsquaredCutLow2", "<=", "pT2squaredlab", "<=", 
               "pTsquaredCutUpp2"}]}], "]"}]}]}], "\[IndentingNewLine]", 
          "]"}], ",", 
         RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
         RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
         RowBox[{"RuntimeAttributes", "->", 
          RowBox[{"{", "Listable", "}"}]}], ",", 
         RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "//", 
      "ReleaseHold"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionpTcuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9055326298577223`*^9, 3.9055328326419477`*^9}, {
   3.905533244366785*^9, 3.9055332465225167`*^9}, 3.9055338822304444`*^9, {
   3.910176164824113*^9, 3.910176168304602*^9}, {3.912504383534126*^9, 
   3.9125043835352573`*^9}, {3.912534564608594*^9, 3.912534653708722*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"0cec4828-cde8-5940-87dc-b118920088e4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Decay products pair - Impact parameter cut", "Subsubsection",
 CellChangeTimes->{{3.905532547151104*^9, 3.905532550125354*^9}, 
   3.9055341132116985`*^9},ExpressionUUID->"f77d74ad-4adf-6a4f-96ea-\
39bee69a5c10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"conditionIPcuts", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"IPcutid", "=", "IPcutID"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "@", 
         RowBox[{"Compile", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"xdecayfip", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ydecayfip", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"cond", "=", "1."}], ",", "ipcut", ",", "ip12"}], 
              "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ipcut", "=", 
               SuperscriptBox[
                RowBox[{"IPcutid", "[", 
                 RowBox[{"pdg1", ",", "pdg2"}], "]"}], "2"]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"ipcut", "\[NotEqual]", 
                 SuperscriptBox["IPcutZero", "2"]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"ip12", "=", 
                  RowBox[{"IPproductzTargetSquared", "[", 
                   RowBox[{
                   "xdecayfip", ",", "ydecayfip", ",", "zfip", ",", "px1lab", 
                    ",", "px2lab", ",", "py1lab", ",", "py2lab", ",", 
                    "pz1lab", ",", "pz2lab"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"cond", "=", 
                  RowBox[{"Boole", "[", 
                   RowBox[{"ip12", "<", "ipcut"}], "]"}]}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "cond"}]}], "\[IndentingNewLine]", "]"}],
            ",", 
           RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
           RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
           RowBox[{"RuntimeAttributes", "->", 
            RowBox[{"{", "Listable", "}"}]}], ",", 
           RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
        RowBox[{"ruleDown", "[", 
         RowBox[{"{", "IPproductzTargetSquared", "}"}], "]"}]}], "/.", 
       RowBox[{"ruleOwn", "[", 
        RowBox[{"{", "IPcutZero", "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionIPcuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.905532838134986*^9, 3.905532879137568*^9}, {
   3.905532922473439*^9, 3.90553309818943*^9}, 3.905533880228113*^9, 
   3.9056739470479393`*^9, {3.912534693358762*^9, 3.912534773251195*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"12d67c59-0b81-f94d-aa3f-23591272ef30"]
}, Closed]],

Cell[CellGroupData[{

Cell["Decay products pair - angular cut ", "Subsubsection",
 CellChangeTimes->{{3.905532547151104*^9, 3.9055325827367506`*^9}, {
   3.9055341162903185`*^9, 3.9055341166128693`*^9}, {3.914993624695646*^9, 
   3.9149936347097588`*^9}, 
   3.9151896063065534`*^9},ExpressionUUID->"a722787f-af48-f64f-9b15-\
feb94ca80a6b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"angres", "=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"GivenExperiment", "==", "\"\<SHiNESS\>\""}], ",", 
     RowBox[{"10", "*", 
      FractionBox["Pi", "180."]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"GivenExperiment", "!=", "\"\<SHiNESS\>\""}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"conditionAngSepCuts", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"AngSepCutid", "=", "AngSepCutID"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "@", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"py2lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pz2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"cond", "=", "1."}], ",", "angsepcut", ",", "ss12"}],
                 "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"Minimal", " ", "separation", " ", "in", " ", "rad"}],
                 "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"angsepcut", "=", 
                 RowBox[{"AngSepCutid", "[", 
                  RowBox[{"pdg1", ",", "pdg2"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"angsepcut", "\[NotEqual]", "AngSepCutZero"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"cos", 
                    RowBox[{"(", 
                    SubscriptBox["\[Theta]", 
                    RowBox[{"between", " ", "decay", " ", "products"}]], 
                    ")"}]}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"ss12", "=", 
                    RowBox[{"CosAngleProducts", "[", 
                    RowBox[{
                    "px1lab", ",", "px2lab", ",", "py1lab", ",", "py2lab", 
                    ",", "pz1lab", ",", "pz2lab"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"Boolean", " ", "condition"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"cond", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{"ss12", "<", 
                    RowBox[{"Cos", "[", "angsepcut", "]"}]}], "]"}]}]}]}], 
                 "]"}], ";", "\[IndentingNewLine]", "cond"}]}], 
              "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
             RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
             RowBox[{"RuntimeAttributes", "->", 
              RowBox[{"{", "Listable", "}"}]}], ",", 
             RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
          RowBox[{"ruleDown", "[", 
           RowBox[{"{", 
            RowBox[{"AngSepCutID", ",", "CosAngleProducts"}], "}"}], "]"}]}], 
         "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", "AngSepCutZero", "}"}], "]"}]}], "//", 
        "ReleaseHold"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"conditionAngSepCuts", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"AngSepCutid", "=", "AngSepCutID"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "@", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"py2lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"pz2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"cond", "=", "1."}], ",", "angsepcut", ",", "ss12", 
                 ",", 
                 RowBox[{"u1", "=", "0."}], ",", 
                 RowBox[{"u2", "=", "0."}], ",", 
                 RowBox[{"z", "=", "0."}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"Minimal", " ", "separation", " ", "in", " ", "rad"}],
                 "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"angsepcut", "=", 
                 RowBox[{"AngSepCutid", "[", 
                  RowBox[{"pdg1", ",", "pdg2"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"angsepcut", "\[NotEqual]", "AngSepCutZero"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"cos", 
                    RowBox[{"(", 
                    SubscriptBox["\[Theta]", 
                    RowBox[{"between", " ", "decay", " ", "products"}]], 
                    ")"}]}], ",", " ", 
                    RowBox[{
                    "including", " ", "the", " ", "gaussian", " ", "smearing",
                     " ", "from", " ", 
                    RowBox[{"detector", "'"}], "s", " ", "resolution"}]}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"u1", "=", 
                    RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"0.", ",", "1."}], "}"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"u2", "=", 
                    RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"0.", ",", "1."}], "}"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"z", "=", 
                    RowBox[{
                    RowBox[{"Sqrt", "[", 
                    RowBox[{
                    RowBox[{"-", "2."}], " ", 
                    RowBox[{"Log", "[", "u1", "]"}]}], "]"}], " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"2.", " ", "Pi", " ", "u2"}], "]"}]}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"ss12", "=", 
                    RowBox[{"ArcCos", "[", 
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"ArcCos", "[", 
                    RowBox[{"CosAngleProducts", "[", 
                    RowBox[{
                    "px1lab", ",", "px2lab", ",", "py1lab", ",", "py2lab", 
                    ",", "pz1lab", ",", "pz2lab"}], "]"}], "]"}], "+", 
                    RowBox[{"angres", "*", "z"}]}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"Boolean", " ", "condition"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"cond", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{"ss12", ">", "angsepcut"}], "]"}]}]}]}], "]"}], 
                ";", "\[IndentingNewLine]", "cond"}]}], "\[IndentingNewLine]",
               "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
             RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
             RowBox[{"RuntimeAttributes", "->", 
              RowBox[{"{", "Listable", "}"}]}], ",", 
             RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
          RowBox[{"ruleDown", "[", 
           RowBox[{"{", 
            RowBox[{
            "AngSepCutID", ",", "CosAngleProducts", ",", "InverseCDFffplus"}],
             "}"}], "]"}]}], "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", 
           RowBox[{"AngSepCutZero", ",", "angres"}], "}"}], "]"}]}], "//", 
        "ReleaseHold"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "CompiledFunctionTools`"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionAngSepCuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9055331880335803`*^9, 3.905533227740013*^9}, {
   3.9055332587958794`*^9, 3.9055333488766437`*^9}, 3.9055341200082865`*^9, {
   3.9125347829629927`*^9, 3.912534814263256*^9}, {3.9149934654293003`*^9, 
   3.914993465444955*^9}, {3.914993746928336*^9, 3.914993837683897*^9}, {
   3.9151896025630646`*^9, 3.9151896261796837`*^9}, {3.915189767092677*^9, 
   3.9151897826396627`*^9}, {3.9151898390658555`*^9, 3.915189861619813*^9}, 
   3.91520659484346*^9, 3.915637993764516*^9, {3.9156383983716383`*^9, 
   3.9156385613285894`*^9}, 3.915638753808144*^9, {3.915639231757437*^9, 
   3.915639232471761*^9}, {3.9158608819722357`*^9, 3.915860929786686*^9}, {
   3.915865289151552*^9, 3.9158653066992006`*^9}, {3.9158665040979395`*^9, 
   3.9158665061303263`*^9}, 3.918663674871049*^9, 3.9186637565314813`*^9},
 CellLabel->"In[79]:=",ExpressionUUID->"54962fb0-c248-844d-b7fe-e79199eb5498"]
}, Closed]],

Cell[CellGroupData[{

Cell["Decay products pair - spatial separation cut ", "Subsubsection",
 CellChangeTimes->{{3.905532547151104*^9, 3.9055325827367506`*^9}, {
   3.9055341162903185`*^9, 3.9055341166128693`*^9}, {3.914993624695646*^9, 
   3.9149936347097588`*^9}, 3.9151896063065534`*^9, {3.918663151499013*^9, 
   3.9186631540048018`*^9}},ExpressionUUID->"63d4f94d-d3cd-c141-88d5-\
6e2a0934ff91"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"conditionSScutsOld", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"SScutid", "=", "SScutID"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "@", 
         RowBox[{"Compile", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"zfip", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"cond", "=", "1."}], ",", "sscut", ",", 
               RowBox[{"sssquared", "=", "0."}], ",", 
               RowBox[{"coordprojval", "=", "0."}]}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Minimal", " ", "separation", " ", "in", " ", "rad"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sscut", "=", 
               RowBox[{"SScutID", "[", 
                RowBox[{"pdg1", ",", "pdg2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"sscut", "\[NotEqual]", "SScutZero"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"coordprojval", "=", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"pdg1", "==", "22."}], "||", 
                    RowBox[{"pdg1", "==", "130."}]}], ",", 
                    "ECALpositionGivenExperiment", ",", "zDecVolMax"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"sssquared", "=", 
                  RowBox[{"SSproductsSquaredOld", "[", 
                   RowBox[{
                   "zfip", ",", "px1lab", ",", "px2lab", ",", "py1lab", ",", 
                    "py2lab", ",", "pz1lab", ",", "pz2lab", ",", 
                    "coordprojval"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"Boolean", " ", "condition"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"cond", "=", 
                  RowBox[{"Boole", "[", 
                   RowBox[{"sssquared", ">", 
                    SuperscriptBox["sscut", "2"]}], "]"}]}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "cond"}]}], "\[IndentingNewLine]", "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
           RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
           RowBox[{"RuntimeAttributes", "->", 
            RowBox[{"{", "Listable", "}"}]}], ",", 
           RowBox[{"Parallelization", "->", "True"}], ",", 
           RowBox[{"CompilationOptions", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<InlineExternalDefinitions\>\"", "->", "True"}], 
              ",", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}]}], 
             "}"}]}]}], "]"}]}], "/.", 
        RowBox[{"ruleDown", "[", 
         RowBox[{"{", 
          RowBox[{"SScutID", ",", "SSproductsSquaredOld"}], "}"}], "]"}]}], "/.", 
       RowBox[{"ruleOwn", "[", 
        RowBox[{"{", 
         RowBox[{
         "SScutZero", ",", "ECALpositionGivenExperiment", ",", "zDecVolMax"}],
          "}"}], "]"}]}], "//", "ReleaseHold"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "CompiledFunctionTools`"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionSScutsOld"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conditionSScuts", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"SScutid", "=", "SScutID"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "@", 
         RowBox[{"Compile", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"xfin1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"yfin1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"xfin2", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"yfin2", ",", "_Real"}], "}"}]}], "}"}], ",", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"cond", "=", "1."}], ",", "sscut", ",", 
               RowBox[{"sssquared", "=", "0."}], ",", 
               RowBox[{"coordprojval", "=", "0."}]}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Minimal", " ", "separation", " ", "in", " ", "rad"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sscut", "=", 
               RowBox[{"SScutID", "[", 
                RowBox[{"pdg1", ",", "pdg2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"sscut", "\[NotEqual]", "SScutZero"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"sssquared", "=", 
                  RowBox[{"SSproductsSquared", "[", 
                   RowBox[{
                   "xfin1", ",", "xfin2", ",", "yfin1", ",", "yfin2"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"Boolean", " ", "condition"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"cond", "=", 
                  RowBox[{"Boole", "[", 
                   RowBox[{"sssquared", ">", 
                    SuperscriptBox["sscut", "2"]}], "]"}]}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "cond"}]}], "\[IndentingNewLine]", "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
           RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
           RowBox[{"RuntimeAttributes", "->", 
            RowBox[{"{", "Listable", "}"}]}], ",", 
           RowBox[{"Parallelization", "->", "True"}], ",", 
           RowBox[{"CompilationOptions", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<InlineExternalDefinitions\>\"", "->", "True"}], 
              ",", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}]}], 
             "}"}]}]}], "]"}]}], "/.", 
        RowBox[{"ruleDown", "[", 
         RowBox[{"{", 
          RowBox[{"SScutID", ",", "SSproductsSquared"}], "}"}], "]"}]}], "/.", 
       RowBox[{"ruleOwn", "[", 
        RowBox[{"{", "SScutZero", "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "CompiledFunctionTools`"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionSScuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9055331880335803`*^9, 3.905533227740013*^9}, {
   3.9055332587958794`*^9, 3.9055333488766437`*^9}, 3.9055341200082865`*^9, {
   3.9125347829629927`*^9, 3.912534814263256*^9}, {3.9149934654293003`*^9, 
   3.914993465444955*^9}, {3.914993746928336*^9, 3.914993837683897*^9}, {
   3.9151896025630646`*^9, 3.9151896261796837`*^9}, {3.915189767092677*^9, 
   3.9151897826396627`*^9}, {3.9151898390658555`*^9, 3.915189861619813*^9}, 
   3.91520659484346*^9, 3.915637993764516*^9, {3.9156383983716383`*^9, 
   3.9156385613285894`*^9}, 3.915638753808144*^9, {3.915639231757437*^9, 
   3.915639232471761*^9}, {3.9158608819722357`*^9, 3.915860929786686*^9}, {
   3.915865289151552*^9, 3.9158653066992006`*^9}, {3.9158665040979395`*^9, 
   3.9158665061303263`*^9}, {3.9186631663509665`*^9, 
   3.9186632476310177`*^9}, {3.9186632960470977`*^9, 
   3.9186634097489343`*^9}, {3.918663446811565*^9, 3.9186634797061815`*^9}, {
   3.9186635647224903`*^9, 3.9186636074555073`*^9}, {3.91866366202991*^9, 
   3.9186636621893425`*^9}, {3.918663773718376*^9, 3.9186637863848286`*^9}, {
   3.9186638657049093`*^9, 3.918663877700884*^9}, {3.9186639201372433`*^9, 
   3.918663941598735*^9}, {3.918664157758288*^9, 3.918664170844573*^9}, {
   3.9187067855546317`*^9, 3.918706804814825*^9}, 3.919068719465497*^9, {
   3.934788824240917*^9, 3.9347888431772146`*^9}, {3.9347892610280085`*^9, 
   3.934789262930298*^9}, {3.9493979313155327`*^9, 3.949397931840845*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"bc3cd41d-54b0-e447-a714-f9b1dcdd35ab"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Decay products pair - Invariant mass cut", "Subsubsection",
 CellChangeTimes->{{3.905532547151104*^9, 3.9055325827367506`*^9}, {
   3.9055326722485633`*^9, 3.905532675159629*^9}, 
   3.905534118019686*^9},ExpressionUUID->"12b945a1-45aa-a84f-b329-\
9b6885b995de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"conditionminvCuts", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"minvCutLowerid", "=", "minvCutLowerID"}], ",", 
       RowBox[{"minvCutUpperid", "=", "minvCutUpperID"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Hold", "@", 
         RowBox[{"Compile", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"pdg1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"charge1", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pdg2", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"E1lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"px2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"py2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"pz2lab", ",", "_Real"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"E2lab", ",", "_Real"}], "}"}]}], "}"}], ",", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"cond", "=", "1."}], ",", 
               RowBox[{"minv2cutlow", "=", 
                SuperscriptBox["minvCutLowerZero", "2"]}], ",", 
               RowBox[{"minv2cutupp", "=", 
                SuperscriptBox["minvCutUpperZero", "2"]}], ",", "minv2val"}], 
              "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "Minimal", " ", "spatial", " ", "separation", " ", "cut", " ", 
               "for", " ", "the", " ", "decay", " ", "products"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"IfminvLowerCuts", "==", "1"}], ",", 
                RowBox[{"minv2cutlow", "=", 
                 SuperscriptBox[
                  RowBox[{"minvCutLowerid", "[", 
                   RowBox[{"pdg1", ",", "charge1", ",", "pdg2"}], "]"}], 
                  "2"]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"IfminvUpperCuts", "==", "1"}], ",", 
                RowBox[{"minv2cutupp", "=", 
                 SuperscriptBox[
                  RowBox[{"minvCutUpperid", "[", 
                   RowBox[{"pdg1", ",", "charge1", ",", "pdg2"}], "]"}], 
                  "2"]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"minv2cutlow", "\[NotEqual]", 
                   SuperscriptBox["minvCutLowerZero", "2"]}], "||", 
                  RowBox[{"minv2cutupp", "\[NotEqual]", 
                   SuperscriptBox["minvCutUpperZero", "2"]}]}], ")"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"minv2val", "=", 
                  RowBox[{"minvProductsSquared", "[", 
                   RowBox[{
                   "px1lab", ",", "py1lab", ",", "pz1lab", ",", "E1lab", ",", 
                    "px2lab", ",", "py2lab", ",", "pz2lab", ",", "E2lab"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"cond", "=", 
                  RowBox[{"Boole", "[", 
                   RowBox[{
                   "minv2cutlow", "<=", "minv2val", "<=", "minv2cutupp"}], 
                   "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", "cond"}]}],
             "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
           RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
           RowBox[{"RuntimeAttributes", "->", 
            RowBox[{"{", "Listable", "}"}]}], ",", 
           RowBox[{"Parallelization", "->", "True"}]}], "]"}]}], "/.", 
        RowBox[{"ruleDown", "[", 
         RowBox[{"{", "minvProductsSquared", "}"}], "]"}]}], "/.", 
       RowBox[{"ruleOwn", "[", 
        RowBox[{"{", 
         RowBox[{
         "minvCutLowerZero", ",", "minvCutUpperZero", ",", "IfminvLowerCuts", 
          ",", "IfminvUpperCuts"}], "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "conditionminvCuts"}], ";"}]}], "Input",
 CellChangeTimes->{{3.905533232079184*^9, 3.905533238078718*^9}, {
   3.9055333661554675`*^9, 3.9055335187311*^9}, 3.9055339005920033`*^9, {
   3.9058468091766605`*^9, 3.9058468832558556`*^9}, {3.912534819977749*^9, 
   3.912534895817213*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"a5ad9fa1-6022-7348-8582-44d2223c0a89"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Full routine calculating the decay products acceptance", "Subsection",
 CellChangeTimes->{{3.9055341759863997`*^9, 
  3.905534187349038*^9}},ExpressionUUID->"f31ca543-e29d-ac4a-9135-\
1870c6f0223e"],

Cell[BoxData[
 RowBox[{"ConditionSpecial", "=", 
  RowBox[{
   RowBox[{"!", 
    RowBox[{"(", 
     RowBox[{"ifCMSdi", "||", "ifBelledi"}], ")"}]}], "&&", 
   RowBox[{"!", 
    RowBox[{"StringContainsQ", "[", 
     RowBox[{"GivenExperiment", ",", "\"\<LHCb-downstream\>\""}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.951482658614629*^9, 3.951482699578843*^9}, {
  3.9514827609006453`*^9, 3.9514827696510816`*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"5a330087-603f-477c-bf72-86ae05679ea1"],

Cell[CellGroupData[{

Cell["At least two particles pass the acceptance criteria", "Subsubsection",
 CellChangeTimes->{
  3.9055274151004214`*^9, {3.90553407587924*^9, 3.9055340775446243`*^9}, {
   3.905534124633428*^9, 3.9055341308552237`*^9}, {3.905534192713667*^9, 
   3.9055342031436033`*^9}},ExpressionUUID->"8349303a-0484-cc45-b3cd-\
ffe7bbe4fa9f"],

Cell[CellGroupData[{

Cell["Standard routine", "Item",
 CellChangeTimes->{{3.9495646199167786`*^9, 
  3.949564624700777*^9}},ExpressionUUID->"b66752c4-d012-8746-876b-\
57d066ca209c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{"ConditionSpecial", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DecayAcceptanceComp", "=", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
          RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
          RowBox[{"CondAS", "=", "conditionAngSepCuts"}], ",", 
          RowBox[{"CondSS", "=", "conditionSScuts"}], ",", 
          RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
          RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
          RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "@", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"eventslengths", ",", "_Integer", ",", "1"}], "}"}]}],
               "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "cond", ",", "count", ",", "FirstCoordinateProduct1", ",", 
                 "SecondCoordinateProduct1", ",", "FirstCoordinateProduct2", 
                 ",", "SecondCoordinateProduct2", ",", "efip", ",", 
                 "\[Theta]fip", ",", "\[Phi]fip", ",", 
                 RowBox[{"px1rest", "=", "0."}], ",", 
                 RowBox[{"py1rest", "=", "0."}], ",", 
                 RowBox[{"pz1rest", "=", "0."}], ",", 
                 RowBox[{"E1rest", "=", "0."}], ",", 
                 RowBox[{"px2rest", "=", "0."}], ",", 
                 RowBox[{"py2rest", "=", "0."}], ",", 
                 RowBox[{"pz2rest", "=", "0."}], ",", 
                 RowBox[{"E2rest", "=", "0."}], ",", "px1lab", ",", "px2lab", 
                 ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab", 
                 ",", "xdecayfip", ",", "ydecayfip", ",", "pdg1", ",", "pdg2",
                  ",", 
                 RowBox[{"E1lab", "=", "0."}], ",", 
                 RowBox[{"E2lab", "=", "0."}], ",", "charge1", ",", "charge2",
                  ",", 
                 RowBox[{"len", "=", 
                  RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                 RowBox[{"nproducts", "=", "0"}], ",", 
                 RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                 RowBox[{"in1", "=", "0"}], ",", 
                 RowBox[{"in2", "=", "0"}], ",", 
                 RowBox[{"min", "=", "0"}], ",", "pxfip", ",", "pyfip", ",", 
                 "pzfip", ",", "pfip", ",", 
                 RowBox[{"Coord1FinProd1", "=", "0."}], ",", 
                 RowBox[{"Coord2FinProd1", "=", "0."}], ",", 
                 RowBox[{"Coord1FinProd2", "=", "0."}], ",", 
                 RowBox[{"Coord2FinProd2", "=", "0."}], ",", 
                 RowBox[{"\[Epsilon]azfip", "=", "0."}], ",", "zdecayfip"}], 
                "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"count", "=", " ", "0."}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                 "Coordinates", " ", "of", " ", "the", " ", "LLP", " ", 
                  "decay"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"xdecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexxdec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"ydecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexydec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"zdecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexzdec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"zmagnMzfip", "=", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"zdecayfip", "<", "zMagnetMinGivenExperiment"}], 
                   ",", 
                   RowBox[{
                   "zMagnetMaxGivenExperiment", "-", 
                    "zMagnetMinGivenExperiment"}], ",", 
                   RowBox[{"zMagnetMaxGivenExperiment", "-", "zdecayfip"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"For", " ", "each", " ", "decay"}], ",", " ", 
                  RowBox[{
                  "calculate", " ", "the", " ", "decay", " ", "products", " ",
                    "acceptance"}]}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"cond", "=", "0."}], ";", "\[IndentingNewLine]", 
                RowBox[{"min", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"eventslengths", ",", "1"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"nproducts", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"eventslengths", ",", "2"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"f1max", "=", 
                 RowBox[{"nproducts", "-", "2"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"Do", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"in1", "=", 
                    RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"charge1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"pdg1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"px1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"py1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"pz1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"E1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd1", ",", "Coord2FinProd1"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "E1lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "If", " ", "geometric", " ", "part", " ", "of", " ", 
                    "the", " ", "decay", " ", "acceptance", " ", "for", " ", 
                    "product1", " ", "is", " ", "non"}], "-", 
                    RowBox[{
                    "zero", " ", "then", " ", "proceeding", " ", "to", " ", 
                    RowBox[{"product2", ".", " ", "If"}], " ", "not"}]}], ",",
                     " ", 
                    RowBox[{
                    "then", " ", "go", " ", "to", " ", "the", " ", "other", 
                    " ", "product1"}]}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Do", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"in2", "=", 
                    RowBox[{"in1", "+", "f2"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"charge2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "total", " ", "electric", " ", 
                    "charge", " ", "of", " ", "the", " ", "pair", " ", "is", 
                    " ", "not", " ", "zero"}], ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "acceptance", " ", "is", " ", 
                    "automatically", " ", "0.", " ", "If", " ", "zero"}], ",",
                     " ", 
                    RowBox[{
                    "the", " ", "the", " ", "routine", " ", "below", " ", 
                    "is", " ", "launched"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"charge1", "!=", 
                    RowBox[{"-", "charge2"}]}], ",", " ", 
                    RowBox[{"cond", "=", "0"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"px2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"px1rest", "+", "px2rest"}], "]"}], ">", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5."}]]}], ",", 
                    RowBox[{
                    RowBox[{"cond", "=", "0."}], ";", 
                    RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "second", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd2", ",", "Coord2FinProd2"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge2", ",", "pdg2", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px2lab", ",", 
                    "py2lab", ",", "pz2lab", ",", "E2lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], "&&", 
                    RowBox[{"WhetherCuts", "==", "1"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "PDG", " ", "identifiers", " ", "of", " ", "the", " ", 
                    "decay", " ", "products"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Values", " ", "of", " ", "the", " ", "energy", " ", 
                    "cuts", " ", "for", " ", "the", " ", "decay", " ", 
                    "products"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfEcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "==", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondE", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "E1lab", ",", 
                    "E2lab"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", 
                    SubscriptBox["p", "T"], " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfpTcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondPT", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "px1lab", ",", 
                    "py1lab", ",", "px2lab", ",", "py2lab"}], "]"}]}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", "IP", " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfIPcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondIP", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "xdecayfip", ",", "ydecayfip", 
                    ",", "zdecayfip", ",", "px1lab", ",", "px2lab", ",", 
                    "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab"}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", "spatial", " ", "separation", " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfAngSepCuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondAS", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "zdecayfip", ",", "px1lab", ",",
                     "px2lab", ",", "py1lab", ",", "py2lab", ",", "pz1lab", 
                    ",", "pz2lab"}], "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "spatial", " ", "separation", " ", "cut"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfSScuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "==", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondSS", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "Coord1FinProd1", ",", 
                    "Coord2FinProd1", ",", "Coord1FinProd2", ",", 
                    "Coord2FinProd2"}], "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "invariant", " ", "mass", " ", "cut"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfminvCuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1."}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondMinv", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "E1lab", ",", "px2lab", ",",
                     "py2lab", ",", "pz2lab", ",", "E2lab"}], "]"}]}]}], 
                    "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "acceptance", " ", "after", " ", 
                    "all", " ", "cuts", " ", "is", " ", "1"}], ",", " ", 
                    RowBox[{
                    "then", " ", "add", " ", "it", " ", "to", " ", "the", " ",
                     "counter", " ", "and", " ", "break", " ", "the", " ", 
                    "cycle"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], ",", 
                    RowBox[{"Break", "[", "]"}]}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"f2", ",", "1", ",", 
                    RowBox[{"nproducts", "-", "f1", "-", "1"}], ",", "1"}], 
                    "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "the", " ", "acceptance", " ", "is", " ", "1", 
                    " ", "then", " ", "exit", " ", "the", " ", "cycle"}], 
                    "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], ",", 
                    RowBox[{"Break", "[", "]"}]}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                 "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"{", "cond", "}"}]}]}], "\[IndentingNewLine]", "]"}], 
             ",", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", 
             RowBox[{"CompilationOptions", "->", 
              RowBox[{"{", 
               RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
               "}"}]}], ",", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
          RowBox[{"ruleOwn", "[", 
           RowBox[{"{", 
            RowBox[{
            "indexpdg1", ",", "indexxdec", ",", "indexydec", ",", "indexzdec",
              ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", 
             "indexE1", ",", "LengthDataProduct", ",", "WhetherCuts", ",", 
             "indexcharge1", ",", "zMagnetMinGivenExperiment", ",", 
             "zMagnetMaxGivenExperiment", ",", "IfEcuts", ",", "IfpTcuts", 
             ",", "IfAngSepCuts", ",", "IfIPcuts", ",", "IfminvCuts", ",", 
             "IfSScuts"}], "}"}], "]"}]}], "//", "ReleaseHold"}]}], "]"}]}], 
     ";"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.905527491102636*^9, 3.9055274925478287`*^9}, {
   3.905527536763167*^9, 3.9055275696315875`*^9}, {3.9055276055004196`*^9, 
   3.905527605761074*^9}, {3.905527694103842*^9, 3.9055276964573956`*^9}, {
   3.9055277363764324`*^9, 3.90552773889065*^9}, {3.905528025954468*^9, 
   3.905528056926959*^9}, {3.905529540979798*^9, 3.9055296002136154`*^9}, {
   3.9055297847232103`*^9, 3.9055298036155567`*^9}, {3.905529838296819*^9, 
   3.9055298734305954`*^9}, {3.9055307313628902`*^9, 3.905530734725708*^9}, {
   3.905530781938383*^9, 3.905530794215193*^9}, {3.9055309909607363`*^9, 
   3.9055309940468645`*^9}, {3.905532103842718*^9, 3.9055321250875483`*^9}, {
   3.9055331339826517`*^9, 3.9055331613105536`*^9}, 3.905533449660816*^9, {
   3.9055335290841*^9, 3.9055338119784317`*^9}, {3.905533920716429*^9, 
   3.9055340267854743`*^9}, 3.9055340649393363`*^9, 3.9058414663253417`*^9, 
   3.90584149743476*^9, {3.905841537758681*^9, 3.905841553296379*^9}, {
   3.9058416031807747`*^9, 3.9058416262487144`*^9}, {3.9102490996385765`*^9, 
   3.9102491049485836`*^9}, {3.910249234568329*^9, 3.91024924532967*^9}, {
   3.9120766737114058`*^9, 3.9120767021412497`*^9}, {3.9120939935162125`*^9, 
   3.912093999487069*^9}, {3.9121514302679844`*^9, 3.9121514978367376`*^9}, {
   3.9121515410966997`*^9, 3.912151571850938*^9}, 3.9121598033475866`*^9, {
   3.9125349119974346`*^9, 3.9125349211150208`*^9}, {3.912535224480055*^9, 
   3.9125352523749976`*^9}, {3.9126718068080254`*^9, 
   3.9126718069600697`*^9}, {3.91284286470712*^9, 3.9128428649094067`*^9}, {
   3.9128457048961*^9, 3.9128457050433097`*^9}, {3.9140880573777456`*^9, 
   3.914088059927469*^9}, {3.914088403597372*^9, 3.9140884204948473`*^9}, {
   3.9140884841874523`*^9, 3.914088528679906*^9}, {3.914088688198037*^9, 
   3.9140887194429235`*^9}, {3.914088813299428*^9, 3.9140888479215775`*^9}, {
   3.9140890733482437`*^9, 3.914089073598226*^9}, {3.914089104755252*^9, 
   3.9140891527979927`*^9}, {3.914089189837954*^9, 3.914089208170019*^9}, 
   3.9140892432823877`*^9, {3.9140893042702293`*^9, 3.9140893059466105`*^9}, {
   3.914089347866799*^9, 3.9140893494122763`*^9}, {3.914089381791878*^9, 
   3.914089386842063*^9}, {3.914089611201625*^9, 3.9140896113282166`*^9}, {
   3.9140896848690224`*^9, 3.914089698569595*^9}, {3.9140898316228886`*^9, 
   3.9140898348595147`*^9}, {3.91408986820553*^9, 3.914089884753129*^9}, {
   3.9140899654152503`*^9, 3.914089975840703*^9}, {3.9140901274169436`*^9, 
   3.914090148305258*^9}, {3.914090218327608*^9, 3.914090221436714*^9}, {
   3.91409035855694*^9, 3.914090374984599*^9}, {3.9140904766967783`*^9, 
   3.9140904950670033`*^9}, {3.914091551295477*^9, 3.91409155441693*^9}, {
   3.9149934654762*^9, 3.914993465491789*^9}, {3.9154371521283627`*^9, 
   3.9154371524349384`*^9}, 3.9168904429277716`*^9, {3.9168973010953646`*^9, 
   3.91689730205436*^9}, {3.9186640303197594`*^9, 3.918664141683075*^9}, {
   3.91906855065151*^9, 3.919068605189381*^9}, {3.9190687490897284`*^9, 
   3.919068810159018*^9}, {3.919069021691289*^9, 3.9190690260727654`*^9}, {
   3.93478888381587*^9, 3.9347888838853593`*^9}, {3.9347892398475037`*^9, 
   3.9347892410304003`*^9}, {3.9356342724596214`*^9, 3.93563432818058*^9}, {
   3.9493984905928726`*^9, 3.9493985881014957`*^9}, {3.9493986238742905`*^9, 
   3.949398649912697*^9}, {3.94939873759511*^9, 3.9493987441171227`*^9}, {
   3.9493987787689247`*^9, 3.949398835798643*^9}, {3.9493992607038727`*^9, 
   3.9493993584147205`*^9}, {3.949399427102848*^9, 3.949399538624277*^9}, {
   3.94939968130007*^9, 3.949399702637413*^9}, {3.9494160331409473`*^9, 
   3.9494160367123356`*^9}, {3.9495592776244183`*^9, 
   3.9495592938860607`*^9}, {3.9495646287169495`*^9, 3.949564633850544*^9}, {
   3.9496503846976643`*^9, 3.949650392944151*^9}, 3.9514827944025984`*^9},
 CellLabel->"In[93]:=",ExpressionUUID->"4dd35f55-afbb-7f41-a6c9-5ff525d7046c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["CMS dimuon routine", "Item",
 CellChangeTimes->{{3.9495646364668045`*^9, 
  3.9495646412013435`*^9}},ExpressionUUID->"1f66c710-1607-dc44-ab6f-\
d151dd2eb24c"],

Cell[BoxData[{
 RowBox[{"If", "[", 
  RowBox[{"ifCMSdi", ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DecayAcceptanceComp", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
         RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
         RowBox[{"CondAS", "=", "conditionAngSepCuts"}], ",", 
         RowBox[{"CondSS", "=", "conditionSScuts"}], ",", 
         RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
         RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
         RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "@", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"eventslengths", ",", "_Integer", ",", "1"}], "}"}]}],
               "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "cond", ",", "count", ",", "FirstCoordinateProduct1", ",", 
                 "SecondCoordinateProduct1", ",", "FirstCoordinateProduct2", 
                 ",", "SecondCoordinateProduct2", ",", "efip", ",", 
                 "\[Theta]fip", ",", "\[Phi]fip", ",", 
                 RowBox[{"px1rest", "=", "0."}], ",", 
                 RowBox[{"py1rest", "=", "0."}], ",", 
                 RowBox[{"pz1rest", "=", "0."}], ",", 
                 RowBox[{"E1rest", "=", "0."}], ",", 
                 RowBox[{"px2rest", "=", "0."}], ",", 
                 RowBox[{"py2rest", "=", "0."}], ",", 
                 RowBox[{"pz2rest", "=", "0."}], ",", 
                 RowBox[{"E2rest", "=", "0."}], ",", "px1lab", ",", "px2lab", 
                 ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab", 
                 ",", "xdecayfip", ",", "ydecayfip", ",", "pdg1", ",", "pdg2",
                  ",", 
                 RowBox[{"E1lab", "=", "0."}], ",", 
                 RowBox[{"E2lab", "=", "0."}], ",", "charge1", ",", "charge2",
                  ",", 
                 RowBox[{"len", "=", 
                  RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                 RowBox[{"nproducts", "=", "0"}], ",", 
                 RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                 RowBox[{"in1", "=", "0"}], ",", 
                 RowBox[{"in2", "=", "0"}], ",", 
                 RowBox[{"min", "=", "0"}], ",", "pxfip", ",", "pyfip", ",", 
                 "pzfip", ",", "pfip", ",", 
                 RowBox[{"Coord1FinProd1", "=", "0."}], ",", 
                 RowBox[{"Coord2FinProd1", "=", "0."}], ",", 
                 RowBox[{"Coord1FinProd2", "=", "0."}], ",", 
                 RowBox[{"Coord2FinProd2", "=", "0."}], ",", 
                 RowBox[{"\[Epsilon]azfip", "=", "0."}], ",", "zdecayfip", 
                 ",", "pT1", ",", "pT2", ",", 
                 RowBox[{"\[Eta]1", "=", "0."}], ",", 
                 RowBox[{"\[Eta]2", "=", "0."}], ",", 
                 RowBox[{"\[Phi]1", "=", "0."}], ",", 
                 RowBox[{"\[Phi]2", "=", "0."}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"count", "=", " ", "0."}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                 "Coordinates", " ", "of", " ", "the", " ", "LLP", " ", 
                  "decay"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"xdecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexxdec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"ydecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexydec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"zdecayfip", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"TableMother", ",", "indexzdec"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"zmagnMzfip", "=", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"zdecayfip", "<", "zMagnetMinGivenExperiment"}], 
                   ",", 
                   RowBox[{
                   "zMagnetMaxGivenExperiment", "-", 
                    "zMagnetMinGivenExperiment"}], ",", 
                   RowBox[{"zMagnetMaxGivenExperiment", "-", "zdecayfip"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"For", " ", "each", " ", "decay"}], ",", " ", 
                  RowBox[{
                  "calculate", " ", "the", " ", "decay", " ", "products", " ",
                    "acceptance"}]}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"cond", "=", "0."}], ";", "\[IndentingNewLine]", 
                RowBox[{"min", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"eventslengths", ",", "1"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"nproducts", "=", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"eventslengths", ",", "2"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"f1max", "=", 
                 RowBox[{"nproducts", "-", "2"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"Do", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"in1", "=", 
                    RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"charge1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"pdg1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"px1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"py1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"pz1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"E1lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd1", ",", "Coord2FinProd1"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "E1lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "If", " ", "geometric", " ", "part", " ", "of", " ", 
                    "the", " ", "decay", " ", "acceptance", " ", "for", " ", 
                    "product1", " ", "is", " ", "non"}], "-", 
                    RowBox[{
                    "zero", " ", "then", " ", "proceeding", " ", "to", " ", 
                    RowBox[{"product2", ".", " ", "If"}], " ", "not"}]}], ",",
                     " ", 
                    RowBox[{
                    "then", " ", "go", " ", "to", " ", "the", " ", "other", 
                    " ", "product1"}]}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"in2", "=", 
                    RowBox[{"in1", "+", "1"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"charge2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "total", " ", "electric", " ", 
                    "charge", " ", "of", " ", "the", " ", "pair", " ", "is", 
                    " ", "not", " ", "zero"}], ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "acceptance", " ", "is", " ", 
                    "automatically", " ", "0.", " ", "If", " ", "zero"}], ",",
                     " ", 
                    RowBox[{
                    "the", " ", "the", " ", "routine", " ", "below", " ", 
                    "is", " ", "launched"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"px1rest", "+", "px2rest"}], "]"}], ">", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5."}]]}], ",", 
                    RowBox[{
                    RowBox[{"cond", "=", "0."}], ";", 
                    RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "second", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd2", ",", "Coord2FinProd2"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge2", ",", "pdg2", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px2lab", ",", 
                    "py2lab", ",", "pz2lab", ",", "E2lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pT1", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["px1lab", "2"], "+", 
                    SuperscriptBox["py1lab", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pT2", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["px2lab", "2"], "+", 
                    SuperscriptBox["py2lab", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    RowBox[{"pT1", ">", "pTminall\[Mu]"}], "&&", 
                    RowBox[{"pT2", ">", "pTminall\[Mu]"}], "&&", 
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"pT1", ",", "pT2"}], "]"}], ">", 
                    "pTmin2\[Mu]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\[Eta]1", "=", 
                    RowBox[{"-", 
                    RowBox[{"Log", "[", 
                    RowBox[{"2", 
                    FractionBox[
                    SqrtBox[
                    RowBox[{"1", "-", 
                    RowBox[{
                    FractionBox["1", "4"], 
                    FractionBox[
                    SuperscriptBox["pz1lab", "2"], 
                    RowBox[{
                    SuperscriptBox["pT1", "2"], "+", 
                    SuperscriptBox["pz1lab", "2"]}]]}]}]], 
                    FractionBox["pz1lab", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["pT1", "2"], "+", 
                    SuperscriptBox["pz1lab", "2"]}]]]]}], "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\[Eta]2", "=", 
                    RowBox[{"-", 
                    RowBox[{"Log", "[", 
                    RowBox[{"2", 
                    FractionBox[
                    SqrtBox[
                    RowBox[{"1", "-", 
                    RowBox[{
                    FractionBox["1", "4"], 
                    FractionBox[
                    SuperscriptBox["pz2lab", "2"], 
                    RowBox[{
                    SuperscriptBox["pT2", "2"], "+", 
                    SuperscriptBox["pz2lab", "2"]}]]}]}]], 
                    FractionBox["pz2lab", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["pT2", "2"], "+", 
                    SuperscriptBox["pz2lab", "2"]}]]]]}], "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\[Phi]1", "=", 
                    RowBox[{"\[Phi]Val", "[", 
                    RowBox[{"px1lab", ",", "py1lab"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\[Phi]2", "=", 
                    RowBox[{"\[Phi]Val", "[", 
                    RowBox[{"px2lab", ",", "py2lab"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"\[Eta]1", "-", "\[Eta]2"}], ")"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"\[Phi]2", "-", "\[Phi]1"}], ")"}], "2"]}]], "<", 
                    "\[CapitalDelta]\[Theta]opening\[Mu]Max"}], "]"}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                 "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"{", "cond", "}"}]}]}], "\[IndentingNewLine]", "]"}], 
             ",", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", 
             RowBox[{"CompilationOptions", "->", 
              RowBox[{"{", 
               RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
               "}"}]}], ",", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
          RowBox[{"ruleOwn", "[", 
           RowBox[{"{", 
            RowBox[{
            "indexpdg1", ",", "indexxdec", ",", "indexydec", ",", "indexzdec",
              ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", 
             "indexE1", ",", "LengthDataProduct", ",", "indexcharge1", ",", 
             "zMagnetMinGivenExperiment", ",", "zMagnetMaxGivenExperiment", 
             ",", "pTminall\[Mu]", ",", "pTmin2\[Mu]", ",", 
             "\[CapitalDelta]\[Theta]opening\[Mu]Max"}], "}"}], "]"}]}], "/.", 
         RowBox[{"ruleDown", "[", 
          RowBox[{"{", "\[Phi]Val", "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
      "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "DecayAcceptanceComp"}], ";"}]}], "Input",
 CellChangeTimes->{{3.949564645265787*^9, 3.949564651036127*^9}, {
  3.949564701293892*^9, 3.9495647191116543`*^9}, {3.949564794173748*^9, 
  3.949564894765196*^9}, {3.9495654189433136`*^9, 3.949565459350731*^9}, {
  3.9495659685727825`*^9, 3.9495660298098736`*^9}, {3.9495660645898876`*^9, 
  3.9495661491062584`*^9}, {3.9495661818718014`*^9, 3.9495661981679096`*^9}, {
  3.9495662456024685`*^9, 3.949566297350876*^9}, {3.949566359043541*^9, 
  3.9495663946570263`*^9}, {3.9496505311926804`*^9, 3.9496505349206104`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"9de6b324-066e-2042-87cd-01b14d5770aa"]
}, Closed]],

Cell[CellGroupData[{

Cell["Belle II routine", "Item",
 CellChangeTimes->{{3.9495646364668045`*^9, 3.9495646412013435`*^9}, {
  3.9496505708102646`*^9, 
  3.949650573864397*^9}},ExpressionUUID->"87057928-b507-6f48-96cb-\
843d11020baa"],

Cell[BoxData[{
 RowBox[{"If", "[", 
  RowBox[{"ifBelledi", ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DecayAcceptanceComp", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
         RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
         RowBox[{"CondAS", "=", "conditionAngSepCuts"}], ",", 
         RowBox[{"CondSS", "=", "conditionSScuts"}], ",", 
         RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
         RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
         RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
               "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"eventslengths", ",", "_Integer", ",", "1"}], "}"}]}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "cond", ",", "count", ",", "FirstCoordinateProduct1", ",", 
                "SecondCoordinateProduct1", ",", "FirstCoordinateProduct2", 
                ",", "SecondCoordinateProduct2", ",", "efip", ",", 
                "\[Theta]fip", ",", "\[Phi]fip", ",", 
                RowBox[{"px1rest", "=", "0."}], ",", 
                RowBox[{"py1rest", "=", "0."}], ",", 
                RowBox[{"pz1rest", "=", "0."}], ",", 
                RowBox[{"E1rest", "=", "0."}], ",", 
                RowBox[{"px2rest", "=", "0."}], ",", 
                RowBox[{"py2rest", "=", "0."}], ",", 
                RowBox[{"pz2rest", "=", "0."}], ",", 
                RowBox[{"E2rest", "=", "0."}], ",", "px1lab", ",", "px2lab", 
                ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab", 
                ",", "xdecayfip", ",", "ydecayfip", ",", "pdg1", ",", "pdg2", 
                ",", 
                RowBox[{"E1lab", "=", "0."}], ",", 
                RowBox[{"E2lab", "=", "0."}], ",", "charge1", ",", "charge2", 
                ",", 
                RowBox[{"len", "=", 
                 RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"in2", "=", "0"}], ",", 
                RowBox[{"min", "=", "0"}], ",", "pxfip", ",", "pyfip", ",", 
                "pzfip", ",", "pfip", ",", 
                RowBox[{"Coord1FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord1FinProd2", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd2", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}], ",", "zdecayfip", ",",
                 "pT1", ",", "pT2", ",", 
                RowBox[{"\[Eta]1", "=", "0."}], ",", 
                RowBox[{"\[Eta]2", "=", "0."}], ",", 
                RowBox[{"\[Phi]1", "=", "0."}], ",", 
                RowBox[{"\[Phi]2", "=", "0."}], ",", 
                RowBox[{"pxSM", "=", "0."}], ",", 
                RowBox[{"pySM", "=", "0."}], ",", 
                RowBox[{"pzSM", "=", "0."}], ",", 
                RowBox[{"ESM", "=", "0."}], ",", 
                RowBox[{"pTSM", "=", "0."}], ",", 
                RowBox[{"pdgSM", "=", "0."}], ",", 
                RowBox[{"chargeSM", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Coordinates", " ", "of", " ", "the", " ", "LLP", " ", 
                "decay"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"xdecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexxdec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ydecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexydec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zdecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexzdec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zmagnMzfip", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"zdecayfip", "<", "zMagnetMinGivenExperiment"}], 
                  ",", 
                  RowBox[{
                  "zMagnetMaxGivenExperiment", "-", 
                   "zMagnetMinGivenExperiment"}], ",", 
                  RowBox[{"zMagnetMaxGivenExperiment", "-", "zdecayfip"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"For", " ", "each", " ", "decay"}], ",", " ", 
                 RowBox[{
                 "calculate", " ", "the", " ", "decay", " ", "products", " ", 
                  "acceptance"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"cond", "=", "0."}], ";", "\[IndentingNewLine]", 
               RowBox[{"min", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"eventslengths", ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nproducts", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"eventslengths", ",", "2"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"f1max", "=", 
                RowBox[{"nproducts", "-", "2"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"in1", "=", 
                   RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"charge1", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"pdg1", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"px1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"py1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"pz1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"E1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd1", ",", "Coord2FinProd1"}], 
                    "}"}], "=", 
                   RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "E1lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "If", " ", "geometric", " ", "part", " ", "of", " ", 
                    "the", " ", "decay", " ", "acceptance", " ", "for", " ", 
                    "product1", " ", "is", " ", "non"}], "-", 
                    RowBox[{
                    "zero", " ", "then", " ", "proceeding", " ", "to", " ", 
                    RowBox[{"product2", ".", " ", "If"}], " ", "not"}]}], ",",
                     " ", 
                    RowBox[{
                    "then", " ", "go", " ", "to", " ", "the", " ", "other", 
                    " ", "product1"}]}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"in2", "=", 
                    RowBox[{"in1", "+", "1"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"charge2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "total", " ", "electric", " ", 
                    "charge", " ", "of", " ", "the", " ", "pair", " ", "is", 
                    " ", "not", " ", "zero"}], ",", " ", 
                    RowBox[{
                    "then", " ", "the", " ", "acceptance", " ", "is", " ", 
                    "automatically", " ", "0.", " ", "If", " ", "zero"}], ",",
                     " ", 
                    RowBox[{
                    "the", " ", "the", " ", "routine", " ", "below", " ", 
                    "is", " ", "launched"}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E2lab", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"px1rest", "+", "px2rest"}], "]"}], ">", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "5."}]]}], ",", 
                    RowBox[{
                    RowBox[{"cond", "=", "0."}], ";", 
                    RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ";"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "second", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg2", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in2", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd2", ",", "Coord2FinProd2"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge2", ",", "pdg2", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px2lab", ",", 
                    "py2lab", ",", "pz2lab", ",", "E2lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pT1", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["px1lab", "2"], "+", 
                    SuperscriptBox["py1lab", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pT2", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["px2lab", "2"], "+", 
                    SuperscriptBox["py2lab", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    RowBox[{"pT1", ">", "pTminDisplaced"}], "&&", 
                    RowBox[{"pT2", ">", "pTminDisplaced"}]}], "]"}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}]}]}], 
                   "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]",
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"{", "cond", "}"}]}]}], "\[IndentingNewLine]", "]"}], 
            ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", 
           RowBox[{
           "indexpdg1", ",", "indexxdec", ",", "indexydec", ",", "indexzdec", 
            ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1",
             ",", "LengthDataProduct", ",", "indexcharge1", ",", 
            "zMagnetMinGivenExperiment", ",", "zMagnetMaxGivenExperiment", 
            ",", "pTminPrompt", ",", "pTminDisplaced"}], "}"}], "]"}]}], "//",
         "ReleaseHold"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Calculating", " ", "the", " ", "acceptance", " ", "for", " ", "decay", 
      " ", "products"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"acceptanceSMproducts", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
         RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
         RowBox[{"CondAS", "=", "conditionAngSepCuts"}], ",", 
         RowBox[{"CondSS", "=", "conditionSScuts"}], ",", 
         RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
         RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
         RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"TableSMparticles", ",", "_Real", ",", "1"}], "}"}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "cond", ",", "count", ",", "FirstCoordinateProduct1", ",", 
                "SecondCoordinateProduct1", ",", "FirstCoordinateProduct2", 
                ",", "SecondCoordinateProduct2", ",", "efip", ",", 
                "\[Theta]fip", ",", "\[Phi]fip", ",", 
                RowBox[{"px1rest", "=", "0."}], ",", 
                RowBox[{"py1rest", "=", "0."}], ",", 
                RowBox[{"pz1rest", "=", "0."}], ",", 
                RowBox[{"E1rest", "=", "0."}], ",", 
                RowBox[{"px2rest", "=", "0."}], ",", 
                RowBox[{"py2rest", "=", "0."}], ",", 
                RowBox[{"pz2rest", "=", "0."}], ",", 
                RowBox[{"E2rest", "=", "0."}], ",", "px1lab", ",", "px2lab", 
                ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab", 
                ",", "xdecayfip", ",", "ydecayfip", ",", "pdg1", ",", "pdg2", 
                ",", 
                RowBox[{"E1lab", "=", "0."}], ",", 
                RowBox[{"E2lab", "=", "0."}], ",", "charge1", ",", "charge2", 
                ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"in2", "=", "0"}], ",", 
                RowBox[{"min", "=", "0"}], ",", "pxfip", ",", "pyfip", ",", 
                "pzfip", ",", "pfip", ",", 
                RowBox[{"Coord1FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord1FinProd2", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd2", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}], ",", "zdecayfip", ",",
                 "pT1", ",", "pT2", ",", 
                RowBox[{"\[Eta]1", "=", "0."}], ",", 
                RowBox[{"\[Eta]2", "=", "0."}], ",", 
                RowBox[{"\[Phi]1", "=", "0."}], ",", 
                RowBox[{"\[Phi]2", "=", "0."}], ",", 
                RowBox[{"pxSM", "=", "0."}], ",", 
                RowBox[{"pySM", "=", "0."}], ",", 
                RowBox[{"pzSM", "=", "0."}], ",", 
                RowBox[{"ESM", "=", "0."}], ",", 
                RowBox[{"pTSM", "=", "0."}], ",", 
                RowBox[{"pdgSM", "=", "0."}], ",", 
                RowBox[{"chargeSM", "=", "0."}], ",", 
                RowBox[{"coordproj1", "=", "0."}], ",", 
                RowBox[{"coordproj2", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Coordinates", " ", "of", " ", "the", " ", "LLP", " ", 
                "decay"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"For", " ", "each", " ", "decay"}], ",", " ", 
                RowBox[{
                "calculate", " ", "the", " ", "decay", " ", "products", " ", 
                 "acceptance"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"cond", "=", "1."}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"pdgSM", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexpdg1"}]}], "]"}]}], ";",
                   "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"pdgSM", "!=", 
                    RowBox[{"-", "999."}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pxSM", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexpx1"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pySM", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexpy1"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pzSM", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexpz1"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"ESM", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexE1"}]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"chargeSM", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"TableSMparticles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    "LengthDataProduct"}], "+", "indexcharge1"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"pTSM", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["pxSM", "2"], "+", 
                    SuperscriptBox["pySM", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"cond", ",", "coordproj1", ",", "coordproj2"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "chargeSM", ",", "pdgSM", ",", "0.", ",", "0.", ",", "0.",
                     ",", "pxSM", ",", "pySM", ",", "pzSM", ",", "ESM", ",", 
                    "999."}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{
                    RowBox[{"Boole", "[", 
                    RowBox[{"pTSM", ">", "pTminPrompt"}], "]"}], "*", 
                    "cond"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"cond", "==", "0."}], ",", 
                    RowBox[{"Break", "[", "]"}]}], "]"}], ";"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "LenProductsMax"}], "}"}]}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"{", "cond", "}"}]}]}], "\[IndentingNewLine]", "]"}], 
            ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", 
           RowBox[{
           "indexpdg1", ",", "indexxdec", ",", "indexydec", ",", "indexzdec", 
            ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1",
             ",", "LengthDataProduct", ",", "indexcharge1", ",", 
            "zMagnetMinGivenExperiment", ",", "zMagnetMaxGivenExperiment", 
            ",", "pTminPrompt", ",", "pTminDisplaced", ",", 
            "LenProductsMax"}], "}"}], "]"}]}], "//", "ReleaseHold"}]}], 
      "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
 RowBox[{
  RowBox[{"CompilePrint", "@", "DecayAcceptanceComp"}], ";"}]}], "Input",
 CellChangeTimes->{{3.949564645265787*^9, 3.949564651036127*^9}, {
   3.949564701293892*^9, 3.9495647191116543`*^9}, {3.949564794173748*^9, 
   3.949564894765196*^9}, {3.9495654189433136`*^9, 3.949565459350731*^9}, {
   3.9495659685727825`*^9, 3.9495660298098736`*^9}, {3.9495660645898876`*^9, 
   3.9495661491062584`*^9}, {3.9495661818718014`*^9, 
   3.9495661981679096`*^9}, {3.9495662456024685`*^9, 3.949566297350876*^9}, {
   3.949566359043541*^9, 3.9495663946570263`*^9}, {3.9496505311926804`*^9, 
   3.9496505349206104`*^9}, {3.9496524626942215`*^9, 3.949652463950041*^9}, {
   3.9496525396186295`*^9, 3.949652541571802*^9}, {3.949653185590252*^9, 
   3.949653205140772*^9}, {3.9496534675175934`*^9, 3.9496534873175983`*^9}, {
   3.9496535232313232`*^9, 3.949653741341881*^9}, {3.9496537928037167`*^9, 
   3.949653797921692*^9}, {3.9496538532718906`*^9, 3.949653903968586*^9}, {
   3.949653968296795*^9, 3.9496539684929085`*^9}, {3.949654030096859*^9, 
   3.9496540910642967`*^9}, {3.949654324878767*^9, 3.9496543628340263`*^9}, {
   3.9496548539966297`*^9, 3.9496548626678543`*^9}, {3.949655946230484*^9, 
   3.949655954509899*^9}, 3.949657305111452*^9, {3.9498211448176193`*^9, 
   3.9498212081536655`*^9}, {3.9498212517891617`*^9, 
   3.9498212708117256`*^9}, {3.9498248538261433`*^9, 3.949824854529217*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"6c740609-8cea-0e4e-a585-41e3b7c508b4"]
}, Closed]],

Cell[CellGroupData[{

Cell["LHCb-downstream routine", "Item",
 CellChangeTimes->{{3.951482636305335*^9, 3.951482644893922*^9}},
 FontWeight->"Plain",ExpressionUUID->"8edcd0f7-9d07-4466-9992-bb73979451bd"],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"StringContainsQ", "[", 
    RowBox[{"GivenExperiment", ",", "\"\<LHCb-downstream\>\""}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DecayAcceptanceComp", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
         RowBox[{"pTcutLowerid", "=", "pTcutLowerID"}], ",", 
         RowBox[{"pTcutUpperid", "=", "pTcutUpperID"}], ",", 
         RowBox[{"ecutLowerid", "=", "ecutLowerID"}], ",", 
         RowBox[{"ecutUpperid", "=", "ecutUpperID"}], ",", 
         RowBox[{"minvCutLowerid", "=", "minvCutLowerID"}], ",", 
         RowBox[{"minvCutUpperid", "=", "minvCutUpperID"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
               "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"eventslengths", ",", "_Integer", ",", "1"}], "}"}]}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"cond", "=", "0."}], ",", "FirstCoordinateProduct1", 
                ",", "SecondCoordinateProduct1", ",", 
                "FirstCoordinateProduct2", ",", "SecondCoordinateProduct2", 
                ",", "efip", ",", "\[Theta]fip", ",", "\[Phi]fip", ",", 
                RowBox[{"px1rest", "=", "0."}], ",", 
                RowBox[{"py1rest", "=", "0."}], ",", 
                RowBox[{"pz1rest", "=", "0."}], ",", 
                RowBox[{"E1rest", "=", "0."}], ",", 
                RowBox[{"px2rest", "=", "0."}], ",", 
                RowBox[{"py2rest", "=", "0."}], ",", 
                RowBox[{"pz2rest", "=", "0."}], ",", 
                RowBox[{"E2rest", "=", "0."}], ",", "px1lab", ",", "px2lab", 
                ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", "pz2lab", 
                ",", "xdecayfip", ",", "ydecayfip", ",", "pdg1", ",", "pdg2", 
                ",", 
                RowBox[{"E1lab", "=", "0."}], ",", 
                RowBox[{"E2lab", "=", "0."}], ",", "charge1", ",", "charge2", 
                ",", 
                RowBox[{"len", "=", 
                 RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"in2", "=", "0"}], ",", 
                RowBox[{"min", "=", "0"}], ",", "pxfip", ",", "pyfip", ",", 
                "pzfip", ",", "pfip", ",", 
                RowBox[{"Coord1FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd1", "=", "0."}], ",", 
                RowBox[{"Coord1FinProd2", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd2", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}], ",", "zdecayfip", ",",
                 "pT1", ",", "pT2", ",", 
                RowBox[{"\[Eta]1", "=", "0."}], ",", 
                RowBox[{"\[Eta]2", "=", "0."}], ",", 
                RowBox[{"\[Phi]1", "=", "0."}], ",", 
                RowBox[{"\[Phi]2", "=", "0."}], ",", 
                RowBox[{"pxSM", "=", "0."}], ",", 
                RowBox[{"pySM", "=", "0."}], ",", 
                RowBox[{"pzSM", "=", "0."}], ",", 
                RowBox[{"ESM", "=", "0."}], ",", 
                RowBox[{"pTSM", "=", "0."}], ",", 
                RowBox[{"pdgSM", "=", "0."}], ",", 
                RowBox[{"chargeSM", "=", "0."}], ",", 
                RowBox[{"pxtot", "=", "0."}], ",", 
                RowBox[{"pytot", "=", "0."}], ",", 
                RowBox[{"pztot", "=", "0."}], ",", 
                RowBox[{"etot", "=", "0."}], ",", 
                RowBox[{"condminimal", "=", "0."}], ",", 
                RowBox[{"ifminimal", "=", "0."}], ",", 
                RowBox[{"condminv", "=", "0"}], ",", 
                RowBox[{"count", "=", "0"}], ",", 
                RowBox[{"condoverall", "=", "0."}], ",", 
                RowBox[{"minvtot", "=", "0."}], ",", 
                RowBox[{"minvminreco", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Coordinates", " ", "of", " ", "the", " ", "LLP", " ", 
                "decay"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"xdecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexxdec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ydecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexydec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zdecayfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexzdec"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zmagnMzfip", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"zdecayfip", "<", "zMagnetMinGivenExperiment"}], 
                  ",", 
                  RowBox[{
                  "zMagnetMaxGivenExperiment", "-", 
                   "zMagnetMinGivenExperiment"}], ",", 
                  RowBox[{"zMagnetMaxGivenExperiment", "-", "zdecayfip"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"For", " ", "each", " ", "decay"}], ",", " ", 
                 RowBox[{
                 "calculate", " ", "the", " ", "decay", " ", "products", " ", 
                  "acceptance"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"min", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"eventslengths", ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nproducts", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"eventslengths", ",", "2"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"f1max", "=", 
                RowBox[{"nproducts", "-", "2"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Looping", " ", "over", " ", "detectable", " ", "decay", " ", 
                 "products"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"in1", "=", 
                   RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"charge1", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"pdg1", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"px1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"py1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"pz1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"E1lab", "=", 
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd1", ",", "Coord2FinProd1"}], 
                    "}"}], "=", 
                   RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zdecayfip", ",", "px1lab", ",", 
                    "py1lab", ",", "pz1lab", ",", "E1lab", ",", 
                    "zmagnMzfip"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "If", " ", "geometric", " ", "part", " ", "of", " ", 
                    "the", " ", "decay", " ", "acceptance", " ", "for", " ", 
                    "product1", " ", "is", " ", "non"}], "-", "zero"}], ",", 
                    " ", 
                    RowBox[{
                    "then", " ", "proceeding", " ", "to", " ", "calculating", 
                    " ", "kinematic", " ", "cuts"}]}], "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Cuts", " ", "per", " ", "single", " ", "track"}],
                     "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"cond", "=", 
                    RowBox[{
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    RowBox[{"pTcutLowerid", "[", 
                    RowBox[{"pdg1", ",", "charge1"}], "]"}], "<", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["px1lab", "2"], "+", 
                    SuperscriptBox["py1lab", "2"]}]], "<", 
                    RowBox[{"pTcutUpperid", "[", 
                    RowBox[{"pdg1", ",", "charge1"}], "]"}]}], "]"}], "*", 
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    RowBox[{"ecutLowerid", "[", 
                    RowBox[{"pdg1", ",", "charge1"}], "]"}], "<", "E1lab", 
                    "<", 
                    RowBox[{"ecutUpperid", "[", 
                    RowBox[{"pdg1", ",", "charge1"}], "]"}]}], "]"}]}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"count", "+=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pxtot", "+=", "px1lab"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pytot", "+=", "py1lab"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"pztot", "+=", "pz1lab"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"etot", "+=", "E1lab"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"count", ">", "1"}], "&&", 
                    RowBox[{"ifminimal", "==", "0."}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"condminv", "=", 
                    RowBox[{"Boole", "[", 
                    RowBox[{
                    RowBox[{"minvCutLowerid", "[", 
                    RowBox[{"pdg1", ",", "charge1", ",", "pdg1"}], "]"}], "<", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["etot", "2"], "-", 
                    SuperscriptBox["pxtot", "2"], "-", 
                    SuperscriptBox["pytot", "2"], "-", 
                    SuperscriptBox["pztot", "2"]}]]}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"condminv", "==", "1"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"minvminreco", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["etot", "2"], "-", 
                    SuperscriptBox["pxtot", "2"], "-", 
                    SuperscriptBox["pytot", "2"], "-", 
                    SuperscriptBox["pztot", "2"]}]]}], ";", 
                    "\[IndentingNewLine]", " ", 
                    RowBox[{"condminimal", "=", 
                    RowBox[{"\[Epsilon]RecoVertexing", "*", 
                    SuperscriptBox["\[Epsilon]RecoPerTrack", "count"]}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"ifminimal", "=", "1."}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"f1", "==", "f1max"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"condoverall", "=", 
                    RowBox[{"\[Epsilon]RecoVertexing", "*", "ifminimal", "*", 
                    SuperscriptBox["\[Epsilon]RecoPerTrack", "count"]}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"minvtot", "=", 
                    SqrtBox[
                    RowBox[{
                    SuperscriptBox["etot", "2"], "-", 
                    SuperscriptBox["pxtot", "2"], "-", 
                    SuperscriptBox["pytot", "2"], "-", 
                    SuperscriptBox["pztot", "2"]}]]}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]",
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                "condminimal", ",", "minvminreco", ",", "count", ",", 
                 "condoverall", ",", "minvtot", ",", " ", "etot", ",", 
                 "pxtot", ",", "pytot", ",", "pztot"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleOwn", "[", 
          RowBox[{"{", 
           RowBox[{
           "indexpdg1", ",", "indexxdec", ",", "indexydec", ",", "indexzdec", 
            ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1",
             ",", "LengthDataProduct", ",", "indexcharge1", ",", 
            "zMagnetMinGivenExperiment", ",", "zMagnetMaxGivenExperiment", 
            ",", "\[Epsilon]RecoPerTrack", ",", "\[Epsilon]RecoVertexing"}], 
           "}"}], "]"}]}], "//", "ReleaseHold"}]}], "]"}]}], ";"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.9514828033092537`*^9, 3.951482806434473*^9}, 
   3.951482836618284*^9, 3.951482940866559*^9, {3.95148298840705*^9, 
   3.951482993135536*^9}, {3.9514830232797337`*^9, 3.9514830349462395`*^9}, {
   3.951483173648636*^9, 3.9514832940711217`*^9}, {3.9514833269184947`*^9, 
   3.951483397659125*^9}, {3.951483480822154*^9, 3.9514834811635942`*^9}, {
   3.9514835130032935`*^9, 3.9514836028339643`*^9}, {3.951483673056004*^9, 
   3.951483850478505*^9}, {3.9514839013206434`*^9, 3.951483913496358*^9}, 
   3.9514839455074344`*^9, {3.951483982928094*^9, 3.9514839905197754`*^9}, {
   3.9514841361745543`*^9, 3.9514841518317757`*^9}, {3.9514843505932016`*^9, 
   3.951484362063404*^9}, {3.951484501868409*^9, 3.9514847119521294`*^9}, {
   3.951484835545635*^9, 3.951484868074087*^9}, {3.951554968423973*^9, 
   3.9515550157760887`*^9}, {3.951555055659033*^9, 3.9515551030401955`*^9}, {
   3.951555805583391*^9, 3.95155583347299*^9}, {3.951557241494623*^9, 
   3.9515572433330097`*^9}, {3.9515572894817963`*^9, 3.951557350761883*^9}, {
   3.951644184618656*^9, 3.951644192479725*^9}, {3.9518007329346504`*^9, 
   3.951800737787895*^9}},
 CellLabel->
  "In[211]:=",ExpressionUUID->"cba2c1ae-b848-4324-86dd-3b418038f457"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["At least n decay products pass the acceptance criteria", "Subsubsection",
 CellChangeTimes->{
  3.9055274151004214`*^9, {3.90553407587924*^9, 3.9055340775446243`*^9}, {
   3.905534124633428*^9, 3.9055341308552237`*^9}, {3.905534192713667*^9, 
   3.9055342031436033`*^9}, {3.911964910814978*^9, 3.911964944062765*^9}, {
   3.9119659375534267`*^9, 3.9119659407041636`*^9}, {3.9119671651935196`*^9, 
   3.9119671810068283`*^9}, {3.9200129227428865`*^9, 
   3.920012924357358*^9}},ExpressionUUID->"5669e1eb-fc82-ef45-8b93-\
5f3b6dc43721"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DecayAcceptancenProductsComp", "=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
        RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
        RowBox[{"CondSS", "=", "conditionAngSepCuts"}], ",", 
        RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
        RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
        RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
               "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"eventslengths", ",", "_Integer", ",", "2"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"tracksmin", ",", "_Integer"}], "}"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"cond", "=", "0."}], ",", "count", ",", "efip", ",", 
                "zfip", ",", "\[Theta]fip", ",", "\[Phi]fip", ",", "px1rest", 
                ",", "py1rest", ",", "pz1rest", ",", "E1rest", ",", "px1lab", 
                ",", 
                RowBox[{"px2lab", "=", "0."}], ",", "py1lab", ",", 
                RowBox[{"py2lab", "=", "0."}], ",", "pz1lab", ",", 
                RowBox[{"pz2lab", "=", "0."}], ",", "xdecayfip", ",", 
                "ydecayfip", ",", "condprod1", ",", "condprod2", ",", "pdg1", 
                ",", 
                RowBox[{"pdg2", "=", "0."}], ",", "E1lab", ",", 
                RowBox[{"E2lab", "=", "0."}], ",", "acc", ",", "acc2", ",", 
                "charge1", ",", "charge2", ",", 
                RowBox[{"len", "=", 
                 RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"conde", "=", "0."}], ",", "pfip", ",", "pxfip", ",", 
                "pyfip", ",", "pzfip", ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"min", "=", "0"}], ",", 
                RowBox[{"trackcounter", "=", "0"}], ",", 
                RowBox[{"Coord1FinProd", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"count", "=", " ", "0."}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Values", " ", "of", " ", "the", " ", "LLP", " ", 
                  SubscriptBox["\[Epsilon]", "az"]}], ",", " ", "E", ",", " ",
                  "\[Theta]", ",", " ", "\[Phi]", ",", " ", 
                 SubscriptBox["x", "long"]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"efip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexELLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexzLLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Theta]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Theta]LLP"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"\[Phi]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Phi]LLP"}], "]"}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"\[Epsilon]azfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexLLPazAcc"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"\[Epsilon]azfip", "!=", "0."}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"pfip", "=", 
                   SqrtBox[
                    RowBox[{
                    SuperscriptBox["efip", "2"], "-", 
                    SuperscriptBox["mLLP", "2"]}]]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pxfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}], "*", 
                    RowBox[{"Sin", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pyfip", "=", 
                   RowBox[{"pxfip", "*", 
                    FractionBox[
                    RowBox[{"Sin", "[", "\[Phi]fip", "]"}], 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}]]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pzfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Distance", " ", "between", " ", "the", " ", "end", " ", 
                    "of", " ", "the", " ", "dipole", " ", "magnet", " ", 
                    "and", " ", "the", " ", "LLP", " ", "decay", " ", 
                    "point"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"zmagnMzfip", "=", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"zfip", "<", "zMagnetMinGivenExperiment"}], ",", 
                    RowBox[{
                    "zMagnetMaxGivenExperiment", "-", 
                    "zMagnetMinGivenExperiment"}], ",", 
                    RowBox[{"zMagnetMaxGivenExperiment", "-", "zfip"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"xdecayfip", "=", 
                   RowBox[{"LLPdecayVertexX", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"ydecayfip", "=", 
                   RowBox[{"LLPdecayVertexY", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Looping", " ", "over", " ", "simulated", " ", "decays"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"trackcounter", "=", "0"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", 
                    RowBox[{"conde", "=", "1."}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"min", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "1"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"nproducts", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "2"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"f1max", "=", 
                    RowBox[{"nproducts", "-", "1"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}],
                     "\[IndentingNewLine]", 
                    RowBox[{"Do", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"in1", "=", 
                    RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"charge1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "rest", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Energy", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"E1lab", "=", 
                    RowBox[{"EproductLabCart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"IfEcuts", "==", "1"}], ",", 
                    RowBox[{"conde", "=", 
                    RowBox[{"CondE", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "E1lab", ",", 
                    "E2lab"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "decay", " ", "product", " ",
                     "if", " ", "the", " ", "energy", " ", "is", " ", 
                    "sufficiently", " ", "large"}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"conde", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"3", "-", 
                    RowBox[{"momentum", " ", "of", " ", "the", " ", "decay", 
                    " ", "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"px1lab", "=", 
                    RowBox[{"pproductLab1Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1lab", "=", 
                    RowBox[{"pproductLab2Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1lab", "=", 
                    RowBox[{"pproductLab3Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd", ",", "Coord2FinProd"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zfip", ",", "px1lab", ",", "py1lab", 
                    ",", "pz1lab", ",", "E1lab", ",", "zmagnMzfip"}], "]"}]}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], "&&", 
                    RowBox[{"WhetherCuts", "==", "1"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "PDG", " ", "identifiers", " ", "of", " ", "the", " ", 
                    "decay", " ", "products"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", 
                    SubscriptBox["p", "T"], " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfpTcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondPT", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "px1lab", ",", 
                    "py1lab", ",", "px2lab", ",", "py2lab"}], "]"}]}]}], 
                    "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"If", " ", "condition", " ", "is", " ", "1"}], 
                    ",", " ", 
                    RowBox[{
                    "then", " ", "increase", " ", "the", " ", "detected", " ",
                     "track", " ", "counter"}]}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], ",", 
                    RowBox[{"trackcounter", "+=", "1"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"trackcounter", ">=", "tracksmin"}], ",", 
                    RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}],
                     "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"trackcounter", ">=", "tracksmin"}], ",", 
                    RowBox[{"count", "+=", "cond"}]}], "]"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "1", ",", "len"}], "}"}]}], "]"}], 
                  ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"count", "=", "0."}]}], "\[IndentingNewLine]", "]"}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"count", "/", "len"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleDown", "[", 
          RowBox[{"{", 
           RowBox[{
           "LLPdecayVertexX", ",", "LLPdecayVertexY", ",", "pproductLab1Cart",
             ",", "pproductLab2Cart", ",", "pproductLab3Cart", ",", 
            "EproductLabCart"}], "}"}], "]"}]}], "/.", 
        RowBox[{"ruleOwn", "[", 
         RowBox[{"{", 
          RowBox[{
          "indexpdg1", ",", "indexELLP", ",", "indexzLLP", ",", 
           "index\[Theta]LLP", ",", "index\[Phi]LLP", ",", "indexLLPazAcc", 
           ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1", 
           ",", "LengthDataProduct", ",", "WhetherCuts", ",", "indexcharge1", 
           ",", "zMagnetMaxGivenExperiment", ",", "zMagnetMinGivenExperiment",
            ",", "IfEcuts", ",", "IfpTcuts", ",", "IfAngSepCuts", ",", 
           "IfIPcuts", ",", "IfminvCuts"}], "}"}], "]"}]}], "//", 
       "ReleaseHold"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
    RowBox[{"CompilePrint", "@", "DecayAcceptanceAllProductsComp"}]}], ";"}], 
  "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.905527491102636*^9, 3.9055274925478287`*^9}, {
   3.905527536763167*^9, 3.9055275696315875`*^9}, {3.9055276055004196`*^9, 
   3.905527605761074*^9}, {3.905527694103842*^9, 3.9055276964573956`*^9}, {
   3.9055277363764324`*^9, 3.90552773889065*^9}, {3.905528025954468*^9, 
   3.905528056926959*^9}, {3.905529540979798*^9, 3.9055296002136154`*^9}, {
   3.9055297847232103`*^9, 3.9055298036155567`*^9}, {3.905529838296819*^9, 
   3.9055298734305954`*^9}, {3.9055307313628902`*^9, 3.905530734725708*^9}, {
   3.905530781938383*^9, 3.905530794215193*^9}, {3.9055309909607363`*^9, 
   3.9055309940468645`*^9}, {3.905532103842718*^9, 3.9055321250875483`*^9}, {
   3.9055331339826517`*^9, 3.9055331613105536`*^9}, 3.905533449660816*^9, {
   3.9055335290841*^9, 3.9055338119784317`*^9}, {3.905533920716429*^9, 
   3.9055340267854743`*^9}, 3.9055340649393363`*^9, 3.9058414663253417`*^9, 
   3.90584149743476*^9, {3.905841537758681*^9, 3.905841553296379*^9}, {
   3.9058416031807747`*^9, 3.9058416262487144`*^9}, {3.9102490996385765`*^9, 
   3.9102491049485836`*^9}, {3.910249234568329*^9, 3.91024924532967*^9}, {
   3.911965041112008*^9, 3.9119650470628176`*^9}, {3.9119651389168825`*^9, 
   3.9119651610126095`*^9}, {3.9119654967255235`*^9, 
   3.9119655805113215`*^9}, {3.9119656542582307`*^9, 
   3.9119656869405613`*^9}, {3.9119659623039613`*^9, 3.911965989535017*^9}, {
   3.911966024029789*^9, 3.911966091305372*^9}, {3.911966137840969*^9, 
   3.9119661838404517`*^9}, {3.9119662284939775`*^9, 3.911966237454152*^9}, {
   3.9119662752358913`*^9, 3.9119663917156*^9}, 3.9119664816911955`*^9, {
   3.9119665135971575`*^9, 3.911966525754816*^9}, {3.911968777578771*^9, 
   3.911968855032695*^9}, {3.9121507089597197`*^9, 3.9121507371030793`*^9}, {
   3.912150806318247*^9, 3.9121508096871014`*^9}, {3.9121508409510684`*^9, 
   3.9121509607511444`*^9}, {3.912151005989683*^9, 3.912151102657238*^9}, {
   3.9121513547302094`*^9, 3.9121514033215666`*^9}, {3.9121515794915357`*^9, 
   3.9121515805974636`*^9}, {3.9125352733068175`*^9, 3.91253535886907*^9}, {
   3.9149934655391774`*^9, 3.9149934655391774`*^9}, {3.915437152576473*^9, 
   3.9154371527861624`*^9}, {3.9199625658745046`*^9, 
   3.9199625731291094`*^9}, {3.9199626902098475`*^9, 3.919962772319756*^9}, {
   3.919962810889751*^9, 3.9199628206529655`*^9}, {3.919963031052453*^9, 
   3.9199630354599934`*^9}, {3.919963624670143*^9, 3.9199636443277655`*^9}, {
   3.9199637747098007`*^9, 3.9199638137899847`*^9}, {3.9199638638798923`*^9, 
   3.919963922139797*^9}, {3.919964669580201*^9, 3.919964695466121*^9}, {
   3.919964807900162*^9, 3.9199648080318184`*^9}, {3.9199649971301303`*^9, 
   3.91996501066543*^9}, {3.9199650840998693`*^9, 3.9199651261800337`*^9}, {
   3.9199651702700863`*^9, 3.9199651744424458`*^9}, {3.919965221117121*^9, 
   3.9199652445892773`*^9}, {3.9199653521713552`*^9, 
   3.9199654279213104`*^9}, {3.9199654665099916`*^9, 3.919965515581992*^9}, {
   3.919965559160005*^9, 3.919965628891943*^9}, {3.9199656623420906`*^9, 
   3.919965664570255*^9}, {3.919965974922825*^9, 3.9199660681936955`*^9}, {
   3.9199661047891984`*^9, 3.919966112418111*^9}, {3.9200130033030543`*^9, 
   3.9200130121444654`*^9}, {3.920013166604689*^9, 3.9200131686223564`*^9}, {
   3.920013211298304*^9, 3.920013247198547*^9}, {3.920017268984478*^9, 
   3.9200172728601837`*^9}, {3.9276105344760637`*^9, 3.927610546613558*^9}, {
   3.935634390881777*^9, 3.935634415697012*^9}, {3.9356344516130466`*^9, 
   3.935634452312948*^9}, {3.949398521433384*^9, 3.949398521465252*^9}, {
   3.9493995532294693`*^9, 3.9493995576000233`*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"57ceb468-e5c4-0e4a-bac1-0b4eaf7a8916"]
}, Closed]],

Cell[CellGroupData[{

Cell["All the target decay products pass the acceptance criteria", \
"Subsubsection",
 CellChangeTimes->{
  3.9055274151004214`*^9, {3.90553407587924*^9, 3.9055340775446243`*^9}, {
   3.905534124633428*^9, 3.9055341308552237`*^9}, {3.905534192713667*^9, 
   3.9055342031436033`*^9}, {3.911964910814978*^9, 3.911964944062765*^9}, {
   3.9119659375534267`*^9, 3.9119659407041636`*^9}, {3.9119671651935196`*^9, 
   3.9119671810068283`*^9}},ExpressionUUID->"839428aa-1891-5a47-80f8-\
d1f195e51685"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DecayAcceptanceAllProductsComp", "=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
        RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
        RowBox[{"CondSS", "=", "conditionAngSepCuts"}], ",", 
        RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
        RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
        RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
               "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"eventslengths", ",", "_Integer", ",", "2"}], "}"}]}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"cond", "=", "0."}], ",", "count", ",", "efip", ",", 
                "zfip", ",", "\[Theta]fip", ",", "\[Phi]fip", ",", "px1rest", 
                ",", "py1rest", ",", "pz1rest", ",", "E1rest", ",", "px1lab", 
                ",", 
                RowBox[{"px2lab", "=", "0."}], ",", "py1lab", ",", 
                RowBox[{"py2lab", "=", "0."}], ",", "pz1lab", ",", 
                RowBox[{"pz2lab", "=", "0."}], ",", "xdecayfip", ",", 
                "ydecayfip", ",", "condprod1", ",", "condprod2", ",", "pdg1", 
                ",", 
                RowBox[{"pdg2", "=", "0."}], ",", "E1lab", ",", 
                RowBox[{"E2lab", "=", "0."}], ",", "acc", ",", "acc2", ",", 
                "charge1", ",", "charge2", ",", 
                RowBox[{"len", "=", 
                 RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"conde", "=", "0"}], ",", "pfip", ",", "pxfip", ",", 
                "pyfip", ",", "pzfip", ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"min", "=", "0"}], ",", 
                RowBox[{"trackcounter", "=", "0"}], ",", 
                RowBox[{"Coord1FinProd", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"count", "=", " ", "0."}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Values", " ", "of", " ", "the", " ", "LLP", " ", 
                  SubscriptBox["\[Epsilon]", "az"]}], ",", " ", "E", ",", " ",
                  "\[Theta]", ",", " ", "\[Phi]", ",", " ", 
                 SubscriptBox["x", "long"]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"efip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexELLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexzLLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Theta]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Theta]LLP"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"\[Phi]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Phi]LLP"}], "]"}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"\[Epsilon]azfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexLLPazAcc"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"\[Epsilon]azfip", "!=", "0."}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"pfip", "=", 
                   SqrtBox[
                    RowBox[{
                    SuperscriptBox["efip", "2"], "-", 
                    SuperscriptBox["mLLP", "2"]}]]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pxfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}], "*", 
                    RowBox[{"Sin", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pyfip", "=", 
                   RowBox[{"pxfip", "*", 
                    FractionBox[
                    RowBox[{"Sin", "[", "\[Phi]fip", "]"}], 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}]]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pzfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Distance", " ", "between", " ", "the", " ", "end", " ", 
                    "of", " ", "the", " ", "dipole", " ", "magnet", " ", 
                    "and", " ", "the", " ", "LLP", " ", "decay", " ", 
                    "point"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"zmagnMzfip", "=", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"zfip", "<", "zMagnetMinGivenExperiment"}], ",", 
                    RowBox[{
                    "zMagnetMaxGivenExperiment", "-", 
                    "zMagnetMinGivenExperiment"}], ",", 
                    RowBox[{"zMagnetMaxGivenExperiment", "-", "zfip"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"xdecayfip", "=", 
                   RowBox[{"LLPdecayVertexX", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"ydecayfip", "=", 
                   RowBox[{"LLPdecayVertexY", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Looping", " ", "over", " ", "simulated", " ", "decays"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"trackcounter", "=", "0"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", "1."}], ";", "\[IndentingNewLine]", 
                    RowBox[{"min", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "1"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"nproducts", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "2"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"f1max", "=", 
                    RowBox[{"nproducts", "-", "1"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}],
                     "\[IndentingNewLine]", 
                    RowBox[{"Do", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"in1", "=", 
                    RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"charge1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "rest", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Energy", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"E1lab", "=", 
                    RowBox[{"EproductLabCart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"IfEcuts", "==", "1"}], ",", 
                    RowBox[{"conde", "=", 
                    RowBox[{"CondE", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "E1lab", ",", 
                    "E2lab"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "decay", " ", "product", " ",
                     "if", " ", "the", " ", "energy", " ", "is", " ", 
                    "sufficiently", " ", "large"}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"conde", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"3", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"px1lab", "=", 
                    RowBox[{"pproductLab1Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1lab", "=", 
                    RowBox[{"pproductLab2Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1lab", "=", 
                    RowBox[{"pproductLab3Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "cond", ",", "Coord1FinProd", ",", "Coord2FinProd"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zfip", ",", "px1lab", ",", "py1lab", 
                    ",", "pz1lab", ",", "E1lab", ",", "zmagnMzfip"}], "]"}]}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cond", "==", "1."}], "&&", 
                    RowBox[{"WhetherCuts", "==", "1"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "PDG", " ", "identifiers", " ", "of", " ", "the", " ", 
                    "decay", " ", "products"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", 
                    SubscriptBox["p", "T"], " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfpTcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondPT", "[", 
                    RowBox[{
                    "pdg1", ",", "charge1", ",", "pdg2", ",", "px1lab", ",", 
                    "py1lab", ",", "px2lab", ",", "py2lab"}], "]"}]}]}], 
                    "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "If", " ", "the", " ", "track", " ", "has", " ", 
                    "sufficiently", " ", "large", " ", "energy", " ", "but", 
                    " ", "did", " ", "not", " ", "reach", " ", "the", " ", 
                    "detector"}], ",", " ", 
                    RowBox[{"then", " ", 
                    RowBox[{"break", ".", " ", "Otherwise"}]}], ",", " ", 
                    RowBox[{"continue", " ", "the", " ", "iterations"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cond", "==", "0"}], "&&", 
                    RowBox[{"conde", "==", "1"}]}], ",", 
                    RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}],
                     "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"count", "+=", "cond"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "1", ",", "len"}], "}"}]}], "]"}], 
                  ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"count", "=", "0."}]}], "\[IndentingNewLine]", "]"}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Returns", " ", "the", " ", "decay", " ", "acceptance"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"count", "/", "len"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleDown", "[", 
          RowBox[{"{", 
           RowBox[{
           "LLPdecayVertexX", ",", "LLPdecayVertexY", ",", "pproductLab1Cart",
             ",", "pproductLab2Cart", ",", "pproductLab3Cart", ",", 
            "EproductLabCart"}], "}"}], "]"}]}], "/.", 
        RowBox[{"ruleOwn", "[", 
         RowBox[{"{", 
          RowBox[{
          "indexpdg1", ",", "indexELLP", ",", "indexzLLP", ",", 
           "index\[Theta]LLP", ",", "index\[Phi]LLP", ",", "indexLLPazAcc", 
           ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1", 
           ",", "LengthDataProduct", ",", "WhetherCuts", ",", "indexcharge1", 
           ",", "zMagnetMaxGivenExperiment", ",", "zMagnetMinGivenExperiment",
            ",", "IfEcuts", ",", "IfpTcuts", ",", "IfAngSepCuts", ",", 
           "IfIPcuts", ",", "IfminvCuts"}], "}"}], "]"}]}], "//", 
       "ReleaseHold"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
    RowBox[{"CompilePrint", "@", "DecayAcceptanceAllProductsComp"}]}], ";"}], 
  "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.905527491102636*^9, 3.9055274925478287`*^9}, {
   3.905527536763167*^9, 3.9055275696315875`*^9}, {3.9055276055004196`*^9, 
   3.905527605761074*^9}, {3.905527694103842*^9, 3.9055276964573956`*^9}, {
   3.9055277363764324`*^9, 3.90552773889065*^9}, {3.905528025954468*^9, 
   3.905528056926959*^9}, {3.905529540979798*^9, 3.9055296002136154`*^9}, {
   3.9055297847232103`*^9, 3.9055298036155567`*^9}, {3.905529838296819*^9, 
   3.9055298734305954`*^9}, {3.9055307313628902`*^9, 3.905530734725708*^9}, {
   3.905530781938383*^9, 3.905530794215193*^9}, {3.9055309909607363`*^9, 
   3.9055309940468645`*^9}, {3.905532103842718*^9, 3.9055321250875483`*^9}, {
   3.9055331339826517`*^9, 3.9055331613105536`*^9}, 3.905533449660816*^9, {
   3.9055335290841*^9, 3.9055338119784317`*^9}, {3.905533920716429*^9, 
   3.9055340267854743`*^9}, 3.9055340649393363`*^9, 3.9058414663253417`*^9, 
   3.90584149743476*^9, {3.905841537758681*^9, 3.905841553296379*^9}, {
   3.9058416031807747`*^9, 3.9058416262487144`*^9}, {3.9102490996385765`*^9, 
   3.9102491049485836`*^9}, {3.910249234568329*^9, 3.91024924532967*^9}, {
   3.911965041112008*^9, 3.9119650470628176`*^9}, {3.9119651389168825`*^9, 
   3.9119651610126095`*^9}, {3.9119654967255235`*^9, 
   3.9119655805113215`*^9}, {3.9119656542582307`*^9, 
   3.9119656869405613`*^9}, {3.9119659623039613`*^9, 3.911965989535017*^9}, {
   3.911966024029789*^9, 3.911966091305372*^9}, {3.911966137840969*^9, 
   3.9119661838404517`*^9}, {3.9119662284939775`*^9, 3.911966237454152*^9}, {
   3.9119662752358913`*^9, 3.9119663917156*^9}, 3.9119664816911955`*^9, {
   3.9119665135971575`*^9, 3.911966525754816*^9}, {3.911968777578771*^9, 
   3.911968855032695*^9}, {3.9121507089597197`*^9, 3.9121507371030793`*^9}, {
   3.912150806318247*^9, 3.9121508096871014`*^9}, {3.9121508409510684`*^9, 
   3.9121509607511444`*^9}, {3.912151005989683*^9, 3.912151102657238*^9}, {
   3.9121513547302094`*^9, 3.9121514033215666`*^9}, {3.9121515794915357`*^9, 
   3.9121515805974636`*^9}, {3.9125352733068175`*^9, 3.91253535886907*^9}, {
   3.9149934655391774`*^9, 3.9149934655391774`*^9}, {3.915437152576473*^9, 
   3.9154371527861624`*^9}, {3.9199625658745046`*^9, 
   3.9199625731291094`*^9}, {3.9199626902098475`*^9, 3.919962772319756*^9}, {
   3.919962810889751*^9, 3.9199628206529655`*^9}, {3.919963031052453*^9, 
   3.9199630354599934`*^9}, {3.919963624670143*^9, 3.9199636443277655`*^9}, {
   3.9199637747098007`*^9, 3.9199638137899847`*^9}, {3.9199638638798923`*^9, 
   3.919963922139797*^9}, {3.919964669580201*^9, 3.919964695466121*^9}, {
   3.919964807900162*^9, 3.9199648080318184`*^9}, {3.9199649971301303`*^9, 
   3.91996501066543*^9}, {3.9199650840998693`*^9, 3.9199651261800337`*^9}, {
   3.9199651702700863`*^9, 3.9199651744424458`*^9}, {3.919965221117121*^9, 
   3.9199652445892773`*^9}, {3.9199653521713552`*^9, 
   3.9199654279213104`*^9}, {3.9199654665099916`*^9, 3.919965515581992*^9}, {
   3.919965559160005*^9, 3.919965628891943*^9}, {3.9199656623420906`*^9, 
   3.919965664570255*^9}, {3.919965974922825*^9, 3.9199660681936955`*^9}, {
   3.9199661047891984`*^9, 3.919966112418111*^9}, {3.9200131764638786`*^9, 
   3.9200131858057175`*^9}, {3.920013415772868*^9, 3.920013415912057*^9}, {
   3.9356344347216988`*^9, 3.9356344765240097`*^9}, {3.9493985214809303`*^9, 
   3.9493985215127583`*^9}, {3.9493995725159206`*^9, 3.9493995775626106`*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"29a0edad-f0da-ac45-b4a9-4e18a04c5880"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
One or two photons (and no other particles) pass the acceptance criteria \
(routine for photons search at CHARM)\
\>", "Subsubsection",
 CellChangeTimes->{{3.9058429928569946`*^9, 3.9058430104412456`*^9}, {
  3.9058438882889347`*^9, 3.905843896125678*^9}, {3.90584403871439*^9, 
  3.9058440773921304`*^9}, {3.9119648985168285`*^9, 
  3.911964900845416*^9}},ExpressionUUID->"b1a157a9-29c8-8646-aa6c-\
d24f01f7dbdb"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DecayAcceptanceCHARM\[Gamma]Comp", "=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"CondGeom", "=", "conditionDecayAcceptanceGeometric"}], ",", 
        RowBox[{"CondMinv", "=", "conditionminvCuts"}], ",", 
        RowBox[{"CondSS", "=", "conditionAngSepCuts"}], ",", 
        RowBox[{"CondIP", "=", "conditionIPcuts"}], ",", 
        RowBox[{"CondPT", "=", "conditionpTcuts"}], ",", 
        RowBox[{"CondE", "=", "conditionEnergyCuts"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "@", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"TableMother", ",", "_Real", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
               "TablePhaseSpaceDecayProducts", ",", "_Real", ",", "2"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"mLLP", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"eventslengths", ",", "_Integer", ",", "2"}], "}"}]}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "cond", ",", "count", ",", "efip", ",", "zfip", ",", 
                "\[Theta]fip", ",", "\[Phi]fip", ",", "px1rest", ",", 
                "py1rest", ",", "pz1rest", ",", "E1rest", ",", "px2rest", ",",
                 "py2rest", ",", "pz2rest", ",", "E2rest", ",", "px1lab", ",",
                 "px2lab", ",", "py1lab", ",", "py2lab", ",", "pz1lab", ",", 
                "pz2lab", ",", "\[Epsilon]Azfip", ",", "xdecayfip", ",", 
                "ydecayfip", ",", "pdg1", ",", "E1lab", ",", "charge1", ",", 
                RowBox[{"len", "=", 
                 RowBox[{"Length", "[", "eventslengths", "]"}]}], ",", 
                RowBox[{"nproducts", "=", "0"}], ",", 
                RowBox[{"f1max", "=", "0"}], ",", "zmagnMzfip", ",", 
                RowBox[{"condGood", "=", "0."}], ",", 
                RowBox[{"condBad", "=", "0."}], ",", 
                RowBox[{"condg1", "=", "0."}], ",", "e1", ",", "e2", ",", 
                "pfip", ",", "pxfip", ",", "pyfip", ",", "pzfip", ",", 
                RowBox[{"min", "=", "0"}], ",", 
                RowBox[{"in1", "=", "0"}], ",", 
                RowBox[{"Coord1FinProd", "=", "0."}], ",", 
                RowBox[{"Coord2FinProd", "=", "0."}], ",", 
                RowBox[{"\[Epsilon]azfip", "=", "0."}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"count", "=", " ", "0."}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Values", " ", "of", " ", "the", " ", "LLP", " ", 
                  SubscriptBox["\[Epsilon]", "az"]}], ",", " ", "E", ",", " ",
                  "\[Theta]", ",", " ", "\[Phi]", ",", " ", 
                 SubscriptBox["x", "long"]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"efip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexELLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"zfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexzLLP"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Theta]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Theta]LLP"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"\[Phi]fip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "index\[Phi]LLP"}], "]"}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"\[Epsilon]azfip", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"TableMother", ",", "indexLLPazAcc"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"\[Epsilon]azfip", "!=", "0."}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"pfip", "=", 
                   SqrtBox[
                    RowBox[{
                    SuperscriptBox["efip", "2"], "-", 
                    SuperscriptBox["mLLP", "2"]}]]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pxfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}], "*", 
                    RowBox[{"Sin", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pyfip", "=", 
                   RowBox[{"pxfip", "*", 
                    FractionBox[
                    RowBox[{"Sin", "[", "\[Phi]fip", "]"}], 
                    RowBox[{"Cos", "[", "\[Phi]fip", "]"}]]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pzfip", "=", 
                   RowBox[{"pfip", "*", 
                    RowBox[{"Cos", "[", "\[Theta]fip", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Distance", " ", "between", " ", "the", " ", "end", " ", 
                    "of", " ", "the", " ", "dipole", " ", "magnet", " ", 
                    "and", " ", "the", " ", "LLP", " ", "decay", " ", 
                    "point"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"zmagnMzfip", "=", 
                   RowBox[{"zMagnetMaxGivenExperiment", "-", "zfip"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"nproducts", "=", 
                   RowBox[{"IntegerPart", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"TablePhaseSpaceDecayProducts", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
                    "LengthDataProduct"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"f1max", "=", 
                   RowBox[{"IntegerPart", "[", 
                    RowBox[{"nproducts", "-", "1"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"xdecayfip", "=", 
                   RowBox[{"LLPdecayVertexX", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"ydecayfip", "=", 
                   RowBox[{"LLPdecayVertexY", "[", 
                    RowBox[{"zfip", ",", "\[Theta]fip", ",", "\[Phi]fip"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "Looping", " ", "over", " ", "simulated", " ", "decays"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"cond", "=", "1."}], ";", "\[IndentingNewLine]", 
                    RowBox[{"min", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "1"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"nproducts", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"eventslengths", ",", "j", ",", "2"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"f1max", "=", 
                    RowBox[{"nproducts", "-", "1"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cond", "=", "0."}], ";", "\[IndentingNewLine]", 
                    RowBox[{"condGood", "=", "0."}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"condBad", "=", "0."}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"e1", "=", "0."}], ";", "\[IndentingNewLine]", 
                    RowBox[{"e2", "=", "0."}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Looping", " ", "over", " ", "product1"}], "*)"}],
                     "\[IndentingNewLine]", 
                    RowBox[{"Do", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"in1", "=", 
                    RowBox[{"min", "+", "f1"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Electric", " ", "charge", " ", "of", " ", "the", " ", 
                    "decay", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"charge1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexcharge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pdg1", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpdg1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "rest", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpx1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpy1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexpz1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E1rest", "=", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{
                    "TablePhaseSpaceDecayProducts", ",", "in1", ",", 
                    "indexE1"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"4", "-", 
                    RowBox[{
                    "momentum", " ", "of", " ", "the", " ", "decay", " ", 
                    "product", " ", "at", " ", "the", " ", 
                    RowBox[{"LLP", "'"}], "s", " ", "lab", " ", "frame"}]}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"px1lab", "=", 
                    RowBox[{"pproductLab1Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"py1lab", "=", 
                    RowBox[{"pproductLab2Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"pz1lab", "=", 
                    RowBox[{"pproductLab3Cart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"E1lab", "=", 
                    RowBox[{"EproductLabCart", "[", 
                    RowBox[{
                    "pxfip", ",", "pyfip", ",", "pzfip", ",", "efip", ",", 
                    "mLLP", ",", "px1rest", ",", "py1rest", ",", "pz1rest", 
                    ",", "E1rest"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Calculating", " ", "the", " ", "geometric", " ", "part", 
                    " ", "of", " ", "the", " ", "decay", " ", "acceptance", 
                    " ", "for", " ", "the", " ", "first", " ", "decay", " ", 
                    "product"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "condg1", ",", "Coord1FinProd", ",", "Coord2FinProd"}], 
                    "}"}], "=", 
                    RowBox[{"CondGeom", "[", 
                    RowBox[{
                    "charge1", ",", "pdg1", ",", "xdecayfip", ",", 
                    "ydecayfip", ",", "zfip", ",", "px1lab", ",", "py1lab", 
                    ",", "pz1lab", ",", "E1lab", ",", "zmagnMzfip"}], "]"}]}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"pdg1", "==", "22."}], ",", 
                    RowBox[{"condGood", "+=", "condg1"}], ",", 
                    RowBox[{"condBad", "+=", "condg1"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"condBad", ">", "0."}], "||", 
                    RowBox[{"condGood", ">", "2"}]}], ",", 
                    RowBox[{
                    RowBox[{"cond", "=", "0."}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"condg1", "==", "1"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"condGood", "==", "1"}], ",", 
                    RowBox[{"e1", "=", "E1lab"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"condGood", "==", "2"}], ",", 
                    RowBox[{"e2", "=", "E1lab"}]}], "]"}]}], "]"}]}], "]"}], 
                    ";"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "If", " ", "other", " ", "cuts", " ", "are", " ", 
                    "required", " ", "and", " ", "the", " ", "geometric", " ",
                     "condition", " ", "for", " ", "product2", " ", "is", " ",
                     "1", " ", "then", " ", "evaluate", " ", "the", " ", 
                    "acceptance", " ", "for", " ", "these", " ", "cuts"}], 
                    "*)"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"f1", ",", "0", ",", "f1max", ",", "1"}], "}"}]}],
                     "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"condGood", ">", "0."}], "&&", 
                    RowBox[{"WhetherCuts", "==", "1"}], "&&", 
                    RowBox[{"condBad", "==", "0."}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Values", " ", "of", " ", "the", " ", "energy", " ", 
                    "cuts", " ", "for", " ", "the", " ", "decay", " ", 
                    "products"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"IfEcuts", "==", "1"}], ",", 
                    RowBox[{"count", "+=", 
                    RowBox[{"CondE", "[", 
                    RowBox[{
                    "22.", ",", "0.", ",", "22.", ",", "e1", ",", "e2"}], 
                    "]"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", 
                    SubscriptBox["p", "T"], " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfpTcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondPT", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "px1lab", ",", "py1lab", ",", 
                    "px2lab", ",", "py2lab"}], "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", "IP", " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfIPcuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondIP", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "xdecayfip", ",", "ydecayfip", 
                    ",", "zfip", ",", "px1lab", ",", "px2lab", ",", "py1lab", 
                    ",", "py2lab", ",", "pz1lab", ",", "pz2lab"}], "]"}]}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"The", " ", "spatial", " ", "separation", " ", 
                    RowBox[{"cut", ".", " ", "If"}], " ", "it", " ", "is", 
                    " ", "present", " ", "then", " ", "evaluate", " ", "the", 
                    " ", 
                    RowBox[{"acceptance", ".", " ", "If"}], " ", "not", " ", 
                    "then", " ", "proceeding", " ", "to", " ", "the", " ", 
                    "next", " ", "cut"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfAngSepCuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondSS", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "zfip", ",", "px1lab", ",", 
                    "px2lab", ",", "py1lab", ",", "py2lab", ",", "pz1lab", 
                    ",", "pz2lab"}], "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "The", " ", "invariant", " ", "mass", " ", "cut"}], 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IfminvCuts", "==", "1"}], "&&", 
                    RowBox[{"cond", "\[Equal]", "1"}]}], ",", 
                    RowBox[{"cond", "=", 
                    RowBox[{"CondMinv", "[", 
                    RowBox[{
                    "pdg1", ",", "pdg2", ",", "px1lab", ",", "py1lab", ",", 
                    "pz1lab", ",", "E1lab", ",", "px2lab", ",", "py2lab", ",",
                     "pz2lab", ",", "E2lab"}], "]"}]}]}], "]"}], ";"}], 
                    "*)"}], "\[IndentingNewLine]", "]"}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "1", ",", "len"}], "}"}]}], "]"}], 
                  ";"}], "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "Returns", " ", "the", " ", "number", " ", "of", " ", 
                    "simulated", " ", "acceptances", " ", "divided", " ", 
                    "by", " ", "the", " ", "number", " ", "of", " ", 
                    "simulated", " ", 
                    RowBox[{"events", ".", " ", "For"}], " ", "the", " ", 
                    "decays", " ", "where", " ", "more", " ", "than", " ", 
                    "one", " ", "combination", " ", "of", " ", "decay", " ", 
                    "products", " ", "pair", " ", "exists"}], ",", " ", 
                   RowBox[{
                    RowBox[{"this", " ", "value", " ", "may", " ", "be"}], 
                    " ", ">", " ", 
                    RowBox[{
                    "1.", " ", "It", " ", "will", " ", "be", " ", "replaced", 
                    " ", "with"}], " ", "\[Equal]", " ", 
                    RowBox[{
                    "1", " ", "in", " ", "the", " ", "next", " ", 
                    "step"}]}]}], "*)"}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"count", "=", "0."}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"count", "/", "len"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", 
            RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"CompilationOptions", "->", 
             RowBox[{"{", 
              RowBox[{"\"\<InlineCompiledFunctions\>\"", "->", "True"}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], "/.", 
         RowBox[{"ruleDown", "[", 
          RowBox[{"{", 
           RowBox[{
           "LLPdecayVertexX", ",", "LLPdecayVertexY", ",", "pproductLab1Cart",
             ",", "pproductLab2Cart", ",", "pproductLab3Cart", ",", 
            "EproductLabCart"}], "}"}], "]"}]}], "/.", 
        RowBox[{"ruleOwn", "[", 
         RowBox[{"{", 
          RowBox[{
          "indexpdg1", ",", "indexELLP", ",", "indexzLLP", ",", 
           "index\[Theta]LLP", ",", "index\[Phi]LLP", ",", "indexLLPazAcc", 
           ",", "indexpx1", ",", "indexpy1", ",", "indexpz1", ",", "indexE1", 
           ",", "LengthDataProduct", ",", "WhetherCuts", ",", "indexcharge1", 
           ",", "zMagnetMaxGivenExperiment", ",", "IfEcuts", ",", "IfpTcuts", 
           ",", "IfAngSepCuts", ",", "IfIPcuts", ",", "IfminvCuts"}], "}"}], 
         "]"}]}], "//", "ReleaseHold"}]}], "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"<<", "CompiledFunctionTools`"}], "\n", 
    RowBox[{"CompilePrint", "@", "DecayAcceptanceCHARM\[Gamma]Comp"}]}], 
   ";"}], "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.905843074387643*^9, 3.9058431334304905`*^9}, {
   3.905843183603532*^9, 3.9058431838739676`*^9}, {3.9058432391159277`*^9, 
   3.9058432606479034`*^9}, {3.9058435175846615`*^9, 3.905843584242088*^9}, {
   3.905843694793634*^9, 3.905843719697756*^9}, {3.9058437591516027`*^9, 
   3.905843806246789*^9}, {3.9058440874648285`*^9, 3.9058443444609203`*^9}, {
   3.9058444069168534`*^9, 3.905844409126068*^9}, {3.9058444602452803`*^9, 
   3.905844527886752*^9}, {3.9058445712268105`*^9, 3.9058445727744956`*^9}, {
   3.905844679065505*^9, 3.9058446832133226`*^9}, {3.905844721864481*^9, 
   3.905844723870822*^9}, {3.9058451712090893`*^9, 3.905845186585994*^9}, {
   3.910249122648197*^9, 3.9102491252327814`*^9}, {3.9121515905300064`*^9, 
   3.9121516343170977`*^9}, {3.9121521160950966`*^9, 
   3.9121521924824543`*^9}, {3.9121522304186926`*^9, 3.91215225124841*^9}, {
   3.9121522926081867`*^9, 3.9121523979463243`*^9}, 3.9121598123635926`*^9, {
   3.9125353647143407`*^9, 3.912535406917486*^9}, {3.9149934655704193`*^9, 
   3.91499346558604*^9}, {3.9154371527984834`*^9, 3.9154371530179157`*^9}, {
   3.9199639303702035`*^9, 3.9199639505439315`*^9}, {3.9356344855187454`*^9, 
   3.935634514789736*^9}, {3.941016241788784*^9, 3.94101627933321*^9}, {
   3.9493985215172634`*^9, 3.949398521544916*^9}, {3.9493995628304615`*^9, 
   3.9493995669839153`*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"24fab386-fe13-7341-8ac3-59be69264199"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1920, 1011.75},
WindowMargins->{{-6, Automatic}, {Automatic, -6}},
FrontEndVersion->"14.1 for Microsoft Windows (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ada5160c-9edd-7c4d-8586-bf2798d69ad1"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[576, 22, 192, 3, 67, "Chapter",ExpressionUUID->"1e3846eb-525c-5743-97ad-28a228d9e0b2"],
Cell[CellGroupData[{
Cell[793, 29, 244, 4, 66, "Section",ExpressionUUID->"49530853-d827-264c-b220-479a332a561b"],
Cell[CellGroupData[{
Cell[1062, 37, 160, 3, 53, "Subsection",ExpressionUUID->"2b1c5d47-f8cb-1144-b41d-77d072963f98"],
Cell[1225, 42, 2154, 60, 280, "Input",ExpressionUUID->"d56bab22-f8f3-dd4d-96c3-58996b8065f0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3416, 107, 172, 3, 53, "Subsection",ExpressionUUID->"49dddbe9-6fcd-0047-8a0b-92605d1c1e17"],
Cell[CellGroupData[{
Cell[3613, 114, 170, 3, 43, "Subsubsection",ExpressionUUID->"4461a3cd-0637-2740-9dd2-43ac9a153c25"],
Cell[CellGroupData[{
Cell[3808, 121, 22022, 530, 992, "Input",ExpressionUUID->"1765c81f-fcce-ac45-9483-f017a0d43211"],
Cell[25833, 653, 916, 15, 21, "Print",ExpressionUUID->"de4a32a7-1d3a-834e-b983-b87fedd575e5"],
Cell[26752, 670, 2212, 48, 113, "Output",ExpressionUUID->"4c69ff8d-a47f-0b43-b397-495a499dd149"],
Cell[28967, 720, 839, 13, 21, "Print",ExpressionUUID->"da648f45-793a-4345-8cd3-f4b7a66ed06f"],
Cell[29809, 735, 1903, 46, 57, "Output",ExpressionUUID->"addf2573-cc51-b14f-ac20-3c7727ce84e1"],
Cell[31715, 783, 964, 16, 21, "Print",ExpressionUUID->"ba5fc002-82fb-044a-947c-5377e0a64617"],
Cell[32682, 801, 1623, 37, 49, "Output",ExpressionUUID->"7cf9449f-4735-5046-8b50-2ea3190b1832"],
Cell[34308, 840, 1571, 24, 22, "Print",ExpressionUUID->"20d22e4e-63b2-c547-947b-b2c926380e8b"],
Cell[35882, 866, 1037, 21, 50, "Output",ExpressionUUID->"d6fd0b21-d388-454f-9a9c-7bd365ecec84"],
Cell[36922, 889, 831, 13, 21, "Print",ExpressionUUID->"43aa5c04-47da-684d-8c05-c8548a10e028"],
Cell[37756, 904, 852, 15, 46, "Output",ExpressionUUID->"543d5cd4-8fc8-1748-b133-ab8ea2f67ce8"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[38657, 925, 169, 3, 43, "Subsubsection",ExpressionUUID->"fe954feb-c1f5-634d-8585-24959c2c55b1"],
Cell[38829, 930, 8048, 211, 393, "Input",ExpressionUUID->"9e5c288b-f48e-0a42-b29c-9dd18af65207"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[46938, 1148, 164, 3, 66, "Section",ExpressionUUID->"b4548117-d6ba-2e4c-a726-c8c1e3d4d8eb"],
Cell[CellGroupData[{
Cell[47127, 1155, 297, 4, 53, "Subsection",ExpressionUUID->"64b33208-3204-cc4b-942c-e2a65329bf7b"],
Cell[47427, 1161, 9469, 237, 423, "Input",ExpressionUUID->"2df153bd-ee90-fe40-8aca-2dbf7edd67fe"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[56945, 1404, 314, 5, 66, "Section",ExpressionUUID->"6f9a29be-a698-0a43-9c20-918c01c3399f"],
Cell[CellGroupData[{
Cell[57284, 1413, 202, 3, 53, "Subsection",ExpressionUUID->"d9b253ca-177d-6b47-94d1-003e450d6c79"],
Cell[CellGroupData[{
Cell[57511, 1420, 170, 3, 43, "Subsubsection",ExpressionUUID->"1f8a2ef1-7ff1-d442-b4c2-842e73cd5575"],
Cell[CellGroupData[{
Cell[57706, 1427, 12817, 323, 817, "Input",ExpressionUUID->"3c57df6e-f583-ab43-8484-375cdc9169d8"],
Cell[70526, 1752, 651, 19, 51, "Output",ExpressionUUID->"9dad719a-28b6-a247-8078-06c9620466e8"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[71226, 1777, 172, 3, 35, "Subsubsection",ExpressionUUID->"0a9d31ae-4d51-204f-8451-59431965f657"],
Cell[71401, 1782, 13354, 311, 487, "Input",ExpressionUUID->"63b97567-09ce-3b48-9367-f5d06342a263"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[84804, 2099, 333, 5, 53, "Subsection",ExpressionUUID->"fdb43a30-b319-f74d-8f9b-b06d46e0a0b9"],
Cell[CellGroupData[{
Cell[85162, 2108, 291, 4, 43, "Subsubsection",ExpressionUUID->"18245b5b-febe-3142-abb1-109cbfa1cc35"],
Cell[85456, 2114, 17846, 347, 828, "Input",ExpressionUUID->"4362caac-e623-0e49-9cb6-510992d1fc49"],
Cell[CellGroupData[{
Cell[103327, 2465, 157, 3, 30, "Item",ExpressionUUID->"46406f3f-49dc-b240-822f-7d87360296b6"],
Cell[103487, 2470, 18003, 344, 904, "Input",ExpressionUUID->"af8499ee-5824-3047-85a7-ff3284a1791e"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[121539, 2820, 286, 4, 43, "Subsubsection",ExpressionUUID->"b06d2851-a7ba-e34d-82b5-c49a68d8007a"],
Cell[121828, 2826, 6325, 147, 406, "Input",ExpressionUUID->"8b984700-8ef1-2540-b4cd-c78e2e18eb37"]
}, Open  ]],
Cell[CellGroupData[{
Cell[128190, 2978, 355, 10, 43, "Subsubsection",ExpressionUUID->"828622e9-b4ff-164a-b516-545ce95a996c"],
Cell[128548, 2990, 3858, 88, 245, "Input",ExpressionUUID->"0cec4828-cde8-5940-87dc-b118920088e4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[132443, 3083, 218, 3, 43, "Subsubsection",ExpressionUUID->"f77d74ad-4adf-6a4f-96ea-39bee69a5c10"],
Cell[132664, 3088, 3639, 83, 231, "Input",ExpressionUUID->"12d67c59-0b81-f94d-aa3f-23591272ef30"]
}, Closed]],
Cell[CellGroupData[{
Cell[136340, 3176, 318, 5, 35, "Subsubsection",ExpressionUUID->"a722787f-af48-f64f-9b15-feb94ca80a6b"],
Cell[136661, 3183, 10585, 232, 657, "Input",ExpressionUUID->"54962fb0-c248-844d-b7fe-e79199eb5498"]
}, Closed]],
Cell[CellGroupData[{
Cell[147283, 3420, 377, 5, 35, "Subsubsection",ExpressionUUID->"63d4f94d-d3cd-c141-88d5-6e2a0934ff91"],
Cell[147663, 3427, 9402, 206, 574, "Input",ExpressionUUID->"bc3cd41d-54b0-e447-a714-f9b1dcdd35ab"]
}, Open  ]],
Cell[CellGroupData[{
Cell[157102, 3638, 268, 4, 43, "Subsubsection",ExpressionUUID->"12b945a1-45aa-a84f-b329-9b6885b995de"],
Cell[157373, 3644, 5139, 113, 299, "Input",ExpressionUUID->"a5ad9fa1-6022-7348-8582-44d2223c0a89"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[162561, 3763, 204, 3, 53, "Subsection",ExpressionUUID->"f31ca543-e29d-ac4a-9135-1870c6f0223e"],
Cell[162768, 3768, 502, 12, 28, "Input",ExpressionUUID->"5a330087-603f-477c-bf72-86ae05679ea1"],
Cell[CellGroupData[{
Cell[163295, 3784, 331, 5, 43, "Subsubsection",ExpressionUUID->"8349303a-0484-cc45-b3cd-ffe7bbe4fa9f"],
Cell[CellGroupData[{
Cell[163651, 3793, 160, 3, 30, "Item",ExpressionUUID->"b66752c4-d012-8746-876b-57d066ca209c"],
Cell[163814, 3798, 28265, 519, 1478, "Input",ExpressionUUID->"4dd35f55-afbb-7f41-a6c9-5ff525d7046c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[192116, 4322, 164, 3, 30, "Item",ExpressionUUID->"1f66c710-1607-dc44-ab6f-d151dd2eb24c"],
Cell[192283, 4327, 21434, 422, 1843, "Input",ExpressionUUID->"9de6b324-066e-2042-87cd-01b14d5770aa"]
}, Closed]],
Cell[CellGroupData[{
Cell[213754, 4754, 213, 4, 26, "Item",ExpressionUUID->"87057928-b507-6f48-96cb-843d11020baa"],
Cell[213970, 4760, 28982, 566, 2307, "Input",ExpressionUUID->"6c740609-8cea-0e4e-a585-41e3b7c508b4"]
}, Closed]],
Cell[CellGroupData[{
Cell[242989, 5331, 182, 2, 26, "Item",ExpressionUUID->"8edcd0f7-9d07-4466-9992-bb73979451bd"],
Cell[243174, 5335, 18724, 365, 1324, "Input",ExpressionUUID->"cba2c1ae-b848-4324-86dd-3b418038f457"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[261947, 5706, 540, 8, 43, "Subsubsection",ExpressionUUID->"5669e1eb-fc82-ef45-8b93-5f3b6dc43721"],
Cell[262490, 5716, 24229, 446, 1728, "Input",ExpressionUUID->"57ceb468-e5c4-0e4a-bac1-0b4eaf7a8916"]
}, Closed]],
Cell[CellGroupData[{
Cell[286756, 6167, 494, 8, 35, "Subsubsection",ExpressionUUID->"839428aa-1891-5a47-80f8-d1f195e51685"],
Cell[287253, 6177, 23786, 436, 1488, "Input",ExpressionUUID->"29a0edad-f0da-ac45-b4a9-4e18a04c5880"]
}, Open  ]],
Cell[CellGroupData[{
Cell[311076, 6618, 424, 8, 43, "Subsubsection",ExpressionUUID->"b1a157a9-29c8-8646-aa6c-d24f01f7dbdb"],
Cell[311503, 6628, 25968, 488, 1640, "Input",ExpressionUUID->"24fab386-fe13-7341-8ac3-59be69264199"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

